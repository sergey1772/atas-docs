
## Методичка для создания АТРИБУТОВ в ATAS на основе PDF-файла

### Стратегии

#### Разработка стратегии

Strategy API позволяет создавать стратегии, основанные на Indicators API, для автоматизации вашей торговли.

Для разработки стратегии необходимо:

1.  Разработать проект библиотеки классов в Visual Studio.
2.  Добавить ссылку на ATAS Strategies.dll, которая находится в директории с установленной программой, в проекте.
3.  Создать класс стратегии и унаследовать его от класса `ChartStrategy`.
4.  Реализовать логику работы стратегии.
5.  Скомпилировать библиотеку.
6.  Поместить полученный dll-файл в директорию `\Documents\ATAS\Strategies`.
7.  Нажать на мигающую кнопку для вступления изменений в списке стратегий в силу.

*Изображение интерфейса ATAS с выделенной кнопкой обновления списка стратегий*

#### Стратегии графика (Chart Strategies)

Функциональность Стратегий графика позволяет получать и обрабатывать весь набор данных, доступный в индикаторах, и выполнять торговые операции на основе этих данных.

Класс `ChartStrategy` наследуется от класса `Indicator`. Таким образом, стратегии обладают полной функциональностью индикаторов.

В дополнение к функциональности индикаторов, стратегии имеют дополнительные свойства и методы, отвечающие за торговую функциональность:

**Свойства (Properties):**

*   `Security` - торговый инструмент
*   `Portfolio` - выбранный портфель
*   `Connector` - торговое соединение
*   `MyTrades` - список сделок
*   `Orders` - список ордеров
*   `CurrentPosition` - объем текущей позиции стратегии
*   `AveragePrice` - средняя цена текущей позиции стратегии
*   `State` - состояние стратегии (может быть Stopped, Started и Suspended)

**Основные публичные методы стратегии (Main strategy public methods):**

*   `OpenOrder` - метод открытия нового ордера
*   `ModifyOrder` - метод изменения существующего ордера
*   `CancelOrder` - метод отмены ордера
*   `ShrinkPrice` - округление переданной цены до размера тика торгового инструмента
*   `RaiseShowNotification` - метод, позволяющий визуализировать уведомления в платформе

**Виртуальные методы стратегии (Strategy virtual methods)**, которые, при необходимости, должны быть переопределены в создаваемой стратегии:

*   `OnStarted` - вызывается при запуске стратегии
*   `OnSuspended` - вызывается, когда стратегия приостановлена (например, в ситуациях, когда график со стратегией был закрыт)
*   `OnStopping` - вызывается перед остановкой стратегии
*   `OnStopped` - вызывается, когда стратегия остановлена
*   `OnCurrentPositionChanged` - вызывается при изменении текущей позиции стратегии
*   `CanProcess` - возвращает, возможно ли торговать в данный момент. По умолчанию, метод проверяет, запущена ли стратегия и обработан ли самый последний бар в этот момент.

**Позиции стратегии (Strategy positions).**

Каждая стратегия хранит свою позицию внутри. Эта позиция может отличаться от общей позиции на счете. Общую позицию счета можно получить через свойство `TradingManager.Position`. Внутреннюю позицию стратегии можно получить через свойства `CurrentPosition` и `AveragePrice`.

**Важно!** Когда стратегия остановлена, ее внутренняя позиция сбрасывается в ноль. Крайне желательно переопределить метод `OnStopping` и реализовать логику закрытия внутренних позиций и отмены выставленных ордеров в нем.

Чтобы найти стратегию графика в списке стратегий, необходимо:

1.  Открыть контекстное меню правой кнопкой мыши,
2.  Нажать на иконку списка стратегий,
3.  В открывшемся окне списка стратегий выбрать нужную стратегию,
4.  Нажать кнопку `Add`.
5.  Вы можете включить / отключить стратегию, нажав кнопку управления.

*Изображение окна "Chart strategies" в ATAS с выделенными элементами управления стратегией*

### Дополнительные опции ордеров (Additional order options)

При разработке стратегии вы можете установить определенные опции ордеров, используя свойство стратегии `TradingManager`.

#### Reduced only

Ордера **Reduced only** являются механизмом контроля риска, который гарантирует, что при исполнении они будут только уменьшать существующую позицию, предотвращая любое непреднамеренное увеличение экспозиции. Эта функция особенно важна на рынках, где точный контроль над позициями имеет решающее значение для эффективного управления рисками.

```csharp
private void TrySetReduceOnly(Order order)
{
    // Объявляем переменную flags для хранения опций ордера.
    var flags = TradingManager?
        // Получаем интерфейс для работы с опциями безопасности торговли.
        .GetSecurityTradingOptions()?
        // Создаем расширенные опции ордера на основе типа ордера.
        .CreateExtendedOptions(order.Type);

    // Проверяем, является ли flags типом IOrderOptionReduceOnly.
    if (flags is not IOrderOptionReduceOnly ro)
        // Если нет, выходим из метода, так как опция ReduceOnly не поддерживается.
        return;

    // Устанавливаем свойство ReduceOnly в true, чтобы ордер был только на уменьшение позиции.
    ro.ReduceOnly = true;
    // Применяем настроенные опции к ордеру.
    order.ExtendedOptions = flags;
}
```

#### Post only

Когда вы размещаете ордер **Post only**, вы сообщаете бирже, что хотите, чтобы ваш ордер рассматривался только как мейкерский ордер. Другими словами, вы хотите убедиться, что ваш ордер не исполнится как тейкерский ордер, что приведет к уплате торговых комиссий. Если ваш ордер **Post only** будет исполнен немедленно как тейкерский ордер, он будет отменен вместо этого.

```csharp
private void TrySetPostOnly(Order order)
{
    // Объявляем переменную flags для хранения опций ордера.
    var flags = TradingManager?
        // Получаем интерфейс для работы с опциями безопасности торговли.
        .GetSecurityTradingOptions()?
        // Создаем расширенные опции ордера на основе типа ордера.
        .CreateExtendedOptions(order.Type);

    // Проверяем, является ли flags типом IOrderOptionPostOnly.
    if (flags is not IOrderOptionPostOnly po)
        // Если нет, выходим из метода, так как опция PostOnly не поддерживается.
        return;

    // Устанавливаем свойство PostOnly в true, чтобы ордер был только PostOnly.
    po.PostOnly = true;
    // Применяем настроенные опции к ордеру.
    order.ExtendedOptions = flags;
}
```

#### Close on trigger

Ордер **Close on trigger** - это тип торгового ордера, который исполняется при выполнении заданного триггерного условия на рынке. Он часто используется для управления рисками и для автоматического закрытия позиций или выполнения определенных действий при достижении определенного ценового уровня.

```csharp
private void TrySetCloseOnTrigger(Order order)
{
    // Объявляем переменную flags для хранения опций ордера.
    var flags = TradingManager?
        // Получаем интерфейс для работы с опциями безопасности торговли.
        .GetSecurityTradingOptions()?
        // Создаем расширенные опции ордера на основе типа ордера.
        .CreateExtendedOptions(order.Type);

    // Проверяем, является ли flags типом IOrderOptionCloseOnTrigger.
    if (flags is not IOrderOptionCloseOnTrigger ct)
        // Если нет, выходим из метода, так как опция CloseOnTrigger не поддерживается.
        return;

    // Устанавливаем свойство CloseOnTrigger в true, чтобы ордер был CloseOnTrigger.
    ct.CloseOnTrigger = true;
    // Применяем настроенные опции к ордеру.
    order.ExtendedOptions = flags;
}
```






## Методичка для создания АТРИБУТОВ в ATAS на основе PDF "Managing orders in trading"

### Управление ордерами в трейдинге

Основные методы управления ордерами включают в себя такие методы, как `OpenOrder`, `ModifyOrder`, `CancelOrder`. Вызывая эти методы, разработчики по сути предоставляют инструкции для исполнения. Однако, биржа / торговое соединение не гарантирует, что эта инструкция будет выполнена. Они могут быть выполнены полностью, частично или с отклонениями.

Для получения информации о том, что происходит с ордерами, разработчики могут переопределить такие методы, как `OnOrderChanged`, `OnOrderRegisterFailed`, `OnOrderModifyFailed`, `OnOrderCancelFailed`.

Важно понимать, что эти методы вызывают меньший отклик от биржи/торгового соединения и могут находиться в разных потоках и иногда могут использовать `sync methods`.

### Использование синхронных методов

#### Размещение ордера

Чтобы разместить ордер, используйте метод `OpenOrder`, которому передается заполненная сущность `Order`.

Пример размещения рыночного ордера на покупку объемом 1 лот:

```csharp
var order = new Order // Объявление переменной order типа Order и создание нового объекта Order.
{
    Portfolio = Portfolio, // Установка свойства Portfolio ордера. Предполагается, что Portfolio - это предопределенная переменная, содержащая информацию о портфеле.
    Security = Security, // Установка свойства Security ордера. Security - это инструмент торговли (например, акция, фьючерс).
    Direction = OrderDirections.Buy, // Установка направления ордера на покупку (Buy). OrderDirections.Buy - это перечисление, определяющее направление ордера.
    Type = OrderTypes.Market, // Установка типа ордера как рыночный (Market). OrderTypes.Market - это перечисление, определяющее тип ордера.
    QuantityToFill = 1, // Установка количества для исполнения в 1 лот.
};
OpenOrder(order); // Вызов метода OpenOrder для отправки созданного ордера на биржу.
```

Пример размещения лимитного ордера на продажу по цене 100 с объемом 1 лот:

```csharp
var order = new Order // Объявление переменной order типа Order и создание нового объекта Order.
{
    Portfolio = Portfolio, // Установка свойства Portfolio ордера.
    Security = Security, // Установка свойства Security ордера.
    Direction = OrderDirections.Sell, // Установка направления ордера на продажу (Sell). OrderDirections.Sell - это перечисление, определяющее направление ордера.
    Type = OrderTypes.Limit, // Установка типа ордера как лимитный (Limit). OrderTypes.Limit - это перечисление, определяющее тип ордера.
    Price = 100, // Установка лимитной цены ордера в 100.
    QuantityToFill = 1, // Установка количества для исполнения в 1 лот.
};
OpenOrder(order); // Вызов метода OpenOrder для отправки созданного ордера на биржу.
```

Пример размещения стоп-ордера на продажу по цене 100 с объемом 1 лот:

```csharp
var order = new Order // Объявление переменной order типа Order и создание нового объекта Order.
{
    Portfolio = Portfolio, // Установка свойства Portfolio ордера.
    Security = Security, // Установка свойства Security ордера.
    Direction = OrderDirections.Sell, // Установка направления ордера на продажу (Sell).
    Type = OrderTypes.Stop, // Установка типа ордера как стоп-ордер (Stop). OrderTypes.Stop - это перечисление, определяющее тип ордера.
    TriggerPrice = 100, // Установка триггерной цены стоп-ордера в 100. При достижении этой цены ордер будет активирован.
    QuantityToFill = 1, // Установка количества для исполнения в 1 лот.
};
OpenOrder(order); // Вызов метода OpenOrder для отправки созданного ордера на биржу.
```

Пример размещения стоп-лимит ордера на продажу по цене активации 100 и максимальной цене исполнения 95, с объемом 1 лот:

```csharp
var order = new Order // Объявление переменной order типа Order и создание нового объекта Order.
{
    Portfolio = Portfolio, // Установка свойства Portfolio ордера.
    Security = Security, // Установка свойства Security ордера.
    Direction = OrderDirections.Sell, // Установка направления ордера на продажу (Sell).
    Type = OrderTypes.StopLimit, // Установка типа ордера как стоп-лимит ордер (StopLimit). OrderTypes.StopLimit - это перечисление, определяющее тип ордера.
    TriggerPrice = 100, // Установка триггерной цены стоп-лимит ордера в 100. При достижении этой цены ордер будет активирован.
    Price = 95, // Установка лимитной цены исполнения стоп-лимит ордера в 95. Ордер будет исполнен не хуже этой цены.
    QuantityToFill = 1, // Установка количества для исполнения в 1 лот.
};
OpenOrder(order); // Вызов метода OpenOrder для отправки созданного ордера на биржу.
```

Метод `OpenOrder` не гарантирует, что ордер будет размещен, он только отправляет ордер на биржу. Результат отправки следует просматривать в методах `OnOrderChanged` и `OnOrderRegisterFailed`.

Если биржа отклоняет заявку на размещение ордера, будет вызван метод `OnOrderRegisterFailed`, который получит ссылку на исходный размещенный ордер и сообщение от биржи.

В процессе размещения ордера и принятия его биржей, биржа отправляет обновления по этому ордеру. Все обновления ордера отправляются в `OnOrderChanged`. Через `order.Status()` можно получить текущий статус ордера.

Пример размещения ордера и контроля его размещения:

```csharp
using ATAS.DataFeedsCore; // Пространство имен для работы с источниками данных ATAS.
using ATAS.Strategies.Chart; // Пространство имен для создания стратегий на графике ATAS.

public class SampleStrategy : ChartStrategy // Объявление класса SampleStrategy, наследующегося от ChartStrategy, что позволяет использовать его как индикатор или стратегию в ATAS.
{
    private Order _order; // Объявление приватной переменной _order типа Order для хранения информации об ордере.
    private bool _firstTime = true; // Объявление приватной булевой переменной _firstTime, используемой для однократного выполнения кода при первом расчете.

    protected override void OnCalculate (int bar, decimal value) // Переопределение метода OnCalculate, который вызывается при каждом обновлении данных (новом баре).
    {
        if (bar == CurrentBar - 1 && _firstTime) // Условие для выполнения кода только на первом баре (CurrentBar - 1) и только один раз (_firstTime == true).
        {
            _firstTime = false; // Установка _firstTime в false, чтобы код внутри if не выполнялся повторно.
            _order = new Order // Создание нового объекта Order и присвоение его переменной _order.
            {
                Portfolio = Portfolio, // Установка свойства Portfolio ордера.
                Security = Security, // Установка свойства Security ордера.
                Direction = OrderDirections.Buy, // Установка направления ордера на покупку.
                Type = OrderTypes.Limit, // Установка типа ордера как лимитный.
                Price = 100, // Установка лимитной цены ордера в 100.
                QuantityToFill = 1, // Установка количества для исполнения в 1 лот.
            };
            OpenOrder(_order); // Вызов метода OpenOrder для отправки созданного ордера на биржу.
        }
    }

    protected override void OnOrderRegisterFailed(Order order, string message) // Переопределение метода OnOrderRegisterFailed, который вызывается, если регистрация ордера на бирже не удалась.
    {
        if (order == _order) // Проверка, что сбой регистрации произошел именно для нашего ордера (_order).
        {
            // order placement error, see message for details. // Комментарий, указывающий на ошибку размещения ордера и необходимость просмотра сообщения об ошибке (message).
        }
    }

    protected override void OnOrderChanged(Order order) // Переопределение метода OnOrderChanged, который вызывается при изменении статуса ордера.
    {
        if (order == _order) // Проверка, что изменение статуса произошло именно для нашего ордера (_order).
        {
            switch (order.Status()) // Оператор switch для обработки различных статусов ордера, полученных через order.Status().
            {
                case OrderStatus.None: // Обработка статуса OrderStatus.None (неопределенный статус).
                    // The order has an undefined status (you need to wait for the next method ca // Комментарий, указывающий на неопределенный статус и необходимость ожидания следующего вызова метода.
                    break; // Выход из case OrderStatus.None.
                case OrderStatus.Placed: // Обработка статуса OrderStatus.Placed (ордер размещен).
                    // the order is placed. // Комментарий, указывающий, что ордер размещен.
                    break; // Выход из case OrderStatus.Placed.
                case OrderStatus.Filled: // Обработка статуса OrderStatus.Filled (ордер исполнен).
                    // the order is filled. // Комментарий, указывающий, что ордер исполнен.
                    break; // Выход из case OrderStatus.Filled.
                case OrderStatus.PartlyFilled: // Обработка статуса OrderStatus.PartlyFilled (ордер частично исполнен).
                    // the order is partially filled. // Комментарий, указывающий, что ордер частично исполнен.
                    {
                        var unfilled = order.Unfilled; // this is a unfilled volume. // Объявление переменной unfilled и присвоение ей неисполненного объема ордера (order.Unfilled). Комментарий, поясняющий, что unfilled - это неисполненный объем.
                    }
                    break; // Выход из case OrderStatus.PartlyFilled.
                case OrderStatus.Canceled: // Обработка статуса OrderStatus.Canceled (ордер отменен).
                    // the order is canceled. // Комментарий, указывающий, что ордер отменен.
                    break; // Выход из case OrderStatus.Canceled.
            }
        }
    }
}
```

### Изменение ордера

Чтобы изменить размещенный ордер, необходимо создать копию этого ордера, изменить цену или объем в ней и вызвать `ModifyOrder`, передав старый ордер и новый в качестве параметров. Также необходимо помнить, что если мы храним ссылку на старый ордер, то при изменении нам нужно присвоить нашему полю ссылку на новый ордер.

Если метод `OnOrderModifyFailed` получает ордер, ранее отправленный на модификацию, то модификация была невозможна по какой-то причине.

Статус изменения ордера следует отслеживать в `OnOrderChanged`.

В примере изменения ордера предполагается, что объект `_order` содержит ордер, который активен на момент запуска:

```csharp
using ATAS.DataFeedsCore; // Пространство имен для работы с источниками данных ATAS.
using ATAS.Strategies.Chart; // Пространство имен для создания стратегий на графике ATAS.

public class SampleStrategy : ChartStrategy // Объявление класса SampleStrategy, наследующегося от ChartStrategy.
{
    private Order _order; // Объявление приватной переменной _order для хранения информации об ордере.
    private Order _newOrder; // Объявление приватной переменной _newOrder для хранения информации о новом ордере (после модификации).
    private bool _firstTime = true; // Объявление приватной булевой переменной _firstTime для однократного выполнения кода.

    protected override void OnCalculate(int bar, decimal value) // Переопределение метода OnCalculate.
    {
        if (bar == CurrentBar - 1 && _firstTime) // Условие для однократного выполнения кода на первом баре.
        {
            // Here we receive a signal and open an order. // Комментарий, указывающий на получение сигнала и открытие ордера (предполагается, что код открытия ордера находится в другом месте, и _order уже инициализирован).

            // Here the conditions under which you need to change the order price have been met. // Комментарий, указывающий на наступление условий для изменения цены ордера.
            _newOrder = _order.Clone(); // Создание копии существующего ордера _order и присвоение ее переменной _newOrder. Метод Clone() создает полную копию объекта.
            _newOrder.Price = 200; // Изменение цены в новом ордере _newOrder на 200.
            ModifyOrder(_order, _newOrder); // Вызов метода ModifyOrder для отправки запроса на изменение ордера. Передаются старый ордер (_order) и новый ордер (_newOrder).
        }
    }

    protected override void OnOrderModifyFailed(Order order, Order newOrder, string error) // Переопределение метода OnOrderModifyFailed, вызываемого при неудачной попытке изменения ордера.
    {
        if (order == _order) // Проверка, что сбой модификации произошел именно для нашего ордера (_order).
        {
            // Here it will be clear that it was not possible to change _order. // Комментарий, указывающий на невозможность изменения ордера _order.
        }
    }

    protected override void OnOrderChanged(Order order) // Переопределение метода OnOrderChanged, вызываемого при изменении статуса ордера.
    {
        if (order == _newOrder) // Проверка, что изменение статуса произошло именно для нового ордера (_newOrder), то есть для измененного ордера.
        {
            switch (order.Status()) // Оператор switch для обработки различных статусов ордера.
            {
                case OrderStatus.None: // Обработка статуса OrderStatus.None.
                    // The order has an undefined status (you need to wait for the next method ca // Комментарий, указывающий на неопределенный статус и необходимость ожидания.
                    break; // Выход из case OrderStatus.None.
                case OrderStatus.Placed: // Обработка статуса OrderStatus.Placed.
                    // the new order has been placed, the change was successful. // Комментарий, указывающий, что новый ордер размещен и изменение прошло успешно.
                    break; // Выход из case OrderStatus.Placed.
                case OrderStatus.Filled: // Обработка статуса OrderStatus.Filled.
                    // the order was placed and filled. // Комментарий, указывающий, что ордер был размещен и исполнен (возможно, измененный ордер был исполнен).
                    break; // Выход из case OrderStatus.Filled.
                case OrderStatus.PartlyFilled: // Обработка статуса OrderStatus.PartlyFilled.
                    // the order is partially filled. // Комментарий, указывающий, что ордер частично исполнен.
                    {
                        var unfilled = order.Unfilled; // this is a unfilled volume. // Объявление переменной unfilled и присвоение ей неисполненного объема. Комментарий, поясняющий, что unfilled - это неисполненный объем.
                        break; // Выход из case OrderStatus.PartlyFilled.
                    }
                case OrderStatus.Canceled: // Обработка статуса OrderStatus.Canceled.
                    // the order is canceled. // Комментарий, указывающий, что ордер отменен.
                    break; // Выход из case OrderStatus.Canceled.
            }
        }
    }
}
```

### Отмена ордера

`CancelOrder` отправляет инструкцию на биржу для отмены ордера. Также нет гарантии успешной отмены, поэтому необходимо отслеживать статус ордеров в методах `OnOrderCancelFailed` и `OnOrderChanged`.

Перед отправкой `CancelOrder` рекомендуется убедиться, что `State` ордера равен `OrderStates.Active`.

В примере отмены ордера предполагается, что объект `_order` содержит ордер, который активен на момент запуска:

```csharp
using ATAS.DataFeedsCore; // Пространство имен для работы с источниками данных ATAS.
using ATAS.Strategies.Chart; // Пространство имен для создания стратегий на графике ATAS.

public class SampleStrategy : ChartStrategy // Объявление класса SampleStrategy, наследующегося от ChartStrategy.
{
    private Order _order; // Объявление приватной переменной _order для хранения информации об ордере.
    private bool _firstTime = true; // Объявление приватной булевой переменной _firstTime для однократного выполнения кода.

    protected override void OnCalculate(int bar, decimal value) // Переопределение метода OnCalculate.
    {
        if (bar == CurrentBar - 1 && _firstTime) // Условие для однократного выполнения кода на первом баре.
        {
            // Here the conditions under which we need to cancel our order have been met. // Комментарий, указывающий на наступление условий для отмены ордера.
            if (_order.State == OrderStates.Active) // Проверка, что статус ордера (_order.State) равен OrderStates.Active, то есть ордер активен и может быть отменен. OrderStates.Active - это перечисление, определяющее состояние ордера.
            {
                CancelOrder(_order); // Вызов метода CancelOrder для отправки запроса на отмену ордера _order.
                _firstTime = false; // Установка _firstTime в false, чтобы код отмены не выполнялся повторно.
            }
        }
    }

    protected override void OnOrderCancelFailed(Order order, string message) // Переопределение метода OnOrderCancelFailed, вызываемого при неудачной попытке отмены ордера.
    {
        if (order == _order) // Проверка, что сбой отмены произошел именно для нашего ордера (_order).
        {
            // Here it will be clear that cancel _order did not work. // Комментарий, указывающий, что отмена ордера _order не удалась.
        }
    }

    protected override void OnOrderChanged(Order order) // Переопределение метода OnOrderChanged, вызываемого при изменении статуса ордера.
    {
        if (order == _order && order.Status() == OrderStatus.Canceled) // Проверка, что изменение статуса произошло именно для нашего ордера (_order) и статус ордера стал OrderStatus.Canceled (отменен).
        {
            // Here it will be clear that the order was successfully canceled. // Комментарий, указывающий, что ордер был успешно отменен.
        }
    }
}
```

### Использование асинхронных методов

Вы можете использовать асинхронные методы управления ордерами так же, как и синхронные, и получение результатов становится более удобным.

Теперь нет необходимости отслеживать результат в методах `OnNewOrder`, `OnOrderChanged`, `OnOrderRegisterFailed`, `OnOrderModifyFailed` и `OnOrderCancelFailed`. Открытие, отмена или изменение ордера должны быть помещены в блок `try-catch`.

Следует помнить, что результат по-прежнему может быть как успешным, так и неуспешным. Если результат был успешным, в коде ниже мы можем узнать статус ордера или выполнить другие необходимые действия. Если результат неуспешный, выбрасывается исключение, и мы можем перехватить его в блоке `catch`.

Также следует отметить, что если у вас есть активные лимитные или стоп-лимитные ордера, момент изменения их состояния или статуса можно найти в `OnOrderChanged`.

#### Размещение ордера

Использование `OpenOrderAsync`:

```csharp
using ATAS.DataFeedsCore; // Пространство имен для работы с источниками данных ATAS.
using ATAS.Strategies.Chart; // Пространство имен для создания стратегий на графике ATAS.

public class SampleStrategy : ChartStrategy // Объявление класса SampleStrategy, наследующегося от ChartStrategy.
{
    private Order _order; // Объявление приватной переменной _order для хранения информации об ордере.
    private bool _firstTime = true; // Объявление приватной булевой переменной _firstTime для однократного выполнения кода.

    protected override void OnCalculate(int bar, decimal value) // Переопределение метода OnCalculate.
    {
        if (bar == CurrentBar - 1 && _firstTime) // Условие для однократного выполнения кода на первом баре.
        {
            _firstTime = false; // Установка _firstTime в false, чтобы код не выполнялся повторно.
            _order = new Order // Создание нового объекта Order и присвоение его переменной _order.
            {
                Portfolio = Portfolio, // Установка свойства Portfolio ордера.
                Security = Security, // Установка свойства Security ордера.
                Direction = OrderDirections.Buy, // Установка направления ордера на покупку.
                Type = OrderTypes.Limit, // Установка типа ордера как лимитный.
                Price = 100, // Установка лимитной цены ордера в 100.
                QuantityToFill = 1, // Установка количества для исполнения в 1 лот.
            };
            OpenPositionAsync(_order); // Вызов асинхронного метода OpenPositionAsync для размещения ордера _order.
        }
    }

    private async Task OpenPositionAsync(Order order) // Объявление приватного асинхронного метода OpenPositionAsync, принимающего объект Order в качестве параметра. Task означает, что метод возвращает асинхронную операцию. async указывает на асинхронность метода.
    {
        try // Начало блока try-catch для обработки исключений.
        {
            await OpenOrderAsync(order); // Асинхронный вызов метода OpenOrderAsync для размещения ордера. await приостанавливает выполнение метода до завершения OpenOrderAsync.
            // If there was no error and the order was placed, below we can track the positive n // Комментарий, указывающий, что если не было ошибки и ордер был размещен, то можно отслеживать положительные результаты.
            switch (order.Status()) // Оператор switch для обработки различных статусов ордера после его (предположительного) размещения.
            {
                case OrderStatus.Placed: // Обработка статуса OrderStatus.Placed.
                    // the order is placed. // Комментарий, указывающий, что ордер размещен.
                    break; // Выход из case OrderStatus.Placed.
                case OrderStatus.Filled: // Обработка статуса OrderStatus.Filled.
                    // the order is filled. // Комментарий, указывающий, что ордер исполнен.
                    break; // Выход из case OrderStatus.Filled.
                case OrderStatus.PartlyFilled: // Обработка статуса OrderStatus.PartlyFilled.
                    // the order is partially filled. // Комментарий, указывающий, что ордер частично исполнен.
                    var unfilled = order.Unfilled; // this is an unfilled volume. // Объявление переменной unfilled и присвоение ей неисполненного объема ордера. Комментарий, поясняющий, что unfilled - это неисполненный объем.
                    break; // Выход из case OrderStatus.PartlyFilled.
            }
        }
        catch (Exception ex) // Блок catch для перехвата исключений типа Exception. ex - переменная, содержащая информацию об исключении.
        {
            // Here we find out that the order could not be opened. // Комментарий, указывающий, что в блоке catch становится известно о невозможности открытия ордера.
            // As an option, we will output an error message to the log. // Комментарий, предлагающий опцию вывода сообщения об ошибке в лог.
            this.LogInfo($"Open position error: {ex.Message}."); // Вывод сообщения об ошибке в лог ATAS. Используется интерполяция строк ($"...") для включения сообщения об исключении (ex.Message) в строку. this.LogInfo - метод для записи информации в лог ATAS.
        }
    }
}
```

#### Изменение ордера

Использование `ModifyOrderAsync`:

```csharp
using ATAS.DataFeedsCore; // Пространство имен для работы с источниками данных ATAS.
using ATAS.Strategies.Chart; // Пространство имен для создания стратегий на графике ATAS.

public class SampleStrategy : ChartStrategy // Объявление класса SampleStrategy, наследующегося от ChartStrategy.
{
    private Order _order; // Объявление приватной переменной _order для хранения информации об ордере.
    private Order _newOrder; // Объявление приватной переменной _newOrder для хранения информации о новом ордере (после модификации).
    private bool _firstTime = true; // Объявление приватной булевой переменной _firstTime для однократного выполнения кода.

    protected override void OnCalculate(int bar, decimal value) // Переопределение метода OnCalculate.
    {
        if (bar == CurrentBar - 1 && _firstTime) // Условие для однократного выполнения кода на первом баре.
        {
            // Here we receive a signal and open an order. // Комментарий, указывающий на получение сигнала и открытие ордера.
            // Here the conditions under which you need to change the order price have been met. // Комментарий, указывающий на наступление условий для изменения цены ордера.
            ChangeOrderAsync(); // Вызов асинхронного метода ChangeOrderAsync для изменения ордера.
        }
    }

    private async Task ChangeOrderAsync() // Объявление приватного асинхронного метода ChangeOrderAsync.
    {
        _newOrder = _order.Clone(); // Создание копии существующего ордера _order и присвоение ее переменной _newOrder.
        _newOrder.Price = 200; // Изменение цены в новом ордере _newOrder на 200.
        try // Начало блока try-catch для обработки исключений.
        {
            await ModifyOrderAsync(_order, _newOrder); // Асинхронный вызов метода ModifyOrderAsync для отправки запроса на изменение ордера.
            // Here we find out that the order changes were successful. // Комментарий, указывающий, что в случае успеха изменения ордера, это станет известно здесь.
        }
        catch (Exception ex) // Блок catch для перехвата исключений.
        {
            // Here we find out that the order could not be changed. // Комментарий, указывающий, что в случае ошибки изменения ордера, это станет известно здесь.
        }
    }
}
```

#### Отмена ордера

Использование `CancelOrderAsync`:

```csharp
using ATAS.DataFeedsCore; // Пространство имен для работы с источниками данных ATAS.
using ATAS.Strategies.Chart; // Пространство имен для создания стратегий на графике ATAS.

public class SampleStrategy : ChartStrategy // Объявление класса SampleStrategy, наследующегося от ChartStrategy.
{
    private Order _order; // Объявление приватной переменной _order для хранения информации об ордере.
    private bool _firstTime = true; // Объявление приватной булевой переменной _firstTime для однократного выполнения кода.

    protected override void OnCalculate(int bar, decimal value) // Переопределение метода OnCalculate.
    {
        if (bar == CurrentBar - 1 && _firstTime) // Условие для однократного выполнения кода на первом баре.
        {
            // Here the conditions under which we need to cancel our order have been met. // Комментарий, указывающий на наступление условий для отмены ордера.
            if (_order.State == OrderStates.Active) // Проверка, что статус ордера активен (OrderStates.Active).
            {
                TryCancelOrderAsync(); // Вызов асинхронного метода TryCancelOrderAsync для попытки отмены ордера.
                _firstTime = false; // Установка _firstTime в false, чтобы код отмены не выполнялся повторно.
            }
        }
    }

    private async Task TryCancelOrderAsync() // Объявление приватного асинхронного метода TryCancelOrderAsync.
    {
        try // Начало блока try-catch для обработки исключений.
        {
            await CancelOrderAsync(_order); // Асинхронный вызов метода CancelOrderAsync для отправки запроса на отмену ордера.
            // Here we know that the order was canceled successfully. // Комментарий, указывающий, что в случае успеха отмены ордера, это станет известно здесь.
        }
        catch (Exception ex) // Блок catch для перехвата исключений.
        {
            // Here we find out that the order could not be canceled. // Комментарий, указывающий, что в случае ошибки отмены ордера, это станет известно здесь.
        }
    }
}
```

### Моменты, которые следует учитывать

Поскольку API предоставляет асинхронный механизм для работы с торговыми функциями, это необходимо учитывать при разработке.

Некоторые распространенные ошибки при работе с асинхронным подходом:

* В стратегии срабатывает триггер на отмену ордера, и алгоритм вызывает `CancelOrder`. Пока ответ от биржи не поступил, триггер срабатывает снова, и алгоритм снова отправляет запрос `CancelOrder` на биржу. В результате второй запрос будет отклонен биржей.
* Стратегия запускает триггер на открытие позиции, алгоритм проверяет `CurrentPosition`, которая равна нулю, и отправляет рыночный ордер. Пока ответ от биржи не поступил, и значение позиции не обновилось, триггер срабатывает снова и отправляется еще один рыночный ордер, что в конечном итоге приводит к увеличению рисков.
* В стратегии срабатывает триггер на закрытие позиции, алгоритм проверяет `CurrentPosition`, создает ордер на закрытие объемом, равным `CurrentPositions`, и отправляет этот ордер. Пока ответ от биржи не поступил, и значение позиции не обновилось, триггер срабатывает снова и отправляется еще один рыночный ордер, что в конечном итоге приводит не к закрытию позиции, а к ее развороту.

Важно понимать, что статусы ордеров и позиции поступают асинхронно в ответ на запрос от биржи.















```
## Методичка: Пространство имен ATAS.Strategies

### 1. Обзор пространства имен ATAS.Strategies

*   **Описание:**  Пространство имен `ATAS.Strategies` содержит классы, интерфейсы, перечисления и определения типов, необходимые для разработки и реализации торговых стратегий в платформе ATAS.
    *   *Аннотация:*  `Общее описание пространства имен.  Это как папка, в которой собраны все инструменты для создания стратегий.`

### 2. Пространства имен (Namespaces)

*   **2.1. ATM**
    *   **Описание:**  Пространство имен, вероятно, связанное с автоматическим трейдингом и управлением ордерами (предположение на основе названия ATM - Automated Teller Machine в трейдинге).
    *   *Аннотация:*  `Скорее всего, здесь находятся классы для работы с автоматическим управлением позициями и ордерами.  "ATM" может означать "Автоматизированная Торговая Машина".`

*   **2.2. Chart**
    *   **Описание:**  Пространство имен, вероятно, связанное с работой с графиками и отображением данных на графиках в ATAS.
    *   *Аннотация:*  `Вероятно, содержит классы для взаимодействия с графиками, например, для отображения визуальной информации от стратегий.`

*   **2.3. Editors**
    *   **Описание:**  Пространство имен, вероятно, связанное с редакторами и инструментами для разработки и настройки стратегий в ATAS.
    *   *Аннотация:*  `Возможно, здесь находятся классы для создания пользовательских интерфейсов или инструментов для редактирования параметров стратегий.`

### 3. Классы (Classes)

*   **3.1. Интерфейс IStrategy**
    *   **Описание:**  Представляет торговую стратегию.  (Больше информации по ссылке "More...")
    *   *Аннотация:*  `Интерфейс IStrategy - это как шаблон для всех стратегий. Любая стратегия должна реализовывать этот интерфейс, чтобы быть совместимой с ATAS.`

*   **3.2. Класс Strategy**
    *   **Описание:**  Базовый класс для реализации торговых стратегий. (Больше информации по ссылке "More...")
    *   *Аннотация:*  `Класс Strategy предоставляет готовую основу для создания стратегий.  Можно наследовать от него и добавлять свою логику.  Уже содержит общую функциональность.`

*   **3.3. Класс StrategyLoggingExtensions**
    *   **Описание:**  Расширения для логирования событий стратегии.
    *   *Аннотация:*  `Этот класс, вероятно, добавляет удобные методы для записи информации о работе стратегии - логирование.  Полезно для отладки и анализа.`

*   **3.4. Класс StrategyNotificationEventArgs**
    *   **Описание:**  Предоставляет данные для события `StrategyNotification`. (Больше информации по ссылке "More...")
    *   *Аннотация:*  `Класс для передачи информации о "уведомлениях" от стратегии.  События могут быть, например, сообщения об открытии/закрытии позиции.`

*   **3.5. Класс StrategyStateChangedEventArgs**
    *   **Описание:**  Предоставляет данные для события `StrategyStateChanged`. (Больше информации по ссылке "More...")
    *   *Аннотация:*  `Класс для передачи информации об изменении состояния стратегии (запуск, остановка, ошибка и т.д.).  Связан с управлением жизненным циклом стратегии.`

### 4. Определения типов (Typedefs)

*   **4.1. BaseLoggerSource**
    *   **Описание:**  `using BaseLoggerSource = Utils.Common.Logging.BaseLoggerSource`
    *   *Аннотация:*  `Определение типа BaseLoggerSource.  Это просто другое имя для типа  `Utils.Common.Logging.BaseLoggerSource`.  Используется для логирования.`

### 5. Перечисления (Enumerations)

*   **5.1. Перечисление StrategyErrorTypes**
    *   **Описание:**  Типы ошибок стратегии.
    *   **Значения:**
        *   `MaxNumberOfErrorsExceeded`:  Превышено максимальное количество ошибок.
        *   `MaxNumberOfConnectionErrorsExceeded`: Превышено максимальное количество ошибок соединения.
        *   `PreviousOrdersNotFound`:  Предыдущие SL/TP ордера не найдены.
    *   *Аннотация:*  `Перечисление StrategyErrorTypes определяет возможные ошибки, которые может выдать стратегия.  Помогает понять, что пошло не так.  Важно для обработки ошибок.`

*   **5.2. Перечисление StrategyStates**
    *   **Описание:**  Представляет состояния торговой стратегии.
    *   **Значения:**
        *   `Stopped`:  Стратегия остановлена, не запущена и не обрабатывает сделки.
        *   `Started`:  Стратегия запущена и активно обрабатывает сделки.
        *   `Suspended`:  Стратегия приостановлена, временно остановлена или ожидает определенного события для возобновления.
        *   `Error`:  Стратегия в состоянии ошибки, временно ожидает события изменения настроек для возобновления.
        *   `Watch`:  Стратегия наблюдает за текущей позицией.
    *   *Аннотация:*  `Перечисление StrategyStates описывает различные состояния, в которых может находиться стратегия.  Управление состоянием - важная часть работы стратегии.  Например, можно проверить состояние, чтобы понять, активна ли стратегия.`

---






## Методичка по ATAS.Strategies.ATM Namespace Reference

### Classes (Классы)

**`ATMStrategy` class (класс `ATMStrategy`)** - *Базовый класс для создания ATM-стратегий.*

**`BaseStopProfitStrategy` class (класс `BaseStopProfitStrategy`)** - *Базовый класс для стратегий стоп-лосс и тейк-профит.*

**`ChangesInfo` struct (структура `ChangesInfo`)** - *Структура, содержащая информацию об изменениях параметров стратегии.*

**`Extensions` class (класс `Extensions`)** - *Класс, содержащий методы расширения для ATM-стратегий.*

**`IATMStrategy` interface (интерфейс `IATMStrategy`)** - *Интерфейс, определяющий контракт для ATM-стратегий.*

**`ISimpleStopProfitStrategy` interface (интерфейс `ISimpleStopProfitStrategy`)** - *Интерфейс для простых стратегий стоп-лосс и тейк-профит.*

**`IStopProfitSettings` interface (интерфейс `IStopProfitSettings`)** - *Интерфейс, определяющий настройки стоп-лосс и тейк-профит.*

**`IStopProfitStrategy` interface (интерфейс `IStopProfitStrategy`)** - *Интерфейс для стратегий стоп-лосс и тейк-профит.*

**`IStrategyMarketDataProvider` interface (интерфейс `IStrategyMarketDataProvider`)** - *Интерфейс для поставщиков рыночных данных для стратегий.*

**`ISupportCustomStopOrTake` interface (интерфейс `ISupportCustomStopOrTake`)** - *Интерфейс для поддержки пользовательских стопов и тейков.*

**`StopProfit` class (класс `StopProfit`)** - *Класс, представляющий стоп-лосс или тейк-профит.*

### Enumerations (Перечисления)

**`StopTakeValueTypes` enum (перечисление `StopTakeValueTypes`)** - *Перечисление, определяющее типы значений для стоп-лосс и тейк-профит (тики или проценты).*
    * `Ticks` - *Значение в тиках.*
    * `Percent` - *Значение в процентах.*

### Functions (Функции)

**`StrategyOrderId()` function (функция `StrategyOrderId()`)** - *Функция (точнее, структура readonly record struct), представляющая идентификатор ордера стратегии.*
    * `readonly record struct StrategyOrderId (long ExtId, string Id)` - *Определение структуры `StrategyOrderId`, содержащей:*
        * `long ExtId` - *Внешний идентификатор ордера (числовой).*
        * `string Id` - *Строковый идентификатор ордера.*

**`BaseStopProfitSettings()` function (функция `BaseStopProfitSettings()`)** - *Функция (точнее, record), представляющая настройки базового стоп-лосс и тейк-профит.*
    * `BaseStopProfitSettings (TimeInForce timeInForce)` - *Конструктор `BaseStopProfitSettings`, принимающий:*
        * `TimeInForce timeInForce` - *Тип времени действия ордера (например, Day, GTC).*

**`Deconstruct()` function [1/2] (функция `Deconstruct()` [1/2])** - *Функция деконструкции для различных настроек стоп-лосс и тейк-профит (первая перегрузка).*
    * `void Deconstruct (out StopProfitSettings StopLoss, out StopProfitSettings TakeProfit, out BreakevenSettings Breakeven, out TrailingStopSettings Trailing, out StrategyOrderId? StopOrderId, out StrategyOrderId? TakeOrderId, out PriceUnit? CurrentStop, out PriceUnit? CurrentTake, out TimeInForce TimeInForce)` - *Метод деконструкции, который "разбирает" объект на отдельные части, возвращая:*
        * `out StopProfitSettings StopLoss` - *Настройки стоп-лосса.*
        * `out StopProfitSettings TakeProfit` - *Настройки тейк-профита.*
        * `out BreakevenSettings Breakeven` - *Настройки безубытка.*
        * `out TrailingStopSettings Trailing` - *Настройки трейлинг-стопа.*
        * `out StrategyOrderId? StopOrderId` - *Идентификатор ордера стоп-лосса (может быть null).*
        * `out StrategyOrderId? TakeOrderId` - *Идентификатор ордера тейк-профита (может быть null).*
        * `out PriceUnit? CurrentStop` - *Текущая цена стоп-лосса (может быть null).*
        * `out PriceUnit? CurrentTake` - *Текущая цена тейк-профита (может быть null).*
        * `out TimeInForce TimeInForce` - *Тип времени действия ордера.*

**`Deconstruct()` function [2/2] (функция `Deconstruct()` [2/2])** - *Функция деконструкции для типа времени действия ордера (вторая перегрузка).*
    * `void Deconstruct (out TimeInForce TimeInForce )` - *Метод деконструкции, возвращающий:*
        * `out TimeInForce TimeInForce` - *Тип времени действия ордера.*

**`SimpleStopProfitSettings()` function [1/3] (функция `SimpleStopProfitSettings()` [1/3])** - *Функция (точнее, конструктор) для создания простых настроек стоп-лосс и тейк-профит (первая перегрузка).*
    * `SimpleStopProfitSettings (StopProfitSettings stopLoss, StopProfitSettings takeProfit, BreakevenSettings breakeven, TrailingStopSettings trailing)` - *Конструктор, принимающий:*
        * `StopProfitSettings stopLoss` - *Настройки стоп-лосса.*
        * `StopProfitSettings takeProfit` - *Настройки тейк-профита.*
        * `BreakevenSettings breakeven` - *Настройки безубытка.*
        * `TrailingStopSettings trailing` - *Настройки трейлинг-стопа.*

**`SimpleStopProfitSettings()` function [2/3] (функция `SimpleStopProfitSettings()` [2/3])** - *Функция (точнее, конструктор) для создания простых настроек стоп-лосс и тейк-профит с идентификаторами ордеров (вторая перегрузка).*
    * `SimpleStopProfitSettings (StopProfitSettings stopLoss, StopProfitSettings takeProfit, BreakevenSettings breakeven, TrailingStopSettings trailing, StrategyOrderId? stopOrderId, StrategyOrderId? takeOrderId)` - *Конструктор, принимающий параметры из предыдущей перегрузки, а также:*
        * `StrategyOrderId? stopOrderId` - *Идентификатор ордера стоп-лосса (может быть null).*
        * `StrategyOrderId? takeOrderId` - *Идентификатор ордера тейк-профита (может быть null).*

**`SimpleStopProfitSettings()` function [3/3] (функция `SimpleStopProfitSettings()` [3/3])** - *Функция (точнее, конструктор) для создания полных настроек стоп-лосс и тейк-профит, включая текущие цены и время действия (третья перегрузка).*
    * `SimpleStopProfitSettings (StopProfitSettings stopLoss, StopProfitSettings takeProfit, BreakevenSettings breakeven, TrailingStopSettings trailing, StrategyOrderId? stopOrderId, StrategyOrderId? takeOrderId, PriceUnit? currentStop, PriceUnit? currentTake, TimeInForce timeInForce)` - *Конструктор, принимающий параметры из предыдущих перегрузок, а также:*
        * `PriceUnit? currentStop` - *Текущая цена стоп-лосса (может быть null).*
        * `PriceUnit? currentTake` - *Текущая цена тейк-профита (может быть null).*
        * `TimeInForce timeInForce` - *Тип времени действия ордера.*

**`StopProfitSettings()` function (функция `StopProfitSettings()`)** - *Функция (точнее, record), представляющая базовые настройки стоп-лосс или тейк-профит.*
    * `StopProfitSettings (bool IsEnabled, PriceUnit Value)` - *Конструктор `StopProfitSettings`, принимающий:*
        * `bool IsEnabled` - *Флаг, указывающий, включен ли стоп-лосс/тейк-профит.*
        * `PriceUnit Value` - *Значение стоп-лосса/тейк-профита (в тиках или процентах, в зависимости от `StopTakeValueTypes`).*

**`BreakevenSettings()` function (функция `BreakevenSettings()`)** - *Функция (точнее, record), представляющая настройки безубытка.*
    * `BreakevenSettings (bool IsEnabled, PriceUnit Breakeven, PriceUnit Offset)` - *Конструктор `BreakevenSettings`, принимающий:*
        * `bool IsEnabled` - *Флаг, указывающий, включен ли безубыток.*
        * `PriceUnit Breakeven` - *Уровень безубытка.*
        * `PriceUnit Offset` - *Смещение от уровня безубытка.*

**`TrailingStopSettings()` function (функция `TrailingStopSettings()`)** - *Функция (точнее, record), представляющая настройки трейлинг-стопа.*
    * `TrailingStopSettings (bool IsEnabled, PriceUnit Step, PriceUnit Stop)` - *Конструктор `TrailingStopSettings`, принимающий:*
        * `bool IsEnabled` - *Флаг, указывающий, включен ли трейлинг-стоп.*
        * `PriceUnit Step` - *Шаг трейлинг-стопа.*
        * `PriceUnit Stop` - *Уровень активации трейлинг-стопа.*

**`ToString()` function (функция `ToString()`)** - *Функция для преобразования объекта в строковое представление.*
    * `override string ToString()` - *Переопределенный метод `ToString()`, возвращающий строковое представление объекта.*

### Variables (Переменные)

**`BaseStopProfitSettings` variable (переменная `BaseStopProfitSettings`)** - *Переменная типа `BaseStopProfitSettings`.*
    * `record BaseStopProfitSettings` - *Объявление переменной типа record `BaseStopProfitSettings`.*
    * `init` - *Инициализатор, возможно, для установки начальных значений.*
    * `ATAS.Strategies.ATM.init` - *Указывает на пространство имен, где определена переменная.*

**`SimpleStopProfitSettings` variable (переменная `SimpleStopProfitSettings`)** - *Переменная типа `SimpleStopProfitSettings`.*
    * `record SimpleStopProfitSettings` - *Объявление переменной типа record `SimpleStopProfitSettings`.*

### Enumeration Type Documentation (Документация по типу перечисления)

**`StopTakeValueTypes`** - *Документация для перечисления `StopTakeValueTypes`.*




## Методичка по классу `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` для разработки стратегий на платформе ATAS

### Общая информация

**Название класса:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`

**Тип:** Шаблон класса (Class Template Reference)

**Абстрактный:** Да (abstract)

**Диаграмма наследования:**

```
INotifyPropertyChanged
    BaseLoggerSource
        IStrategy
            Strategy
                IATMStrategy
                    ATAS.Strategies.ATM.ATMStrategy< TStrategy >
                        ATAS.Strategies.ATM.BaseStopProfitStrategy< TStrategy, TSettings >
```

**Диаграмма коллаборации:**

```
INotifyPropertyChanged
    BaseLoggerSource
        IStrategy
            Strategy
                IATMStrategy
                    ATAS.Strategies.ATM.ATMStrategy< TStrategy >
```

### Public Member Functions (Публичные методы)

*   **`Task RetryAsync()`**
*   **`Task CancelAsync()`**
*   **`Task ResetOrdersAsync()`**
*   **`Task CancelOrdersAsync (IEnumerable< Order > orders)`**
*   **`bool IsStopLoss (Order order)`**
*   **`bool IsTakeProfit (Order order)`**
*   **`IATMStrategy Clone (bool cloneOrders=true)`**
*   **`void SetSettings (IStopProfitSettings settings)`**
*   **`IStopProfitSettings GetSettings ()`**
*   **`bool IEnumerable< string > Errors IsValidSettings (IStopProfitSettings settings, decimal? expectedPositionVolume=null, decimal? expectedPositionPrice=null)`**

**Наследованные Public Member Functions от `ATAS.Strategies.Strategy`:**

*   **`Task StartAsync()`**
    *   Описание: Запускает стратегию, позволяя ей выполнять свою торговую логику.
*   **`Task StopAsync()`**
    *   Описание: Останавливает стратегию, завершая ее выполнение и освобождая любые ресурсы.

**Наследованные Public Member Functions от `ATAS.Strategies.ATM.IATMStrategy`**

### Public Attributes (Публичные атрибуты)

*   **`bool IsValid`**

**Наследованные Public Attributes от `ATAS.Strategies.ATM.IATMStrategy`**

### Protected Member Functions (Защищенные методы)

*   **`virtual Task OnRetry ()`**
*   **`virtual Task OnCancel ()`**
*   **`virtual Task OnResetOrders ()`**
*   **`virtual TStrategy CreateNew ()`**
*   **`virtual void CommitChanges (TStrategy model, bool cloneOrders)`**
*   **`abstract Task OnCancelOrdersAsync (IEnumerable< Order > orders)`**
*   **`abstract bool IsStopOrder (Order order)`**
*   **`abstract bool IsTakeOrder (Order order)`**
*   **`abstract void OnSetStopProfitSettings (IStopProfitSettings settings)`**
*   **`abstract IStopProfitSettings OnGetStopProfitSettings ()`**
*   **`abstract bool IEnumerable< string > Errors OnIsValidStopProfitSettings (IStopProfitSettings settings, decimal? positionVolume, decimal? positionPrice)`**
*   **`void RaiseSettingsChanged ()`**
*   **`void ThrowIfNotStarted ()`**
*   **`override bool CanUpdateCurrentPosition (Position position)`**
    *   Описание: Проверяет, можно ли обновить текущую позицию указанной позицией.
*   **`override void LogParameters ()`**
    *   Описание: Логирует текущие параметры.

**Наследованные Protected Member Functions от `ATAS.Strategies.Strategy`**

### Protected Attributes (Защищенные атрибуты)

*   **`abstract bool IsValid`**

### Properties (Свойства)

*   **`abstract bool HasActiveOrders [get]`**
*   **`IStrategy MarketDataProvider MarketDataProvider [get, set]`**
*   **`TimeInForce TimeInForce [get, set]`**

**Наследованные Properties от `ATAS.Strategies.Strategy`**

**Наследованные Properties от `ATAS.Strategies.IStrategy`**

**Наследованные Properties от `ATAS.Strategies.ATM.IATMStrategy`**

### Events (События)

*   **`EventHandler< EventArgs > SettingsChanged`**

**Наследованные Events от `ATAS.Strategies.Strategy`**

**Наследованные Events от `ATAS.Strategies.IStrategy`**

**Наследованные Events от `ATAS.Strategies.ATM.IATMStrategy`**

### Member Function Documentation (Документация методов)

*   **`CancelAsync()`**
    *   `Task ATAS.Strategies.ATM.ATMStrategy< TStrategy >.CancelAsync()`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`CancelOrdersAsync()`**
    *   `Task ATAS.Strategies.ATM.ATMStrategy < TStrategy >.CancelOrdersAsync (IEnumerable< Order > orders)`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`CanUpdateCurrentPosition()`**
    *   `override bool ATAS.Strategies.ATM.ATMStrategy < TStrategy >.CanUpdateCurrentPosition (Position position)`
    *   Защищенный, виртуальный метод.
    *   Описание: Проверяет, можно ли обновить текущую позицию указанной позицией.
    *   **Параметры:**
        *   `position`: Позиция для сравнения с текущей позицией.
    *   **Возвращает:**
        *   `true`, если текущая позиция может быть обновлена; иначе, `false`.
    *   Реализован из: `ATAS.Strategies.Strategy`.
*   **`Clone()`**
    *   `IATMStrategy ATAS.Strategies.ATM.ATMStrategy< TStrategy >.Clone (bool cloneOrders = true)`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`CommitChanges()`**
    *   `virtual void ATAS.Strategies.ATM.ATMStrategy< TStrategy >.CommitChanges (TStrategy model, bool cloneOrders)`
    *   Защищенный, виртуальный метод.
*   **`CreateNew()`**
    *   `virtual TStrategy ATAS.Strategies.ATM.ATMStrategy < TStrategy >.CreateNew ()`
    *   Защищенный, виртуальный метод.
*   **`GetSettings()`**
    *   `IStopProfitSettings ATAS.Strategies.ATM.ATMStrategy< TStrategy >.GetSettings( )`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`IsStopLoss()`**
    *   `bool ATAS.Strategies.ATM.ATMStrategy < TStrategy >.IsStopLoss (Order order)`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`IsStopOrder()`**
    *   `abstract bool ATAS.Strategies.ATM.ATMStrategy< TStrategy >.IsStopOrder (Order order)`
    *   Защищенный, чисто виртуальный метод.
*   **`IsTakeOrder()`**
    *   `abstract bool ATAS.Strategies.ATM.ATMStrategy < TStrategy >.IsTakeOrder (Order order)`
    *   Защищенный, чисто виртуальный метод.
*   **`IsTakeProfit()`**
    *   `bool ATAS.Strategies.ATM.ATMStrategy< TStrategy >.IsTakeProfit (Order order)`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`IsValidSettings()`**
    *   `bool IEnumerable< string > Errors ATAS.Strategies.ATM.ATMStrategy< TStrategy >.IsValidSettings (IStopProfitSettings settings, decimal? expectedPositionVolume = null, decimal? expectedPositionPrice = null)`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`LogParameters()`**
    *   `override void ATAS.Strategies.ATM.ATMStrategy< TStrategy >.LogParameters( )`
    *   Защищенный, виртуальный метод.
    *   Описание: Логирует текущие параметры.
    *   Реализован из: `ATAS.Strategies.Strategy`.
*   **`OnCancel()`**
    *   `virtual Task ATAS.Strategies.ATM.ATMStrategy< TStrategy >.OnCancel ()`
    *   Защищенный, виртуальный метод.
    *   Реализован в: `ATAS.Strategies.ATM.BaseStopProfitStrategy< TStrategy, TSettings >`.
*   **`OnCancelOrdersAsync()`**
    *   `abstract Task ATAS.Strategies.ATM.ATMStrategy < TStrategy >.OnCancelOrdersAsync (IEnumerable< Order > orders)`
    *   Защищенный, чисто виртуальный метод.
    *   Реализован в: `ATAS.Strategies.ATM.BaseStopProfitStrategy< TStrategy, TSettings >`.
*   **`OnGetStopProfitSettings()`**
    *   `abstract IStopProfitSettings ATAS.Strategies.ATM.ATMStrategy < TStrategy >.OnGetStopProfitSettings ()`
    *   Защищенный, чисто виртуальный метод.
    *   Реализован в: `ATAS.Strategies.ATM.BaseStopProfitStrategy< TStrategy, TSettings >`.
*   **`OnIsValidStopProfitSettings()`**
    *   `abstract bool IEnumerable< string > Errors ATAS.Strategies.ATM.ATMStrategy< TStrategy >.OnIsValidStopProfitSettings (IStopProfitSettings settings, decimal? positionVolume, decimal? positionPrice)`
    *   Защищенный метод.
*   **`OnResetOrders()`**
    *   `virtual Task ATAS.Strategies.ATM.ATMStrategy< TStrategy >.OnResetOrders ()`
    *   Защищенный, виртуальный метод.
    *   Реализован в: `ATAS.Strategies.ATM.BaseStopProfitStrategy < TStrategy, TSettings >`.
*   **`OnRetry()`**
    *   `virtual Task ATAS.Strategies.ATM.ATMStrategy< TStrategy >.OnRetry( )`
    *   Защищенный, виртуальный метод.
    *   Реализован в: `ATAS.Strategies.ATM.BaseStopProfitStrategy < TStrategy, TSettings >`.
*   **`OnSetStopProfitSettings()`**
    *   `abstract void ATAS.Strategies.ATM.ATMStrategy< TStrategy >.OnSetStopProfitSettings (IStopProfitSettings settings)`
    *   Защищенный, чисто виртуальный метод.
    *   Реализован в: `ATAS.Strategies.ATM.BaseStopProfitStrategy < TStrategy, TSettings >`.
*   **`RaiseSettingsChanged()`**
    *   `void ATAS.Strategies.ATM.ATMStrategy< TStrategy >.RaiseSettingsChanged()`
    *   Защищенный метод.
*   **`ResetOrdersAsync()`**
    *   `Task ATAS.Strategies.ATM.ATMStrategy< TStrategy >.ResetOrdersAsync ( )`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`RetryAsync()`**
    *   `Task ATAS.Strategies.ATM.ATMStrategy < TStrategy >.RetryAsync()`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`SetSettings()`**
    *   `void ATAS.Strategies.ATM.ATMStrategy < TStrategy >.SetSettings (IStopProfitSettings settings)`
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`ThrowIfNotStarted()`**
    *   `void ATAS.Strategies.ATM.ATMStrategy< TStrategy >.ThrowIfNotStarted ( )`
    *   Защищенный метод.

### Member Data Documentation (Документация данных-членов)

*   **`IsValid [1/2]`**
    *   `bool ATAS.Strategies.ATM.ATMStrategy < TStrategy >.IsValid`
*   **`IsValid [2/2]`**
    *   `abstract bool ATAS.Strategies.ATM.ATMStrategy< TStrategy >.IsValid`
    *   Защищенный атрибут.

### Property Documentation (Документация свойств)

*   **`HasActiveOrders`**
    *   `abstract bool ATAS.Strategies.ATM.ATMStrategy< TStrategy >.HasActiveOrders`
    *   \[get]
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`MarketDataProvider`**
    *   `IStrategy MarketDataProvider ATAS.Strategies.ATM.ATMStrategy < TStrategy >.MarketDataProvider`
    *   \[get, set]
    *   Реализует: `ATAS.Strategies.ATM.IATMStrategy`.
*   **`TimeInForce`**
    *   `TimeInForce ATAS.Strategies.ATM.ATMStrategy< TStrategy >.TimeInForce`
    *   \[get, set]

### Event Documentation (Документация событий)

*   **`SettingsChanged`**
    *   `EventHandler<EventArgs> ATAS.Strategies.ATM.ATMStrategy < TStrategy >.SettingsChanged`

### Файл, в котором сгенерирована документация класса:

*   `ATMStrategy.cs`







## Методичка по классу `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`

**Описание класса:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>` - абстрактный класс-шаблон стратегии.

**Диаграмма наследования:**

```
INotifyPropertyChanged
    BaseLoggerSource
        IStrategy
            Strategy
                IATMStrategy
                    ATMStrategy<TStrategy>
                        IStopProfitStrategy<TSettings>
                            ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>
```

**Диаграмма взаимодействия:**

```
INotifyPropertyChanged
    BaseLoggerSource
        IStrategy
            Strategy
                IATMStrategy
                    ATMStrategy<TStrategy>
                        IStopProfitStrategy<TSettings>
                            ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>
```

### **Public Member Functions (Публичные методы)**

*   `void SetSettings(TSettings settings)`
    *   **Описание:** Устанавливает настройки стратегии.
    *   **Параметры:**
        *   `TSettings settings`:  Объект настроек типа `TSettings`.

*   `new TSettings GetSettings()`
    *   **Описание:** Возвращает текущие настройки стратегии.
    *   **Возвращаемое значение:** Объект настроек типа `TSettings`.

*   `bool IEnumerable<string> Errors IsValidSettings(TSettings settings, decimal? expectedPositionVolume = null, decimal? expectedPositionPrice = null)`
    *   **Описание:** Проверяет валидность предоставленных настроек стратегии.
    *   **Параметры:**
        *   `TSettings settings`: Объект настроек для проверки.
        *   `decimal? expectedPositionVolume = null`: Ожидаемый объем позиции (опционально).
        *   `decimal? expectedPositionPrice = null`: Ожидаемая цена позиции (опционально).
    *   **Возвращаемое значение:**
        *   `bool`: `true`, если настройки валидны, `false` в противном случае.
        *   `IEnumerable<string> Errors`: Список ошибок, если настройки не валидны.

**► Public Member Functions inherited from `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`**
    *   *Унаследованные публичные методы от класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`*

**► Public Member Functions inherited from `ATAS.Strategies.Strategy`**
    *   *Унаследованные публичные методы от класса `ATAS.Strategies.Strategy`*
    *   `Task StartAsync()`
        *   **Описание:** Запускает стратегию, позволяя ей выполнять свою торговую логику.
        *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию запуска.
    *   `Task StopAsync()`
        *   **Описание:** Останавливает стратегию, завершая ее выполнение и освобождая ресурсы.
        *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию остановки.

**► Public Member Functions inherited from `ATAS.Strategies.ATM.IATMStrategy`**
    *   *Унаследованные публичные методы от интерфейса `ATAS.Strategies.ATM.IATMStrategy`*
    *   `void SetSettings(TSettings settings)`
        *   **Описание:** Устанавливает настройки ATM стратегии.
        *   **Параметры:**
            *   `TSettings settings`: Объект настроек типа `TSettings`.
    *   `new TSettings GetSettings()`
        *   **Описание:** Возвращает текущие настройки ATM стратегии.
        *   **Возвращаемое значение:** Объект настроек типа `TSettings`.
    *   `bool IEnumerable<string> Errors IsValidSettings(TSettings settings, decimal? expectedPositionVolume = null, decimal? expectedPositionPrice = null)`
        *   **Описание:** Проверяет валидность настроек ATM стратегии.
        *   **Параметры:**
            *   `TSettings settings`: Объект настроек для проверки.
            *   `decimal? expectedPositionVolume = null`: Ожидаемый объем позиции (опционально).
            *   `decimal? expectedPositionPrice = null`: Ожидаемая цена позиции (опционально).
        *   **Возвращаемое значение:**
            *   `bool`: `true`, если настройки валидны, `false` в противном случае.
            *   `IEnumerable<string> Errors`: Список ошибок, если настройки не валидны.

### **Public Attributes (Публичные атрибуты)**

*   `bool IsValid`
    *   **Описание:**  Указывает, является ли стратегия валидной.

**► Public Attributes inherited from `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`**
    *   *Унаследованные публичные атрибуты от класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`*

**► Public Attributes inherited from `ATAS.Strategies.ATM.IATMStrategy`**
    *   *Унаследованные публичные атрибуты от интерфейса `ATAS.Strategies.ATM.IATMStrategy`*

**► Public Attributes inherited from `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>`**
    *   *Унаследованные публичные атрибуты от интерфейса `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>`*

### **Protected Member Functions (Защищенные методы)**

*   `async Task ProcessAfterDelay(TimeSpan? delay = null)`
    *   **Описание:** Асинхронно выполняет процесс после заданной задержки.
    *   **Параметры:**
        *   `TimeSpan? delay = null`:  Время задержки (опционально, по умолчанию `null`).
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию.

*   `void Process(bool isPositionChanged = false, bool isordersChanged = false, bool isSettingsChanged = false)`
    *   **Описание:** Обрабатывает логику стратегии.
    *   **Параметры:**
        *   `bool isPositionChanged = false`:  Указывает, изменилась ли позиция (опционально, по умолчанию `false`).
        *   `bool isordersChanged = false`: Указывает, изменились ли ордера (опционально, по умолчанию `false`).
        *   `bool isSettingsChanged = false`: Указывает, изменились ли настройки (опционально, по умолчанию `false`).

*   `decimal GetPriceValue(decimal price, PriceUnit value, decimal sign)`
    *   **Описание:** Получает значение цены с учетом единицы измерения и знака.
    *   **Параметры:**
        *   `decimal price`: Цена.
        *   `PriceUnit value`: Единица измерения цены.
        *   `decimal sign`: Знак цены.
    *   **Возвращаемое значение:** Рассчитанное значение цены типа `decimal`.

*   `bool IsEquals(Order first, Order second, bool isStop, bool comparePrices)`
    *   **Описание:** Сравнивает два ордера на равенство.
    *   **Параметры:**
        *   `Order first`: Первый ордер для сравнения.
        *   `Order second`: Второй ордер для сравнения.
        *   `bool isStop`: Указывает, является ли ордер стоп-ордером.
        *   `bool comparePrices`: Указывает, нужно ли сравнивать цены ордеров.
    *   **Возвращаемое значение:** `true`, если ордера равны, `false` в противном случае.

*   `Order TryAttachOrder(string type, Order order, StrategyOrderId orderId, string prefix)`
    *   **Описание:** Пытается прикрепить ордер к стратегии.
    *   **Параметры:**
        *   `string type`: Тип ордера.
        *   `Order order`: Ордер для прикрепления.
        *   `StrategyOrderId orderId`: Идентификатор стратегии ордера.
        *   `string prefix`: Префикс для ордера.
    *   **Возвращаемое значение:** Прикрепленный `Order` или `null` в случае неудачи.

*   `Order CreateStopOrder(OrderDirections direction, decimal sl, decimal volume, string prefix)`
    *   **Описание:** Создает стоп-ордер.
    *   **Параметры:**
        *   `OrderDirections direction`: Направление ордера (`Buy` или `Sell`).
        *   `decimal sl`: Стоп-лосс уровень.
        *   `decimal volume`: Объем ордера.
        *   `string prefix`: Префикс для ордера.
    *   **Возвращаемое значение:** Созданный `Order` стоп-ордер.

*   `Order CreateTakeOrder(OrderDirections direction, decimal tp, decimal volume, string prefix)`
    *   **Описание:** Создает тейк-профит ордер.
    *   **Параметры:**
        *   `OrderDirections direction`: Направление ордера (`Buy` или `Sell`).
        *   `decimal tp`: Тейк-профит уровень.
        *   `decimal volume`: Объем ордера.
        *   `string prefix`: Префикс для ордера.
    *   **Возвращаемое значение:** Созданный `Order` тейк-профит ордер.

*   `async Task<bool> TryCancelStopOrTake(string type, Order order, string message, string prefix, bool retryOnError)`
    *   **Описание:** Пытается отменить стоп-ордер или тейк-профит ордер.
    *   **Параметры:**
        *   `string type`: Тип ордера.
        *   `Order order`: Ордер для отмены.
        *   `string message`: Сообщение об отмене.
        *   `string prefix`: Префикс для ордера.
        *   `bool retryOnError`: Указывает, нужно ли повторять попытку отмены при ошибке.
    *   **Возвращаемое значение:** `true`, если отмена успешна, `false` в противном случае.

*   `async Task<Order> TryProcessStopOrTake(string type, Order oldOrder, OrderDirections direction, PriceUnit? currentValue, int positionSign, decimal volume, string prefix, bool isPositionChanged)`
    *   **Описание:** Пытается обработать стоп-ордер или тейк-профит ордер.
    *   **Параметры:**
        *   `string type`: Тип ордера.
        *   `Order oldOrder`: Старый ордер.
        *   `OrderDirections direction`: Направление ордера.
        *   `PriceUnit? currentValue`: Текущее значение цены (опционально).
        *   `int positionSign`: Знак позиции.
        *   `decimal volume`: Объем ордера.
        *   `string prefix`: Префикс для ордера.
        *   `bool isPositionChanged`: Указывает, изменилась ли позиция.
    *   **Возвращаемое значение:** Обработанный `Order` или `null` в случае неудачи.

*   `async Task<bool> TryCancelSecondOrder(string type, Order order, string prefix)`
    *   **Описание:** Пытается отменить второй ордер.
    *   **Параметры:**
        *   `string type`: Тип ордера.
        *   `Order order`: Ордер для отмены.
        *   `string prefix`: Префикс для ордера.
    *   **Возвращаемое значение:** `true`, если отмена успешна, `false` в противном случае.

*   `void ResetCustomStopAndTakePrices()`
    *   **Описание:** Сбрасывает пользовательские цены стоп-лосса и тейк-профита.

*   `void ResetWatchState()`
    *   **Описание:** Сбрасывает состояние наблюдения стратегии.

*   `virtual void OnProcessOrder(Order order)`
    *   **Описание:** Виртуальный метод, вызывается при обработке ордера. Может быть переопределен в производных классах для добавления пользовательской логики обработки ордеров.
    *   **Параметры:**
        *   `Order order`: Обрабатываемый ордер.

*   `abstract Task OnCancelAll(bool retryOnError)`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для отмены всех ордеров.
    *   **Параметры:**
        *   `bool retryOnError`: Указывает, нужно ли повторять попытку отмены при ошибке.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию отмены всех ордеров.

*   `abstract Task<bool> OnCancelSecondOrder(Order order)`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для отмены второго ордера.
    *   **Параметры:**
        *   `Order order`: Второй ордер для отмены.
    *   **Возвращаемое значение:** `Task<bool>`, представляющий асинхронную операцию отмены второго ордера и возвращающий `true` в случае успеха, `false` в противном случае.

*   `abstract Task OnProcess(ChangesInfo info)`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для обработки изменений состояния стратегии.
    *   **Параметры:**
        *   `ChangesInfo info`: Информация об изменениях.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию обработки изменений.

*   `abstract void OnResetCustomStopAndTakePrices()`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для сброса пользовательских цен стоп-лосса и тейк-профита.

*   `abstract void OnResetStopTakeOrderId()`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для сброса идентификатора стоп-лосса и тейк-профита.

*   `abstract void DisableStopAndTake()`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для отключения стоп-лосса и тейк-профита.

*   `abstract void OnAttachStopAndTakeOrdersFailed()`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для обработки ситуации, когда не удалось прикрепить стоп-лосс и тейк-профит ордера.

*   `abstract bool SetStopOrTakeCustomPrice(Order currentStopOrTake, Order newOrder)`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для установки пользовательской цены стоп-лосса или тейк-профита.
    *   **Параметры:**
        *   `Order currentStopOrTake`: Текущий стоп-лосс или тейк-профит ордер.
        *   `Order newOrder`: Новый ордер.
    *   **Возвращаемое значение:** `bool`, указывающий на успех установки пользовательской цены.

*   `abstract bool SetStopOrTakeCancelledManually(Order order, string type)`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для установки флага ручной отмены стоп-лосса или тейк-профита.
    *   **Параметры:**
        *   `Order order`: Ордер, который был отменен вручную.
        *   `string type`: Тип ордера.
    *   **Возвращаемое значение:** `bool`, указывающий на успех установки флага ручной отмены.

*   `abstract void OnSetSettings(TSettings settings)`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для обработки установки настроек стратегии.
    *   **Параметры:**
        *   `TSettings settings`: Новые настройки стратегии.

*   `abstract TSettings OnGetSettings()`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для получения настроек стратегии.
    *   **Возвращаемое значение:** Текущие настройки стратегии типа `TSettings`.

*   `abstract ICollection<string> OnIsValidSettings(TSettings settings, decimal positionVolume, decimal positionPrice, decimal currentPrice)`
    *   **Описание:** Абстрактный метод, должен быть реализован в производных классах для проверки валидности настроек стратегии с дополнительными параметрами.
    *   **Параметры:**
        *   `TSettings settings`: Проверяемые настройки стратегии.
        *   `decimal positionVolume`: Объем позиции.
        *   `decimal positionPrice`: Цена позиции.
        *   `decimal currentPrice`: Текущая цена.
    *   **Возвращаемое значение:** Коллекция строк с ошибками валидации (если есть).

*   `override async Task OnStarted()`
    *   **Описание:** Переопределенный метод, вызывается при запуске стратегии из состояния `StrategyStates.Stopped`.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию запуска.

*   `override async Task OnStartedFromWatch()`
    *   **Описание:** Переопределенный метод, вызывается при запуске стратегии из состояния `StrategyStates.Watch`.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию запуска из режима наблюдения.

*   `override async Task OnStopping()`
    *   **Описание:** Переопределенный метод, вызывается при остановке стратегии.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию остановки.

*   `override Task OnRetry()`
    *   **Описание:** Переопределенный метод, вызывается при попытке повтора операции.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию повтора.

*   `override async Task OnCancel()`
    *   **Описание:** Переопределенный метод, вызывается при отмене операции.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию отмены.

*   `override Task OnResetOrders()`
    *   **Описание:** Переопределенный метод, вызывается при сбросе ордеров.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию сброса ордеров.

*   `override void OnCurrentPositionChanged()`
    *   **Описание:** Переопределенный метод, вызывается при изменении объема текущей позиции.

*   `override async Task OnModifyOrder(Order order, Order newOrder, bool isAutomated)`
    *   **Описание:** Переопределенный метод, вызывается при изменении существующего ордера.
    *   **Параметры:**
        *   `Order order`: Исходный ордер.
        *   `Order newOrder`: Новый ордер с измененными параметрами.
        *   `bool isAutomated`: Флаг, указывающий, было ли изменение ордера автоматическим.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию изменения ордера.

*   `override async Task OnCancelOrder(Order order, bool isAutomated)`
    *   **Описание:** Переопределенный метод, вызывается при отмене ордера.
    *   **Параметры:**
        *   `Order order`: Отмененный ордер.
        *   `bool isAutomated`: Флаг, указывающий, была ли отмена ордера автоматической.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию отмены ордера.

*   `override async Task OnCancelOrdersAsync(IEnumerable<Order> orders)`
    *   **Описание:** Переопределенный метод, вызывается для асинхронной отмены нескольких ордеров.
    *   **Параметры:**
        *   `IEnumerable<Order> orders`: Коллекция ордеров для отмены.
    *   **Возвращаемое значение:** `Task`, представляющий асинхронную операцию отмены нескольких ордеров.

*   `override void OnNewOrder(Order order)`
    *   **Описание:** Переопределенный метод, вызывается при добавлении нового ордера.
    *   **Параметры:**
        *   `Order order`: Новый добавленный ордер.

*   `override void OnOrderChanged(Order order)`
    *   **Описание:** Переопределенный метод, вызывается при изменении существующего ордера.
    *   **Параметры:**
        *   `Order order`: Измененный ордер.

*   `override void OnSetStopProfitSettings(IStopProfitSettings settings)`
    *   **Описание:** Переопределенный метод, вызывается при установке настроек стоп-профита.
    *   **Параметры:**
        *   `IStopProfitSettings settings`: Новые настройки стоп-профита.

*   `override IStopProfitSettings OnGetStopProfitSettings()`
    *   **Описание:** Переопределенный метод, вызывается для получения настроек стоп-профита.
    *   **Возвращаемое значение:** Текущие настройки стоп-профита типа `IStopProfitSettings`.

*   `override (bool IsValid, IEnumerable<string> Errors) OnIsValidStopProfitSettings(IStopProfitSettings settings)`
    *   **Описание:** Переопределенный метод, вызывается для проверки валидности настроек стоп-профита.
    *   **Параметры:**
        *   `IStopProfitSettings settings`: Проверяемые настройки стоп-профита.
    *   **Возвращаемое значение:** Кортеж, содержащий:
        *   `bool IsValid`: `true`, если настройки валидны, `false` в противном случае.
        *   `IEnumerable<string> Errors`: Список ошибок, если настройки не валидны.

**► Protected Member Functions inherited from `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`**
    *   *Унаследованные защищенные методы от класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`*

**► Protected Member Functions inherited from `ATAS.Strategies.Strategy`**
    *   *Унаследованные защищенные методы от класса `ATAS.Strategies.Strategy`*

### **Properties (Свойства)**

*   `abstract bool IsStopOrderAttached { get; }`
    *   **Описание:** Абстрактное свойство, должно быть реализовано в производных классах. Возвращает `true`, если стоп-ордер прикреплен, `false` в противном случае. (Только чтение)

*   `abstract bool IsTakeOrderAttached { get; }`
    *   **Описание:** Абстрактное свойство, должно быть реализовано в производных классах. Возвращает `true`, если тейк-профит ордер прикреплен, `false` в противном случае. (Только чтение)

*   `TimeSpan ProcessTimeout { get; set; }`
    *   **Описание:**  Время ожидания процесса. (Чтение и запись)

*   `TimeSpan AttachOrdersPeriod { get; } = TimeSpan.FromSeconds(30)`
    *   **Описание:** Период времени для прикрепления ордеров, по умолчанию 30 секунд. (Только чтение)

*   `TimeSpan RetryPeriodOnConnectionError { get; } = TimeSpan.FromSeconds(2)`
    *   **Описание:** Период времени повторных попыток при ошибке соединения, по умолчанию 2 секунды. (Только чтение)

*   `TimeSpan RetryPeriodOnOrderError { get; } = TimeSpan.FromMilliseconds(500)`
    *   **Описание:** Период времени повторных попыток при ошибке ордера, по умолчанию 500 миллисекунд. (Только чтение)

*   `TimeSpan RetryPeriod { get; } = TimeSpan.FromMilliseconds(200)`
    *   **Описание:** Общий период времени повторных попыток, по умолчанию 200 миллисекунд. (Только чтение)

**► Properties inherited from `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`**
    *   *Унаследованные свойства от класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`*

**► Properties inherited from `ATAS.Strategies.Strategy`**
    *   *Унаследованные свойства от класса `ATAS.Strategies.Strategy`*

**► Properties inherited from `ATAS.Strategies.IStrategy`**
    *   *Унаследованные свойства от интерфейса `ATAS.Strategies.IStrategy`*

**► Properties inherited from `ATAS.Strategies.ATM.IATMStrategy`**
    *   *Унаследованные свойства от интерфейса `ATAS.Strategies.ATM.IATMStrategy`*

### **Additional Inherited Members (Дополнительные унаследованные члены)**

**► Protected Attributes inherited from `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`**
    *   *Унаследованные защищенные атрибуты от класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`*

**► Events inherited from `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`**
    *   *Унаследованные события от класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`*

**► Events inherited from `ATAS.Strategies.Strategy`**
    *   *Унаследованные события от класса `ATAS.Strategies.Strategy`*

**► Events inherited from `ATAS.Strategies.IStrategy`**
    *   *Унаследованные события от интерфейса `ATAS.Strategies.IStrategy`*

**► Events inherited from `ATAS.Strategies.ATM.IATMStrategy`**
    *   *Унаследованные события от интерфейса `ATAS.Strategies.ATM.IATMStrategy`*

---
**Member Function Documentation (Документация методов класса)**

*   **`CreateStopOrder()`**
    ```csharp
    Order ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.CreateStopOrder(
        OrderDirections direction,
        decimal sl,
        decimal volume,
        string prefix
    )
    ```
    *   **Описание:**  Создает стоп-ордер.
    *   **protected** (защищенный метод)

*   **`CreateTakeOrder()`**
    ```csharp
    Order ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.CreateTakeOrder(
        OrderDirections direction,
        decimal tp,
        decimal volume,
        string prefix
    )
    ```
    *   **Описание:** Создает тейк-профит ордер.
    *   **protected** (защищенный метод)

*   **`DisableStopAndTake()`**
    ```csharp
    abstract void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.DisableStopAndTake()
    ```
    *   **Описание:** Отключает функциональность стоп-лосса и тейк-профита.
    *   **abstract void** (абстрактный метод, не возвращает значение)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`GetPriceValue()`**
    ```csharp
    decimal ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.GetPriceValue(
        decimal price,
        PriceUnit value,
        decimal sign
    )
    ```
    *   **Описание:** Получает значение цены с учетом единицы измерения и знака.
    *   **decimal** (возвращает десятичное число)
    *   **protected** (защищенный метод)

*   **`GetSettings()`**
    ```csharp
    new TSettings ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.GetSettings()
    ```
    *   **Описание:** Возвращает текущие настройки стратегии.
    *   **new TSettings** (возвращает новый объект типа `TSettings`)
    *   **Implements:** `ATAS.Strategies.ATM.IATMStrategy` (Реализует интерфейс `ATAS.Strategies.ATM.IATMStrategy`)

*   **`IsEquals()`**
    ```csharp
    bool ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.IsEquals(
        Order first,
        Order second,
        bool isStop,
        bool comparePrices
    )
    ```
    *   **Описание:** Сравнивает два ордера на равенство.
    *   **bool** (возвращает логическое значение)
    *   **protected** (защищенный метод)

*   **`IsValidSettings()`**
    ```csharp
    bool IEnumerable<string> Errors ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.IsValidSettings(
        TSettings settings,
        decimal? expectedPositionVolume = null,
        decimal? expectedPositionPrice = null
    )
    ```
    *   **Описание:** Проверяет валидность предоставленных настроек стратегии.
    *   **bool IEnumerable<string> Errors** (возвращает логическое значение и, в случае ошибки, коллекцию строк с описанием ошибок)
    *   **Implements:** `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>` (Реализует интерфейс `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>`)

*   **`OnAttachStopAndTakeOrdersFailed()`**
    ```csharp
    abstract void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnAttachStopAndTakeOrdersFailed()
    ```
    *   **Описание:** Обработчик события неудачи прикрепления стоп-лосс и тейк-профит ордеров.
    *   **abstract void** (абстрактный метод, не возвращает значение)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`OnCancel()`**
    ```csharp
    override async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnCancel()
    ```
    *   **Описание:** Обработчик события отмены операции.
    *   **override async Task** (переопределенный асинхронный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` (Переопределен из класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`)

*   **`OnCancelAll()`**
    ```csharp
    abstract Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnCancelAll(
        bool retryOnError
    )
    ```
    *   **Описание:** Обработчик события отмены всех ордеров.
    *   **abstract Task** (абстрактный метод, возвращает `Task`)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`OnCancelOrder()`**
    ```csharp
    override async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnCancelOrder(
        Order order,
        bool isAutomated
    )
    ```
    *   **Описание:** Обработчик события отмены ордера. Вызывается при отмене ордера.
    *   **Parameters:**
        *   `order`: Ордер, который был отменен.
        *   `isAutomated`: Флаг, указывающий, была ли отмена автоматической.
    *   **override async Task** (переопределенный асинхронный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`OnCancelOrdersAsync()`**
    ```csharp
    override async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnCancelOrdersAsync(
        IEnumerable<Order> orders
    )
    ```
    *   **Описание:** Асинхронный обработчик события отмены нескольких ордеров.
    *   **override async Task** (переопределенный асинхронный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Implements:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` (Реализует интерфейс `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`)

*   **`OnCancelSecondOrder()`**
    ```csharp
    abstract Task<bool> ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnCancelSecondOrder(
        Order order
    )
    ```
    *   **Описание:** Обработчик события отмены второго ордера.
    *   **abstract Task<bool>** (абстрактный метод, возвращает `Task<bool>`)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`OnCurrentPositionChanged()`**
    ```csharp
    override void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnCurrentPositionChanged()
    ```
    *   **Описание:** Обработчик события изменения текущей позиции. Вызывается, когда изменяется объем текущей позиции.
    *   **override void** (переопределенный метод, не возвращает значение)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`OnGetSettings()`**
    ```csharp
    abstract TSettings ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnGetSettings()
    ```
    *   **Описание:** Абстрактный метод для получения настроек стратегии.
    *   **abstract TSettings** (абстрактный метод, возвращает объект типа `TSettings`)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`OnGetStopProfitSettings()`**
    ```csharp
    override IStopProfitSettings ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnGetStopProfitSettings()
    ```
    *   **Описание:** Обработчик для получения настроек стоп-профита.
    *   **override IStopProfitSettings** (переопределенный метод, возвращает объект типа `IStopProfitSettings`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Implements:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` (Реализует интерфейс `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`)

*   **`OnIsValidSettings()`**
    ```csharp
    abstract ICollection<string> ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnIsValidSettings(
        TSettings settings,
        decimal positionVolume,
        decimal positionPrice,
        decimal currentPrice
    )
    ```
    *   **Описание:** Абстрактный метод для проверки валидности настроек стратегии с дополнительными параметрами.
    *   **abstract ICollection<string>** (абстрактный метод, возвращает коллекцию строк)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)

*   **`OnModifyOrder()`**
    ```csharp
    override async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnModifyOrder(
        Order order,
        Order newOrder,
        bool isAutomated
    )
    ```
    *   **Описание:** Обработчик события изменения ордера. Вызывается при изменении существующего ордера.
    *   **Parameters:**
        *   `order`: Исходный ордер.
        *   `newOrder`: Новый ордер с измененными параметрами.
        *   `isAutomated`: Флаг, указывающий, было ли изменение автоматическим.
    *   **override async Task** (переопределенный асинхронный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`OnNewOrder()`**
    ```csharp
    override void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnNewOrder(
        Order order
    )
    ```
    *   **Описание:** Обработчик события добавления нового ордера. Вызывается при добавлении нового ордера.
    *   **Parameters:**
        *   `order`: Новый добавленный ордер.
    *   **override void** (переопределенный метод, не возвращает значение)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`OnOrderChanged()`**
    ```csharp
    override void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnOrderChanged(
        Order order
    )
    ```
    *   **Описание:** Обработчик события изменения ордера. Вызывается при изменении существующего ордера.
    *   **Parameters:**
        *   `order`: Измененный ордер.
    *   **override void** (переопределенный метод, не возвращает значение)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`OnProcess()`**
    ```csharp
    abstract Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnProcess(
        ChangesInfo info
    )
    ```
    *   **Описание:** Абстрактный метод для обработки изменений состояния стратегии.
    *   **abstract Task** (абстрактный метод, возвращает `Task`)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`OnProcessOrder()`**
    ```csharp
    virtual void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnProcessOrder(
        Order order
    )
    ```
    *   **Описание:** Виртуальный метод для обработки ордера.
    *   **virtual void** (виртуальный метод, не возвращает значение)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.ATM.StopProfit` (Переопределен из класса `ATAS.Strategies.ATM.StopProfit`)

*   **`OnResetCustomStopAndTakePrices()`**
    ```csharp
    abstract void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnResetCustomStopAndTakePrices()
    ```
    *   **Описание:** Абстрактный метод для сброса пользовательских цен стоп-лосса и тейк-профита.
    *   **abstract void** (абстрактный метод, не возвращает значение)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`OnResetOrders()`**
    ```csharp
    override Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnResetOrders()
    ```
    *   **Описание:** Обработчик события сброса ордеров.
    *   **override Task** (переопределенный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` (Переопределен из класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`)

*   **`OnResetStopTakeOrderId()`**
    ```csharp
    abstract void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnResetStopTakeOrderId()
    ```
    *   **Описание:** Абстрактный метод для сброса идентификатора стоп-лосса и тейк-профита.
    *   **abstract void** (абстрактный метод, не возвращает значение)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`OnRetry()`**
    ```csharp
    override Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnRetry()
    ```
    *   **Описание:** Обработчик события повтора операции.
    *   **override Task** (переопределенный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` (Переопределен из класса `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`)

*   **`OnSetSettings()`**
    ```csharp
    abstract void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnSetSettings(
        TSettings settings
    )
    ```
    *   **Описание:** Абстрактный метод для обработки установки настроек стратегии.
    *   **abstract void** (абстрактный метод, не возвращает значение)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)

*   **`OnSetStopProfitSettings()`**
    ```csharp
    override void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnSetStopProfitSettings(
        IStopProfitSettings settings
    )
    ```
    *   **Описание:** Обработчик для установки настроек стоп-профита.
    *   **override void** (переопределенный метод, не возвращает значение)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Implements:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` (Реализует интерфейс `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`)

*   **`OnStarted()`**
    ```csharp
    override async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnStarted()
    ```
    *   **Описание:** Обработчик события запуска стратегии. Вызывается, когда стратегия запускается из состояния `StrategyStates.Stopped`.
    *   **override async Task** (переопределенный асинхронный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`OnStartedFromWatch()`**
    ```csharp
    override async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnStartedFromWatch()
    ```
    *   **Описание:** Обработчик события запуска стратегии из режима наблюдения. Вызывается, когда стратегия запускается из состояния `StrategyStates.Watch`.
    *   **override async Task** (переопределенный асинхронный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`OnStopping()`**
    ```csharp
    override async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.OnStopping()
    ```
    *   **Описание:** Обработчик события остановки стратегии. Вызывается, когда стратегия останавливается.
    *   **override async Task** (переопределенный асинхронный метод, возвращает `Task`)
    *   **protected virtual** (защищенный, виртуальный метод)
    *   **Reimplemented from:** `ATAS.Strategies.Strategy` (Переопределен из класса `ATAS.Strategies.Strategy`)

*   **`override()`**
    ```csharp
    override (bool IsValid, IEnumerable<string> Errors) ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.override()
    ```
    *   **Описание:**  Переопределенный метод для валидации. (Точное описание функции требует дополнительного контекста или изучения кода)
    *   **override (bool IsValid, IEnumerable<string> Errors)** (переопределенный метод, возвращает кортеж с логическим значением и коллекцией строк)
    *   **protected** (защищенный метод)

*   **`Process()`**
    ```csharp
    void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.Process(
        bool isPositionChanged = false,
        bool isordersChanged = false,
        bool isSettingsChanged = false
    )
    ```
    *   **Описание:** Метод для обработки логики стратегии.
    *   **void** (не возвращает значение)
    *   **protected** (защищенный метод)

*   **`ProcessAfterDelay()`**
    ```csharp
    async Task ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.ProcessAfterDelay(
        TimeSpan? delay = null
    )
    ```
    *   **Описание:** Асинхронный метод для выполнения процесса с задержкой.
    *   **async Task** (асинхронный метод, возвращает `Task`)
    *   **protected** (защищенный метод)

*   **`ResetCustomStopAndTakePrices()`**
    ```csharp
    void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.ResetCustomStopAndTakePrices()
    ```
    *   **Описание:** Метод для сброса пользовательских цен стоп-лосса и тейк-профита.
    *   **void** (не возвращает значение)
    *   **protected** (защищенный метод)

*   **`ResetWatchState()`**
    ```csharp
    void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.ResetWatchState()
    ```
    *   **Описание:** Метод для сброса состояния наблюдения стратегии.
    *   **void** (не возвращает значение)
    *   **protected** (защищенный метод)

*   **`SetSettings()`**
    ```csharp
    void ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.SetSettings(
        TSettings settings
    )
    ```
    *   **Описание:** Метод для установки настроек стратегии.
    *   **void** (не возвращает значение)
    *   **Implements:** `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>` (Реализует интерфейс `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>`)

*   **`SetStopOrTakeCancelledManually()`**
    ```csharp
    abstract bool ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.SetStopOrTakeCancelledManually(
        Order order,
        string type
    )
    ```
    *   **Описание:** Абстрактный метод для установки флага ручной отмены стоп-лосса или тейк-профита.
    *   **abstract bool** (абстрактный метод, возвращает логическое значение)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`SetStopOrTakeCustomPrice()`**
    ```csharp
    abstract bool ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.SetStopOrTakeCustomPrice(
        Order currentStopOrTake,
        Order newOrder
    )
    ```
    *   **Описание:** Абстрактный метод для установки пользовательской цены стоп-лосса или тейк-профита.
    *   **abstract bool** (абстрактный метод, возвращает логическое значение)
    *   **protected pure virtual** (защищенный, чисто виртуальный метод)
    *   **Implemented in:** `ATAS.Strategies.ATM.StopProfit` (Реализован в классе `ATAS.Strategies.ATM.StopProfit`)

*   **`TryAttachOrder()`**
    ```csharp
    Order ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.TryAttachOrder(
        string type,
        Order order,
        StrategyOrderId orderId,
        string prefix
    )
    ```
    *   **Описание:** Метод для попытки прикрепления ордера к стратегии.
    *   **Order** (возвращает объект типа `Order`)
    *   **protected** (защищенный метод)

*   **`TryCancelSecondOrder()`**
    ```csharp
    async Task<bool> ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.TryCancelSecondOrder(
        string type,
        Order order,
        string prefix
    )
    ```
    *   **Описание:** Асинхронный метод для попытки отмены второго ордера.
    *   **async Task<bool>** (асинхронный метод, возвращает `Task<bool>`)
    *   **protected** (защищенный метод)

*   **`TryCancelStopOrTake()`**
    ```csharp
    async Task<bool> ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.TryCancelStopOrTake(
        string type,
        Order order,
        string message,
        string prefix,
        bool retryOnError
    )
    ```
    *   **Описание:** Асинхронный метод для попытки отмены стоп-лосса или тейк-профита.
    *   **async Task<bool>** (асинхронный метод, возвращает `Task<bool>`)
    *   **protected** (защищенный метод)

*   **`TryProcessStopOrTake()`**
    ```csharp
    async Task<Order> ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.TryProcessStopOrTake(
        string type,
        Order oldOrder,
        OrderDirections direction,
        PriceUnit? currentValue,
        int positionSign,
        decimal volume,
        string prefix,
        bool isPositionChanged
    )
    ```
    *   **Описание:** Асинхронный метод для попытки обработки стоп-лосса или тейк-профита.
    *   **async Task<Order>** (асинхронный метод, возвращает `Task<Order>`)
    *   **protected** (защищенный метод)

---
**Member Data Documentation (Документация данных-членов)**

*   **`IsValid`**
    ```csharp
    bool ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.IsValid
    ```
    *   **Описание:**  Флаг, указывающий, является ли стратегия валидной.
    *   **bool** (тип данных - логическое значение)

---
**Property Documentation (Документация свойств)**

*   **`AttachOrdersPeriod`**
    ```csharp
    TimeSpan ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.AttachOrdersPeriod = TimeSpan.FromSeconds(30)
    ```
    *   **Описание:** Период времени для прикрепления ордеров. По умолчанию 30 секунд.
    *   **TimeSpan** (тип данных - временной интервал)
    *   **get** (доступно только чтение)

*   **`IsStopOrderAttached`**
    ```csharp
    abstract bool ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.IsStopOrderAttached
    ```
    *   **Описание:**  Указывает, прикреплен ли стоп-ордер.
    *   **abstract bool** (абстрактное свойство, тип данных - логическое значение)
    *   **get protected** (доступно чтение, защищенный доступ)

*   **`IsTakeOrderAttached`**
    ```csharp
    abstract bool ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.IsTakeOrderAttached
    ```
    *   **Описание:** Указывает, прикреплен ли тейк-профит ордер.
    *   **abstract bool** (абстрактное свойство, тип данных - логическое значение)
    *   **get protected** (доступно чтение, защищенный доступ)

*   **`ProcessTimeout`**
    ```csharp
    TimeSpan ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.ProcessTimeout
    ```
    *   **Описание:** Время ожидания процесса.
    *   **TimeSpan** (тип данных - временной интервал)
    *   **get set** (доступно чтение и запись)

*   **`RetryPeriod`**
    ```csharp
    TimeSpan ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.RetryPeriod = TimeSpan.FromMilliseconds(200)
    ```
    *   **Описание:** Общий период времени повторных попыток. По умолчанию 200 миллисекунд.
    *   **TimeSpan** (тип данных - временной интервал)
    *   **get** (доступно только чтение)

*   **`RetryPeriodOnConnectionError`**
    ```csharp
    TimeSpan ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.RetryPeriodOnConnectionError = TimeSpan.FromSeconds(2)
    ```
    *   **Описание:** Период времени повторных попыток при ошибке соединения. По умолчанию 2 секунды.
    *   **TimeSpan** (тип данных - временной интервал)
    *   **get** (доступно только чтение)

*   **`RetryPeriodOnOrderError`**
    ```csharp
    TimeSpan ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>.RetryPeriodOnOrderError = TimeSpan.FromMilliseconds(500)
    ```
    *   **Описание:** Период времени повторных попыток при ошибке ордера. По умолчанию 500 миллисекунд.
    *   **TimeSpan** (тип данных - временной интервал)
    *   **get** (доступно только чтение)

---
**Файл, из которого сгенерирована документация:**
*   `BaseStopProfitStrategy.cs`







### Методичка по структуре `ATAS.Strategies.ATM.ChangesInfo`

#### Описание структуры

Структура `ATAS.Strategies.ATM.ChangesInfo` предназначена для хранения информации об изменениях, произошедших в автоматическом управлении торговлей (ATM) стратегии. Она содержит свойства, указывающие на различные типы изменений, такие как изменение позиции, ордеров или настроек.

#### Публичные члены структуры

**Публичные функции-члены:**

*   `ToString()`

    *   `override string ToString()`
    *   Возвращает строковое представление объекта `ATAS.Strategies.ATM.ChangesInfo`.

**Свойства:**

*   `HasChanges`

    *   `bool HasChanges`  `[get]`
    *   Указывает, произошли ли какие-либо изменения в ATM стратегии. Возвращает `true`, если изменения есть, и `false` в противном случае.

*   `IsPositionChanged`

    *   `bool IsPositionChanged`  `[get]`
    *   Указывает, изменилась ли позиция. Возвращает `true`, если позиция была изменена, и `false` в противном случае.

*   `IsPositionOpened`

    *   `bool IsPositionOpened`  `[get]`
    *   Указывает, была ли открыта новая позиция. Возвращает `true`, если позиция была открыта, и `false` в противном случае.

*   `IsPositionClosed`

    *   `bool IsPositionClosed`  `[get]`
    *   Указывает, была ли закрыта позиция. Возвращает `true`, если позиция была закрыта, и `false` в противном случае.

*   `IsPositionReverted`

    *   `bool IsPositionReverted`  `[get]`
    *   Указывает, была ли позиция возвращена к исходному состоянию (reverted). Возвращает `true`, если позиция была возвращена, и `false` в противном случае.

*   `IsOrdersChanged`

    *   `bool IsOrdersChanged`  `[get]`
    *   Указывает, были ли изменены ордера. Возвращает `true`, если ордера были изменены, и `false` в противном случае.

*   `IsSettingsChanged`

    *   `bool IsSettingsChanged`  `[get]`
    *   Указывает, были ли изменены настройки ATM стратегии. Возвращает `true`, если настройки были изменены, и `false` в противном случае.

#### Документация по членам структуры

**Функция-член:**

*   `ToString()`

    *   `override string ATAS.Strategies.ATM.ChangesInfo.ToString()`
    *   Переопределенный метод `ToString()` для структуры `ATAS.Strategies.ATM.ChangesInfo`. Возвращает строковое представление объекта, полезное для отладки и логирования.

**Свойства:**

*   `HasChanges`

    *   `bool ATAS.Strategies.ATM.ChangesInfo.HasChanges`  `[get]`
    *   Свойство `HasChanges` типа `bool` указывает на наличие изменений в ATM стратегии.  `[get]` означает, что это свойство доступно только для чтения (get accessor).

*   `IsOrdersChanged`

    *   `bool ATAS.Strategies.ATM.ChangesInfo.IsOrdersChanged`  `[get]`
    *   Свойство `IsOrdersChanged` типа `bool` показывает, были ли изменены ордера, связанные с ATM стратегией. `[get]` - только для чтения.

*   `IsPositionChanged`

    *   `bool ATAS.Strategies.ATM.ChangesInfo.IsPositionChanged`  `[get]`
    *   Свойство `IsPositionChanged` типа `bool` указывает, произошло ли изменение позиции. `[get]` - только для чтения.

*   `IsPositionClosed`

    *   `bool ATAS.Strategies.ATM.ChangesInfo.IsPositionClosed`  `[get]`
    *   Свойство `IsPositionClosed` типа `bool` сообщает, была ли закрыта позиция. `[get]` - только для чтения.

*   `IsPositionOpened`

    *   `bool ATAS.Strategies.ATM.ChangesInfo.IsPositionOpened`  `[get]`
    *   Свойство `IsPositionOpened` типа `bool` информирует, была ли открыта позиция. `[get]` - только для чтения.

*   `IsPositionReverted`

    *   `bool ATAS.Strategies.ATM.ChangesInfo.IsPositionReverted`  `[get]`
    *   Свойство `IsPositionReverted` типа `bool` указывает, была ли позиция возвращена к исходному состоянию. `[get]` - только для чтения.

*   `IsSettingsChanged`

    *   `bool ATAS.Strategies.ATM.ChangesInfo.IsSettingsChanged`  `[get]`
    *   Свойство `IsSettingsChanged` типа `bool` показывает, были ли изменены настройки ATM стратегии. `[get]` - только для чтения.

#### Файл, в котором документирована структура:

*   `BaseStopProfitStrategy.cs`

---

**Аннотации на русском языке для обучения программированию:**

*   **Структура (`struct`)**: Это тип данных, который может содержать несколько переменных разных типов (свойства) и функции (методы). В отличие от класса, структура является типом значения, а не ссылочным типом.
*   **`ATAS.Strategies.ATM.ChangesInfo`**:  Это полное имя структуры, указывающее на ее местоположение в иерархии классов и пространств имен ATAS. `ATAS.Strategies.ATM` - это пространство имен, а `ChangesInfo` - имя структуры.
*   **`Public Member Functions`**: Публичные функции-члены структуры, то есть функции, которые можно вызывать из любого места, где доступна структура.
*   **`override string ToString()`**:  Это переопределение стандартного метода `ToString()`. Метод `ToString()` предназначен для преобразования объекта в строковое представление. `override` означает, что этот метод переопределяет метод, унаследованный от базового класса (в данном случае, от `System.Object`). `string` указывает, что метод возвращает строку.
*   **`Properties`**: Свойства структуры. Свойства предоставляют доступ к полям структуры и могут иметь аксессоры `get` (для чтения значения) и `set` (для записи значения).
*   **`bool`**: Тип данных "boolean", который может принимать только два значения: `true` (истина) или `false` (ложь).
*   **`[get]`**:  Это аксессор "get" для свойства. Он означает, что значение свойства можно только прочитать, но нельзя изменить напрямую извне. Такие свойства называются свойствами только для чтения.
*   **`BaseStopProfitStrategy.cs`**: Имя файла с исходным кодом на языке C#, в котором определена и документирована эта структура. `.cs` - расширение файлов с кодом на C#.






## Методичка по интерфейсу ATAS.Strategies.ATM.IATMStrategy для разработки стратегий ATAS

### Обзор интерфейса ATAS.Strategies.ATM.IATMStrategy

**Наследование:**

```
INotifyPropertyChanged → Strategy → ATAS.Strategies.ATM.IATMStrategy
                                        ↘ ATAS.Strategies.ATM.ATMStrategy<TStrategy>
                                            ↘ ATAS.Strategies.ATM.ProfitStrategy<TStrategy>
                                            ↘ ATAS.Strategies.ATM.CustomStopOrderStrategy<TStrategy>
```

*Аннотация: `ATAS.Strategies.ATM.IATMStrategy` наследуется от `Strategy` и `INotifyPropertyChanged`.  Также показаны классы, которые наследуются от `ATAS.Strategies.ATM.IATMStrategy` через `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

**Диаграмма взаимодействия:**

```
INotifyPropertyChanged → IStrategy → ATAS.Strategies.ATM.IATMStrategy
```

*Аннотация: `ATAS.Strategies.ATM.IATMStrategy` взаимодействует с интерфейсами `IStrategy` и `INotifyPropertyChanged`.*

### Публичные функции-члены

| Тип возвращаемого значения | Функция                                  |
| :------------------------ | :---------------------------------------- |
| `Task`                    | `WatchAsync()`                            |
| `Task`                    | `StartFromWatchAsync()`                   |
| `Task`                    | `RetryAsync()`                            |
| `Task`                    | `CancelAsync()`                           |
| `Task`                    | `ResetOrdersAsync()`                      |
| `bool`                    | `IsStopLoss(Order order)`                 |
| `bool`                    | `IsTakeProfit(Order order)`               |
| `Task`                    | `OpenOrderAsync(Order order, bool isAutomated=true)` |
| `Task`                    | `ModifyOrderAsync(Order order, Order newOrder, bool isAutomated=true)` |
| `Task`                    | `CancelOrderAsync(Order order, bool isAutomated=true)` |
| `Task`                    | `CancelOrdersAsync(IEnumerable<Order> orders)` |
| `IATMStrategy`            | `Clone(bool cloneOrders=true)`           |
| `void`                    | `SetSettings(IStopProfitSettings settings)` |
| `IStopProfitSettings`       | `GetSettings()`                           |
| `bool IEnumerable<string> Errors` | `IsValidSettings(IStopProfitSettings settings, decimal? expectedPositionVolume=null, decimal? expectedPositionPrice=null)` |

*Аннотация: Таблица публичных функций-членов интерфейса `ATAS.Strategies.ATM.IATMStrategy`. Описаны типы возвращаемых значений и сигнатуры функций.*

#### Публичные функции-члены, унаследованные от ATAS.Strategies.IStrategy

*Документация не предоставляет списка унаследованных функций, но указывает на их наличие.*

*Аннотация:  Указание на то, что интерфейс наследует публичные функции-члены от `ATAS.Strategies.IStrategy`.  Для полного списка необходимо обратиться к документации `ATAS.Strategies.IStrategy`.*

### Публичные атрибуты

| Тип    | Атрибут   |
| :----- | :-------- |
| `bool` | `IsValid` |

*Аннотация: Таблица публичных атрибутов интерфейса `ATAS.Strategies.ATM.IATMStrategy`.  В данном случае, есть один атрибут `IsValid` типа `bool`.*

### Свойства

| Тип                       | Свойство                | Get | Set |
| :------------------------ | :---------------------- | :-: | :-: |
| `bool`                    | `HasActiveOrders`       |  ✓  |     |
| `IStrategyMarketDataProvider` | `MarketDataProvider`  |  ✓  |  ✓  |

*Аннотация: Таблица свойств интерфейса `ATAS.Strategies.ATM.IATMStrategy`. Описаны типы свойств, их имена и доступность `get` и `set` методов.*

#### Свойства, унаследованные от ATAS.Strategies.IStrategy

*Документация не предоставляет списка унаследованных свойств, но указывает на их наличие.*

*Аннотация: Указание на то, что интерфейс наследует свойства от `ATAS.Strategies.IStrategy`. Для полного списка необходимо обратиться к документации `ATAS.Strategies.IStrategy`.*

### События

| Тип события                 | Событие           |
| :-------------------------- | :---------------- |
| `EventHandler<EventArgs>` | `SettingsChanged` |

*Аннотация: Таблица событий интерфейса `ATAS.Strategies.ATM.IATMStrategy`.  В данном случае, есть одно событие `SettingsChanged` типа `EventHandler<EventArgs>`.*

#### События, унаследованные от ATAS.Strategies.IStrategy

*Документация не предоставляет списка унаследованных событий, но указывает на их наличие.*

*Аннотация: Указание на то, что интерфейс наследует события от `ATAS.Strategies.IStrategy`. Для полного списка необходимо обратиться к документации `ATAS.Strategies.IStrategy`.*

### Документация функций-членов

#### `CancelAsync()`

```csharp
Task CancelAsync()
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `CancelAsync()`. Возвращает `Task`, асинхронная операция. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `CancelOrderAsync()`

```csharp
Task CancelOrderAsync(Order order, bool isAutomated = true)
```

*Аннотация: Документация функции `CancelOrderAsync()`. Принимает параметры `Order order` и опциональный `bool isAutomated`. Возвращает `Task`, асинхронная операция.*

#### `CancelOrdersAsync()`

```csharp
Task CancelOrdersAsync(IEnumerable<Order> orders)
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `CancelOrdersAsync()`. Принимает параметр `IEnumerable<Order> orders`. Возвращает `Task`, асинхронная операция. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `Clone()`

```csharp
IATMStrategy Clone(bool cloneOrders = true)
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `Clone()`. Принимает опциональный параметр `bool cloneOrders`. Возвращает объект типа `IATMStrategy`. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `GetSettings()`

```csharp
IStopProfitSettings GetSettings()
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`, `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`, и `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>`.

*Аннотация: Документация функции `GetSettings()`. Не принимает параметров. Возвращает объект типа `IStopProfitSettings`. Реализация находится в нескольких классах: `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`, `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`, и `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>`.*

#### `IsStopLoss()`

```csharp
bool IsStopLoss(Order order)
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `IsStopLoss()`. Принимает параметр `Order order`. Возвращает `bool`. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `IsTakeProfit()`

```csharp
bool IsTakeProfit(Order order)
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `IsTakeProfit()`. Принимает параметр `Order order`. Возвращает `bool`. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `IsValidSettings()`

```csharp
bool IEnumerable<string> Errors IsValidSettings(IStopProfitSettings settings, decimal? expectedPositionVolume = null, decimal? expectedPositionPrice = null)
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `IsValidSettings()`. Принимает параметры `IStopProfitSettings settings`, опциональные `decimal? expectedPositionVolume` и `decimal? expectedPositionPrice`. Возвращает `bool IEnumerable<string> Errors`. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `ModifyOrderAsync()`

```csharp
Task ModifyOrderAsync(Order order, Order newOrder, bool isAutomated = true)
```

*Аннотация: Документация функции `ModifyOrderAsync()`. Принимает параметры `Order order`, `Order newOrder` и опциональный `bool isAutomated`. Возвращает `Task`, асинхронная операция.*

#### `OpenOrderAsync()`

```csharp
Task OpenOrderAsync(Order order, bool isAutomated = true)
```

*Аннотация: Документация функции `OpenOrderAsync()`. Принимает параметры `Order order` и опциональный `bool isAutomated`. Возвращает `Task`, асинхронная операция.*

#### `ResetOrdersAsync()`

```csharp
Task ResetOrdersAsync()
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `ResetOrdersAsync()`. Не принимает параметров. Возвращает `Task`, асинхронная операция. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `RetryAsync()`

```csharp
Task RetryAsync()
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `RetryAsync()`. Не принимает параметров. Возвращает `Task`, асинхронная операция. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `SetSettings()`

```csharp
void SetSettings(IStopProfitSettings settings)
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация функции `SetSettings()`. Принимает параметр `IStopProfitSettings settings`. Возвращает `void`. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

#### `StartFromWatchAsync()`

```csharp
Task StartFromWatchAsync()
```

*Аннотация: Документация функции `StartFromWatchAsync()`. Не принимает параметров. Возвращает `Task`, асинхронная операция.*

#### `WatchAsync()`

```csharp
Task WatchAsync()
```

*Аннотация: Документация функции `WatchAsync()`. Не принимает параметров. Возвращает `Task`, асинхронная операция.*

### Документация данных-членов

#### `IsValid`

```csharp
bool IsValid
```

*Аннотация: Документация атрибута `IsValid`. Тип `bool`.*

### Документация свойств

#### `HasActiveOrders`

```csharp
bool HasActiveOrders { get; }
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` и `ATAS.Strategies.ATM.StopProfit`.

*Аннотация: Документация свойства `HasActiveOrders`. Тип `bool`, только `get` метод. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>` и `ATAS.Strategies.ATM.StopProfit`.*

#### `MarketDataProvider`

```csharp
IStrategyMarketDataProvider MarketDataProvider { get; set; }
```

Реализовано в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*Аннотация: Документация свойства `MarketDataProvider`. Тип `IStrategyMarketDataProvider`, есть `get` и `set` методы. Реализация находится в `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.*

### Документация событий

#### `SettingsChanged`

```csharp
EventHandler<EventArgs> SettingsChanged
```

*Аннотация: Документация события `SettingsChanged`. Тип `EventHandler<EventArgs>`.*

### Файл определения интерфейса

* `IATMStrategy.cs`

*Аннотация: Указание на файл, в котором определен интерфейс `IATMStrategy`.*






## Методичка по интерфейсу ATAS.Strategies.ATM.ISimpleStopProfitStrategy для разработки стратегий ATAS

### Обзор интерфейса ATAS.Strategies.ATM.ISimpleStopProfitStrategy

Интерфейс `ATAS.Strategies.ATM.ISimpleStopProfitStrategy` предназначен для реализации простых стратегий стоп-лосс и тейк-профит в платформе ATAS. Он предоставляет набор свойств для управления уровнями стоп-лосса, тейк-профита, трейлинг-стопа и безубытка. Этот интерфейс является частью пространства имен `ATAS.Strategies.ATM` и используется для создания автоматизированных торговых стратегий, которые управляют рисками и прибылью на основе заданных параметров.

### Диаграмма наследования

![Диаграмма наследования для ATAS.Strategies.ATM.ISimpleStopProfitStrategy](изображение_диаграммы_наследования_из_pdf_страница_1)

**Аннотация:** Диаграмма показывает иерархию наследования интерфейса `ISimpleStopProfitStrategy`. Он наследуется от `IStopProfitStrategy<SimpleStopProfitSettings>`, `ISupportCustomStopOrTake`, `IATMStrategy`, `IStrategy` и `INotifyPropertyChanged`. Это означает, что `ISimpleStopProfitStrategy` включает в себя функциональность всех этих интерфейсов.

### Диаграмма коллаборации

![Диаграмма коллаборации для ATAS.Strategies.ATM.ISimpleStopProfitStrategy](изображение_диаграммы_коллаборации_из_pdf_страница_1)

**Аннотация:** Диаграмма коллаборации демонстрирует взаимодействие `ISimpleStopProfitStrategy` с другими интерфейсами. Она показывает, что `ISimpleStopProfitStrategy` реализует интерфейсы `IStopProfitStrategy<SimpleStopProfitSettings>`, `ISupportCustomStopOrTake`, `IATMStrategy`, `IStrategy` и `INotifyPropertyChanged`, подчеркивая его роль как составного элемента в системе стратегий ATAS.

### Свойства интерфейса

#### StopLoss

`StopProfitSettings StopLoss { get; }`

**Аннотация:** Свойство `StopLoss` типа `StopProfitSettings` позволяет получить или установить параметры стоп-лосса. `StopProfitSettings` вероятно является классом или структурой, содержащей настройки для стоп-лосса, такие как уровень стоп-цены и тип стоп-ордера. Доступно только для чтения (`get;`), что может означать, что настройки стоп-лосса устанавливаются через другие механизмы, возможно, через конструктор или методы настройки стратегии.

#### TakeProfit

`StopProfitSettings TakeProfit { get; }`

**Аннотация:** Свойство `TakeProfit` типа `StopProfitSettings` аналогично `StopLoss`, но предназначено для параметров тейк-профита. Оно также предоставляет доступ к настройкам тейк-профита через `StopProfitSettings` и является свойством только для чтения (`get;`).

#### TrailingStop

`TrailingStopSettings TrailingStop { get; }`

**Аннотация:** Свойство `TrailingStop` типа `TrailingStopSettings` управляет параметрами трейлинг-стопа. `TrailingStopSettings` вероятно содержит конфигурации для трейлинг-стопа, такие как величина трейлинга и шаг изменения. Свойство доступно только для чтения (`get;`).

#### Breakeven

`BreakevenSettings Breakeven { get; }`

**Аннотация:** Свойство `Breakeven` типа `BreakevenSettings` отвечает за настройки безубытка. `BreakevenSettings` вероятно включает параметры для активации и настройки функции безубытка, например, уровень прибыли для перемещения стоп-лосса в безубыток. Свойство доступно только для чтения (`get;`).

#### CurrentStop

`PriceUnit? CurrentStop { get; }`

**Аннотация:** Свойство `CurrentStop` типа `PriceUnit?` предоставляет текущий уровень стоп-лосса. Тип `PriceUnit?` с вопросительным знаком указывает на nullable тип, вероятно представляющий цену. Это свойство позволяет отслеживать текущее значение стоп-лосса, которое может изменяться, например, при использовании трейлинг-стопа или функции безубытка. Доступно только для чтения (`get;`).

#### CurrentTake

`PriceUnit? CurrentTake { get; }`

**Аннотация:** Свойство `CurrentTake` типа `PriceUnit?` аналогично `CurrentStop`, но отображает текущий уровень тейк-профита. Также является nullable типом цены и доступно только для чтения (`get;`).

### Унаследованные члены

#### Унаследованные свойства от ATAS.Strategies.ATM.IATMStrategy

**Аннотация:** Интерфейс `ISimpleStopProfitStrategy` наследует свойства от `IATMStrategy`.  Детали этих свойств не указаны в предоставленных страницах PDF, но известно, что `IATMStrategy` связан с автоматизированным управлением торговлей (ATM).

#### Унаследованные свойства от ATAS.Strategies.IStrategy

**Аннотация:** Интерфейс `ISimpleStopProfitStrategy` также наследует свойства от базового интерфейса `IStrategy`.  Подробности этих свойств также отсутствуют в предоставленных страницах, но `IStrategy` вероятно определяет общую структуру и поведение для всех стратегий в ATAS.

#### Дополнительные унаследованные члены

*   **Public Member Functions inherited from `ATAS.Strategies.ATM.IStopProfitStrategy<SimpleStopProfitSettings>`**
    **Аннотация:** Наследует публичные методы от `IStopProfitStrategy`, параметризованного `SimpleStopProfitSettings`. Эти методы вероятно связаны с управлением и настройкой стоп-лосс и тейк-профит логики.
*   **Public Member Functions inherited from `ATAS.Strategies.ATM.ISupportCustomStopOrTake`**
    **Аннотация:** Наследует публичные методы от `ISupportCustomStopOrTake`. Этот интерфейс, вероятно, обеспечивает поддержку пользовательской логики для стоп-лосса и тейк-профита, позволяя расширить стандартную функциональность.
*   **Public Member Functions inherited from `ATAS.Strategies.ATM.IATMStrategy`**
    **Аннотация:** Наследует публичные методы от `IATMStrategy`, связанные с управлением автоматизированной торговлей.
*   **Public Member Functions inherited from `ATAS.Strategies.IStrategy`**
    **Аннотация:** Наследует общие публичные методы от базового интерфейса `IStrategy`, общие для всех стратегий.
*   **Public Attributes inherited from `ATAS.Strategies.ATM.IStopProfitStrategy<SimpleStopProfitSettings>`**
    **Аннотация:** Наследует публичные атрибуты от `IStopProfitStrategy<SimpleStopProfitSettings>`, вероятно, предоставляющие доступ к данным или настройкам, связанным с стоп-лоссом и тейк-профитом.
*   **Public Attributes inherited from `ATAS.Strategies.ATM.IATMStrategy`**
    **Аннотация:** Наследует публичные атрибуты от `IATMStrategy`, связанные с автоматизированным управлением торговлей.
*   **Events inherited from `ATAS.Strategies.ATM.IATMStrategy`**
    **Аннотация:** Наследует события от `IATMStrategy`, позволяющие реагировать на определенные события в процессе автоматизированной торговли.
*   **Events inherited from `ATAS.Strategies.IStrategy`**
    **Аннотация:** Наследует общие события от `IStrategy`, которые могут быть общими для всех стратегий.

### Документация свойств

#### Breakeven

`BreakevenSettings ATAS.Strategies.ATM.ISimpleStopProfitStrategy.Breakeven { get; }`

Реализовано в `ATAS.Strategies.ATM.StopProfit`.

**Аннотация:** Подробная информация о свойстве `Breakeven`. Тип `BreakevenSettings`, интерфейс `ISimpleStopProfitStrategy`, реализация в классе `StopProfit`.

#### CurrentStop

`PriceUnit? ATAS.Strategies.ATM.ISimpleStopProfitStrategy.CurrentStop { get; }`

Реализовано в `ATAS.Strategies.ATM.StopProfit`.

**Аннотация:** Подробная информация о свойстве `CurrentStop`. Тип `PriceUnit?`, интерфейс `ISimpleStopProfitStrategy`, реализация в классе `StopProfit`.

#### CurrentTake

`PriceUnit? ATAS.Strategies.ATM.ISimpleStopProfitStrategy.CurrentTake { get; }`

Реализовано в `ATAS.Strategies.ATM.StopProfit`.

**Аннотация:** Подробная информация о свойстве `CurrentTake`. Тип `PriceUnit?`, интерфейс `ISimpleStopProfitStrategy`, реализация в классе `StopProfit`.

#### StopLoss

`StopProfitSettings ATAS.Strategies.ATM.ISimpleStopProfitStrategy.StopLoss { get; }`

Реализовано в `ATAS.Strategies.ATM.StopProfit`.

**Аннотация:** Подробная информация о свойстве `StopLoss`. Тип `StopProfitSettings`, интерфейс `ISimpleStopProfitStrategy`, реализация в классе `StopProfit`.

#### TakeProfit

`StopProfitSettings ATAS.Strategies.ATM.ISimpleStopProfitStrategy.TakeProfit { get; }`

Реализовано в `ATAS.Strategies.ATM.StopProfit`.

**Аннотация:** Подробная информация о свойстве `TakeProfit`. Тип `StopProfitSettings`, интерфейс `ISimpleStopProfitStrategy`, реализация в классе `StopProfit`.

#### TrailingStop

`TrailingStopSettings ATAS.Strategies.ATM.ISimpleStopProfitStrategy.TrailingStop { get; }`

Реализовано в `ATAS.Strategies.ATM.StopProfit`.

**Аннотация:** Подробная информация о свойстве `TrailingStop`. Тип `TrailingStopSettings`, интерфейс `ISimpleStopProfitStrategy`, реализация в классе `StopProfit`.

### Файл определения интерфейса

*   `IATMStrategy.cs`

**Аннотация:** Интерфейс `ISimpleStopProfitStrategy` определен в файле `IATMStrategy.cs`. Это важная информация для поиска исходного кода и дальнейшего изучения деталей реализации.






**Методичка:**

**Интерфейс:** `ATAS.Strategies.ATM.IStopProfitSettings`

**Описание:**  Интерфейс `IStopProfitSettings` находится в пространстве имен `ATAS.Strategies.ATM`.

**Свойства:**

- `TimeInForce`
    - Тип: `TimeInForce`
    - Доступ: `[get]` (только чтение)

**Документация свойств:**

- `TimeInForce`
    - Полный тип: `ATAS.Strategies.ATM.IStopProfitSettings.TimeInForce`
    - Доступ: `get` (только чтение)
    - Описание:  Свойство `TimeInForce` интерфейса `IStopProfitSettings`.

**Файл-источник:**

- `IATMStrategy.cs`






## Методичка по интерфейсу ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>

### Описание интерфейса
`ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>` - это интерфейс-шаблон, предназначенный для реализации стратегий стоп-профита в платформе ATAS. Интерфейс позволяет определить общую структуру и функциональность для различных типов стратегий стоп-профита, параметризованных типом настроек `TSettings`.

### Диаграмма наследования
Интерфейс `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>` наследуется от следующих интерфейсов:
*   `INotifyPropertyChanged`
*   `IStrategy`
*   `IATMStrategy`
*   `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`

### Диаграмма взаимодействия
Диаграмма взаимодействия показывает связи интерфейса `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>` с интерфейсами `INotifyPropertyChanged`, `IStrategy` и `IATMStrategy`.

### Открытые методы (Public Member Functions)

#### `SetSettings`
```csharp
void SetSettings (TSettings settings)
```
**Описание:** Метод `SetSettings` предназначен для установки настроек стратегии стоп-профита. В качестве параметра принимает объект `settings` типа `TSettings`, который содержит необходимые параметры конфигурации для данной стратегии.

#### `GetSettings`
```csharp
new TSettings GetSettings ()
```
**Описание:** Метод `GetSettings` предназначен для получения текущих настроек стратегии стоп-профита. Метод возвращает новый объект типа `TSettings`, представляющий собой копию текущих настроек стратегии.

#### `IsValidSettings`
```csharp
bool IEnumerable< string > Errors IsValidSettings (TSettings settings, decimal? expectedPositionVolume=null, decimal? expectedPositionPrice=null)
```
**Описание:** Метод `IsValidSettings` предназначен для проверки валидности предоставленных настроек стратегии стоп-профита.
*   **Параметры:**
    *   `settings` : Объект типа `TSettings`, содержащий настройки для проверки.
    *   `expectedPositionVolume` : Опциональный параметр типа `decimal?`, представляющий ожидаемый объем позиции. Может быть `null`.
    *   `expectedPositionPrice` : Опциональный параметр типа `decimal?`, представляющий ожидаемую цену позиции. Может быть `null`.
*   **Возвращаемое значение:**
    *   `bool IEnumerable<string> Errors`: Возвращает `true`, если настройки валидны, и `false` в противном случае. В случае невалидных настроек, возвращает коллекцию `Errors` типа `IEnumerable<string>`, содержащую сообщения об ошибках.

### Открытые атрибуты (Public Attributes)

#### `IsValid`
```csharp
bool IsValid
```
**Описание:** Атрибут `IsValid` типа `bool` предназначен для хранения информации о текущем состоянии валидности стратегии стоп-профита. Значение `true` указывает на то, что стратегия находится в валидном состоянии, `false` - в невалидном.

### Дополнительные унаследованные члены (Additional Inherited Members)

#### Свойства (Properties)
*   Унаследованы от `ATAS.Strategies.ATM.IATMStrategy`
*   Унаследованы от `ATAS.Strategies.IStrategy`

#### События (Events)
*   Унаследованы от `ATAS.Strategies.ATM.IATMStrategy`
*   Унаследованы от `ATAS.Strategies.IStrategy`

### Реализация интерфейса
*   Метод `GetSettings` **реализует** интерфейс `ATAS.Strategies.ATM.IATMStrategy`.
*   Методы `GetSettings` и `SetSettings` **реализованы** в `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.
*   Метод `IsValidSettings` **реализован** в `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

### Файл интерфейса
Интерфейс `ATAS.Strategies.ATM.IStopProfitStrategy<TSettings>` определен в файле `IATMStrategy.cs`.





```markdown
## Методичка: Функция GetLastPrice

### Описание

Функция `GetLastPrice` является частью интерфейса `IStrategyMarketDataProvider` в пространстве имен `ATAS.Strategies.ATM`.

### Публичные члены функции

#### `GetLastPrice`

```csharp
decimal GetLastPrice (Security security)
```

- **Тип возвращаемого значения:** `decimal` (десятичное число).  Это означает, что функция возвращает цену в виде десятичного числа, что подходит для финансовых данных, где важна точность.
- **Название функции:** `GetLastPrice`.  Название говорит само за себя — функция предназначена для получения последней цены.
- **Параметры:**
    - `Security security`: Параметр типа `Security`.  `Security` вероятно представляет собой класс или структуру данных, которая идентифицирует торговый инструмент (например, акцию, фьючерс, валютную пару).  Параметр `security` необходим для указания, для какого именно инструмента нужно получить последнюю цену.

### Документация функции-члена

#### `GetLastPrice()`

```csharp
decimal ATAS.Strategies.ATM.IStrategyMarketDataProvider.GetLastPrice (Security security)
```

- **Полное имя функции:** `ATAS.Strategies.ATM.IStrategyMarketDataProvider.GetLastPrice`.  Это полное имя указывает на точное местоположение функции в иерархии классов и пространств имен ATAS.
    - `ATAS.Strategies.ATM`:  Пространство имен, где определены стратегии ATM (Automated Trading Module).
    - `IStrategyMarketDataProvider`: Интерфейс, предоставляющий методы для доступа к рыночным данным в стратегиях.
    - `GetLastPrice`:  Сама функция.
- **Параметры:**
    - `Security security`:  Как и в объявлении, функция принимает параметр `security` типа `Security` для определения инструмента.
- **Тип возвращаемого значения:** `decimal`. Функция возвращает последнее значение цены для указанного инструмента в виде десятичного числа.

### Файл документации

- Документация для этого интерфейса была сгенерирована из файла: `IATMStrategy.cs`.  Это указывает на то, что интерфейс `IStrategyMarketDataProvider` и, вероятно, функция `GetLastPrice` определены в файле `IATMStrategy.cs`.

---
**Аннотации:**

- **`decimal`**:  В C# `decimal` - это тип данных для точных десятичных чисел, используется для финансовых расчетов, чтобы избежать ошибок округления, которые могут возникнуть при использовании `float` или `double`.
- **`Security`**:  Это, скорее всего, пользовательский класс или структура в ATAS API, представляющая финансовый инструмент. Чтобы использовать `GetLastPrice`, вам нужно создать или получить объект типа `Security`, представляющий интересующий вас инструмент.
- **`ATAS.Strategies.ATM.IStrategyMarketDataProvider`**:  Это полное имя функции показывает, что она предназначена для использования в стратегиях автоматической торговли (ATM) на платформе ATAS и является частью интерфейса для получения рыночных данных. Интерфейсы в программировании определяют контракт, которому должны соответствовать классы, реализующие этот интерфейс.  В данном случае, любой класс, реализующий `IStrategyMarketDataProvider`, должен предоставлять метод `GetLastPrice`.
- **`Public Member Functions`**:  Указывает на то, что `GetLastPrice` является публичной функцией, то есть она доступна для использования извне интерфейса и классов, которые его реализуют.

**Для ИИ:**

Эта методичка описывает функцию `GetLastPrice`, которая позволяет получить последнюю цену для заданного торгового инструмента (`Security`) в платформе ATAS. Функция является частью интерфейса `IStrategyMarketDataProvider`, предназначенного для предоставления рыночных данных стратегиям автоматической торговли. Возвращает значение типа `decimal`, что обеспечивает точность финансовых расчетов. Для использования функции необходимо передать объект типа `Security`, идентифицирующий интересующий инструмент.
```





## Методичка по интерфейсу ATAS.Strategies.ATM.ISupportCustomStopOrTake для создания стратегий ATAS

### Описание интерфейса

Интерфейс `ATAS.Strategies.ATM.ISupportCustomStopOrTake` предназначен для стратегий ATAS, которые поддерживают установку **пользовательских уровней стоп-лосс и тейк-профит**.

**Диаграмма наследования:**

```
INotifyPropertyChanged
    IStrategy
        IATMStrategy
            ATAS.Strategies.ATM.ISupportCustomStopOrTake
                ATAS.Strategies.ATM.ISimpleStopProfitStrategy
                    ATAS.Strategies.ATM.StopProfit
```

**Диаграмма коллаборации:**

```
INotifyPropertyChanged
    IStrategy
        IATMStrategy
            ATAS.Strategies.ATM.ISupportCustomStopOrTake
```

### Публичные функции-члены интерфейса

*   **`CanSetCustomStop()`**
    *   **Тип возвращаемого значения:** `bool`
    *   **Описание:**  Возвращает `true`, если стратегия позволяет установить пользовательский уровень стоп-лосс, и `false` в противном случае.
    *   **Реализация:** Реализовано в `ATAS.Strategies.ATM.StopProfit`.

*   **`CanSetCustomTake()`**
    *   **Тип возвращаемого значения:** `bool`
    *   **Описание:** Возвращает `true`, если стратегия позволяет установить пользовательский уровень тейк-профит, и `false` в противном случае.
    *   **Реализация:** Реализовано в `ATAS.Strategies.ATM.StopProfit`.

*   **`GetSettingsWithStopOrTake(PriceUnit? stop, PriceUnit? take)`**
    *   **Тип возвращаемого значения:** `IStopProfitSettings`
    *   **Параметры:**
        *   `PriceUnit? stop`:  Желаемый уровень стоп-лосс (может быть `null`).
        *   `PriceUnit? take`: Желаемый уровень тейк-профит (может быть `null`).
    *   **Описание:** Возвращает объект `IStopProfitSettings`, представляющий текущие настройки стоп-лосс и тейк-профит стратегии, возможно, скорректированные с учетом переданных параметров `stop` и `take`.
    *   **Реализация:** Реализовано в `ATAS.Strategies.ATM.StopProfit`.

*   **`SetCustomStopOrTake(PriceUnit? stop, PriceUnit? take)`**
    *   **Тип возвращаемого значения:** `Task`
    *   **Параметры:**
        *   `PriceUnit? stop`: Новый уровень стоп-лосс для установки (может быть `null` для отмены стоп-лосса).
        *   `PriceUnit? take`: Новый уровень тейк-профит для установки (может быть `null` для отмены тейк-профита).
    *   **Описание:** Асинхронная задача, устанавливающая пользовательские уровни стоп-лосс и тейк-профит для стратегии.
    *   **Реализация:** Реализовано в `ATAS.Strategies.ATM.StopProfit`.

### Дополнительные унаследованные члены

*   **Публичные атрибуты унаследованные от `ATAS.Strategies.ATM.IATMStrategy`**
*   **Свойства унаследованные от `ATAS.Strategies.ATM.IATMStrategy`**
*   **Свойства унаследованные от `ATAS.Strategies.IStrategy`**
*   **События унаследованные от `ATAS.Strategies.ATM.IATMStrategy`**
*   **События унаследованные от `ATAS.Strategies.IStrategy`**

### Расположение в файле

Интерфейс `ATAS.Strategies.ATM.ISupportCustomStopOrTake` определен в файле `IATMSrategy.cs`.






## Методичка по классу ATAS.Strategies.ATM.StopProfit

### ATAS.Strategies.ATM.StopProfit Class Reference
Аннотация: *Описание класса StopProfit для ATAS.*

#### Inheritance diagram for ATAS.Strategies.ATM.StopProfit:
Аннотация: *Диаграмма наследования класса StopProfit, показывающая его связь с родительскими классами и интерфейсами.*
```
INotifyPropertyChanged
IStrategy
IATMStrategy
[legend]
IStopProfitStrategy<SimpleStopProfitSettings>
ISupportCustomStopOrTake
BaseStopProfitStrategy<StopProfit, SimpleStopProfitSettings>
```

#### Collaboration diagram for ATAS.Strategies.ATM.StopProfit:
Аннотация: *Диаграмма взаимодействия класса StopProfit, демонстрирующая его связи с другими классами и интерфейсами.*
```
INotifyPropertyChanged
IStrategy
IATMStrategy
[legend]
IStopProfitStrategy<SimpleStopProfitSettings>
ISupportCustomStopOrTake
BaseStopProfitStrategy<StopProfit, SimpleStopProfitSettings>
```

### Public Member Functions
Аннотация: *Публичные методы класса StopProfit, доступные для использования вне класса.*

- `StopProfit ()`
- `bool CanSetCustomStop ()`
- `bool CanSetCustomTake ()`
- `async Task SetCustomStopOrTake (PriceUnit? stop, PriceUnit? take)`
- `IStopProfitSettings GetSettingsWithStopOrTake (PriceUnit? stop, PriceUnit? take)`

#### Public Member Functions inherited from ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >
Аннотация: *Публичные методы, унаследованные от базового класса BaseStopProfitStrategy.*

- `bool CanSetCustomStop ()`
- `bool CanSetCustomTake ()`
- `Task SetCustomStopOrTake (PriceUnit? stop, PriceUnit? take)`
- `IStopProfitSettings GetSettingsWithStopOrTake (PriceUnit? stop, PriceUnit? take)`

#### Public Member Functions inherited from ATAS.Strategies.ATM.IStopProfitStrategy< SimpleStopProfitSettings >
Аннотация: *Публичные методы, унаследованные от интерфейса IStopProfitStrategy.*

- `bool CanSetCustomStop ()`
- `bool CanSetCustomTake ()`
- `Task SetCustomStopOrTake (PriceUnit? stop, PriceUnit? take)`
- `IStopProfitSettings GetSettingsWithStopOrTake (PriceUnit? stop, PriceUnit? take)`

#### Public Member Functions inherited from ATAS.Strategies.ATM.IATMStrategy
Аннотация: *Публичные методы, унаследованные от интерфейса IATMStrategy.*

#### Public Member Functions inherited from ATAS.Strategies.IStrategy
Аннотация: *Публичные методы, унаследованные от интерфейса IStrategy.*

### Protected Member Functions
Аннотация: *Защищенные методы класса StopProfit, доступные для использования внутри класса и его наследников.*

- `override StopProfit CreateNew ()`
- `override void CommitChanges (StopProfit model, bool cloneOrders)`
- `override SimpleStopProfitSettings OnGetSettings ()`
- `override void OnSetSettings (SimpleStopProfitSettings settings)`
- `override ICollection< string > OnIsValidSettings (SimpleStopProfitSettings settings, decimal positionVolume, decimal positionPrice, decimal currentPrice)`
- `override void OnResetStopTakeOrderId ()`
- `override void OnResetCustomStopAndTakePrices ()`
- `override void DisableStopAndTake ()`
- `override void OnAttachStopAndTakeOrdersFailed ()`
- `override void OnProcessOrder (Order order)`
- `override async Task OnCancelAll (bool retryOnError)`
- `override async Task< bool > OnCancelSecondOrder (Order order)`
- `override bool SetStopOrTakeCancelledManually (Order order, string type)`
- `override bool SetStopOrTakeCustomPrice (Order currentStopOrTake, Order newOrder)`
- `override bool IsStopOrder (Order order)`
- `override bool IsTakeOrder (Order order)`
- `override async Task OnProcess (ChangesInfo info)`
- `override void OnCurrentPositionChanged ()`
- `override void OnPnLChanged (int ticks)`

#### Protected Member Functions inherited from ATAS.Strategies.ATM.BaseStopProfitStrategy < StopProfit, SimpleStopProfitSettings >
Аннотация: *Защищенные методы, унаследованные от базового класса BaseStopProfitStrategy.*

### Properties
Аннотация: *Свойства класса StopProfit, представляющие собой характеристики или состояния объекта.*

- `override bool IsStopOrderAttached [get]`
- `override bool IsTakeOrderAttached [get]`
- `override bool HasActiveOrders [get]`
- `StopProfitSettings TakeProfit [get]`
- `StopProfitSettings StopLoss [get]`
- `PriceUnit? CurrentStop [get]`
- `PriceUnit? CurrentTake [get]`
- `StrategyOrderId? StopOrderId [get]`
- `StrategyOrderId? TakeOrderId [get]`
- `BreakevenSettings Breakeven [get, set]`
- `TrailingStopSettings TrailingStop [get, set]`

#### Properties inherited from ATAS.Strategies.ATM.BaseStopProfitStrategy < StopProfit, SimpleStopProfitSettings >
Аннотация: *Свойства, унаследованные от базового класса BaseStopProfitStrategy.*

#### Properties inherited from ATAS.Strategies.ATM.ISimpleStopProfitStrategy
Аннотация: *Свойства, унаследованные от интерфейса ISimpleStopProfitStrategy.*

#### Properties inherited from ATAS.Strategies.ATM.IATMStrategy
Аннотация: *Свойства, унаследованные от интерфейса IATMStrategy.*

#### Properties inherited from ATAS.Strategies.IStrategy
Аннотация: *Свойства, унаследованные от интерфейса IStrategy.*

### Additional Inherited Members
Аннотация: *Дополнительные унаследованные члены класса, такие как атрибуты и события.*

#### Public Attributes inherited from ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >
Аннотация: *Публичные атрибуты, унаследованные от базового класса BaseStopProfitStrategy.*

#### Public Attributes inherited from ATAS.Strategies.ATM.IStopProfitStrategy< SimpleStopProfitSettings >
Аннотация: *Публичные атрибуты, унаследованные от интерфейса IStopProfitStrategy.*

#### Public Attributes inherited from ATAS.Strategies.ATM.IATMStrategy
Аннотация: *Публичные атрибуты, унаследованные от интерфейса IATMStrategy.*

#### Events inherited from ATAS.Strategies.ATM.IATMStrategy
Аннотация: *События, унаследованные от интерфейса IATMStrategy.*

#### Events inherited from ATAS.Strategies.IStrategy
Аннотация: *События, унаследованные от интерфейса IStrategy.*

### Constructor & Destructor Documentation
Аннотация: *Документация по конструктору и деструктору класса StopProfit.*

- `StopProfit()`
    - `ATAS.Strategies.ATM.StopProfit.StopProfit ( )`

### Member Function Documentation
Аннотация: *Детальная документация по методам класса StopProfit.*

- `CanSetCustomStop()`
    - `bool ATAS.Strategies.ATM.StopProfit.CanSetCustomStop( )`
    - Implements `ATAS.Strategies.ATM.ISupportCustomStopOrTake`.
- `CanSetCustomTake()`
    - `bool ATAS.Strategies.ATM.StopProfit.CanSetCustomTake ( )`
    - Implements `ATAS.Strategies.ATM.ISupportCustomStopOrTake`.
- `CommitChanges()`
    - `override void ATAS.Strategies.ATM.StopProfit.CommitChanges (StopProfit model, bool cloneOrders)`
- `CreateNew()`
    - `override StopProfit ATAS.Strategies.ATM.StopProfit.CreateNew ( )`
- `DisableStopAndTake()`
    - `override void ATAS.Strategies.ATM.StopProfit.DisableStopAndTake ( )`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `GetSettingsWithStopOrTake()`
    - `IStopProfitSettings ATAS.Strategies.ATM.StopProfit.GetSettingsWithStopOrTake (PriceUnit? stop, PriceUnit? take)`
    - Implements `ATAS.Strategies.ATM.ISupportCustomStopOrTake`.
- `IsStopOrder()`
    - `override bool ATAS.Strategies.ATM.StopProfit.IsStopOrder (Order order)`
- `IsTakeOrder()`
    - `override bool ATAS.Strategies.ATM.StopProfit.IsTakeOrder (Order order)`
- `OnAttachStopAndTakeOrdersFailed()`
    - `override void ATAS.Strategies.ATM.StopProfit.OnAttachStopAndTakeOrdersFailed ( )`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnCancelAll()`
    - `override async Task ATAS.Strategies.ATM.StopProfit.OnCancelAll (bool retryOnError)`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnCancelSecondOrder()`
    - `override async Task< bool > ATAS.Strategies.ATM.StopProfit.OnCancelSecondOrder (Order order)`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnCurrentPositionChanged()`
    - `override void ATAS.Strategies.ATM.StopProfit.OnCurrentPositionChanged()`
- `OnGetSettings()`
    - `override SimpleStopProfitSettings ATAS.Strategies.ATM.StopProfit.OnGetSettings( )`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnIsValidSettings()`
    - `override ICollection< string > ATAS.Strategies.ATM.StopProfit.OnIsValidSettings (SimpleStopProfitSettings settings, decimal positionVolume, decimal positionPrice, decimal currentPrice)`
- `OnPnLChanged()`
    - `override void ATAS.Strategies.ATM.StopProfit.OnPnLChanged (int ticks)`
- `OnProcess()`
    - `override async Task ATAS.Strategies.ATM.StopProfit.OnProcess (ChangesInfo info)`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnProcessOrder()`
    - `override void ATAS.Strategies.ATM.StopProfit.OnProcessOrder (Order order)`
    - Reimplemented from `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnResetCustomStopAndTakePrices()`
    - `override void ATAS.Strategies.ATM.StopProfit.OnResetCustomStopAndTakePrices ( )`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnResetStopTakeOrderId()`
    - `override void ATAS.Strategies.ATM.StopProfit.OnResetStopTakeOrderId ( )`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `OnSetSettings()`
    - `override void ATAS.Strategies.ATM.StopProfit.OnSetSettings (SimpleStopProfitSettings settings)`
- `SetCustomStopOrTake()`
    - `async Task ATAS.Strategies.ATM.StopProfit.SetCustomStopOrTake (PriceUnit? stop, PriceUnit? take)`
    - Implements `ATAS.Strategies.ATM.ISupportCustomStopOrTake`.
- `SetStopOrTakeCancelledManually()`
    - `override bool ATAS.Strategies.ATM.StopProfit.SetStopOrTakeCancelledManually (Order order, string type)`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.
- `SetStopOrTakeCustomPrice()`
    - `override bool ATAS.Strategies.ATM.StopProfit.SetStopOrTakeCustomPrice (Order currentStopOrTake, Order newOrder)`
    - Implements `ATAS.Strategies.ATM.BaseStopProfitStrategy< StopProfit, SimpleStopProfitSettings >`.

### Property Documentation
Аннотация: *Детальная документация по свойствам класса StopProfit.*

- `Breakeven`
    - `BreakevenSettings ATAS.Strategies.ATM.StopProfit.Breakeven [get, set]`
    - Implements `ATAS.Strategies.ATM.ISimpleStopProfitStrategy`.
- `CurrentStop`
    - `PriceUnit? ATAS.Strategies.ATM.StopProfit.CurrentStop [get]`
    - Implements `ATAS.Strategies.ATM.ISimpleStopProfitStrategy`.
- `CurrentTake`
    - `PriceUnit? ATAS.Strategies.ATM.StopProfit.CurrentTake [get]`
    - Implements `ATAS.Strategies.ATM.ISimpleStopProfitStrategy`.
- `HasActiveOrders`
    - `override bool ATAS.Strategies.ATM.StopProfit.HasActiveOrders [get]`
    - Implements `ATAS.Strategies.ATM.IATMStrategy`.
- `IsStopOrderAttached`
    - `override bool ATAS.Strategies.ATM.StopProfit.IsStopOrderAttached [get]`
- `IsTakeOrderAttached`
    - `override bool ATAS.Strategies.ATM.StopProfit.IsTakeOrderAttached [get]`
- `StopLoss`
    - `StopProfitSettings ATAS.Strategies.ATM.StopProfit.StopLoss [get]`
    - Implements `ATAS.Strategies.ATM.ISimpleStopProfitStrategy`.
- `StopOrderId`
    - `StrategyOrderId? ATAS.Strategies.ATM.StopProfit.StopOrderId [get]`
- `TakeOrderId`
    - `StrategyOrderId? ATAS.Strategies.ATM.StopProfit.TakeOrderId [get]`
- `TakeProfit`
    - `StopProfitSettings ATAS.Strategies.ATM.StopProfit.TakeProfit [get]`
    - Implements `ATAS.Strategies.ATM.ISimpleStopProfitStrategy`.
- `TrailingStop`
    - `TrailingStopSettings ATAS.Strategies.ATM.StopProfit.TrailingStop [get, set]`
    - Implements `ATAS.Strategies.ATM.ISimpleStopProfitStrategy`.

### Source File
Аннотация: *Информация об исходном файле, в котором определен класс StopProfit.*

- `StopProfit.cs`






## Методичка по ATAS.Strategies.Chart Namespace Reference

### Пространство имен ATAS.Strategies.Chart

**Описание:** Данное пространство имен предназначено для работы с чартовыми стратегиями в платформе ATAS. Оно содержит классы и определения типов, необходимых для разработки стратегий, взаимодействующих с графиками и рыночными данными.

### Классы (Classes)

1.  **ChartStrategy**

    *   **Тип:** `class` (класс)
    *   **Описание:** Представляет собой абстрактный класс для чартовой стратегии. Этот класс расширяет функциональность индикатора и реализует интерфейсы `IChartStrategy` и `ILoggerSource`.
    *   **Аннотация:** `ChartStrategy` - это основной класс для создания стратегий, которые отображаются на графике и используют данные графика. Абстрактный класс означает, что вы не можете создать экземпляр `ChartStrategy` напрямую, а должны создать производный класс.

2.  **IChartStrategy**

    *   **Тип:** `interface` (интерфейс)
    *   **Описание:** Представляет интерфейс чартовой стратегии. Расширяет базовую функциональность `IStrategy` и добавляет возможности, связанные с работой на графике.
    *   **Аннотация:** `IChartStrategy` - это интерфейс, который определяет контракт для чартовых стратегий. Интерфейсы задают набор методов и свойств, которые должны быть реализованы классами, реализующими этот интерфейс.

3.  **SmaChartStrategy**

    *   **Тип:** `class` (класс)
    *   **Описание:**  (Описание отсутствует в предоставленном фрагменте, но из названия можно предположить, что это класс для стратегии, основанной на скользящей средней - Simple Moving Average).
    *   **Аннотация:** `SmaChartStrategy` - вероятно, конкретная реализация чартовой стратегии, использующая скользящую среднюю.  (Нужно уточнить описание в полной документации).

### Определения типов (Typedefs)

1.  **MarketDataType**

    *   **Тип:** `using` (определение типа)
    *   **Определение:** `using MarketDataType = ATAS.Indicators.MarketDataType`
    *   **Описание:**  `MarketDataType` является псевдонимом для типа `ATAS.Indicators.MarketDataType`.
    *   **Аннотация:** `MarketDataType` - это тип данных, представляющий рыночные данные, такие как цена, объем и т.д. Он определен в пространстве имен `ATAS.Indicators` и используется для работы с рыночными данными в стратегиях.  `typedef` (или `using` в C++) создает новое имя для уже существующего типа данных, что упрощает код и делает его более читаемым.

### Документация по Typedef

#### MarketDataType

*   **Описание:**
    `using ATAS.Strategies.Chart.MarketDataType = typedef ATAS.Indicators.MarketDataType`
*   **Аннотация:**  Это повторное описание `MarketDataType`, подчеркивающее, что в пространстве имен `ATAS.Strategies.Chart`  `MarketDataType`  является тем же типом, что и `ATAS.Indicators.MarketDataType`. Это гарантирует согласованность использования типа данных для рыночных данных в разных частях кода ATAS.








## Методичка по классу `ATAS.Strategies.Chart.ChartStrategy` для создания стратегий ATAS

### Общее описание класса

`ATAS.Strategies.Chart.ChartStrategy` — это абстрактный класс для разработки стратегий на графике, который расширяет функциональность индикатора и реализует интерфейсы `IChartStrategy` и `ILoggerSource`.

### Диаграмма наследования

```
INotifyPropertyChanged
    TrackedPropertyBase
        ChartObject
            BaseIndicator
                ExtendedIndicator
                    Indicator
                        ATAS.Strategies.Chart.ChartStrategy
                            ATAS.Strategies.Chart.SmaChartStrategy
        IDisposable
        INotifyPanelPropertyChanged
        ICustomTypeDescriptor
        IMarketTimeProvider
    IStrategy
    IChartStrategy
    ILoggerSource
```

### Диаграмма взаимодействия

```
IChartStrategy   <--   ATAS.Strategies.Chart.ChartStrategy   -->   ILoggerSource
```

### Публичные члены класса (Public Member Functions)

*   `void Start ()`
    *   Запускает стратегию.
*   `void Suspend ()`
    *   Приостанавливает стратегию.
*   `void Stop ()`
    *   Останавливает стратегию.
*   `void StopWithNotification (string message)`
    *   Останавливает стратегию с уведомлением, отображающим сообщение `message`.
    *   **Параметры:**
        *   `message`: Сообщение для отображения в уведомлении.
*   `Task StartAsync()`
    *   Асинхронно запускает стратегию, позволяя ей выполнять торговую логику.
*   `Task SuspendAsync ()`
    *   Асинхронно приостанавливает стратегию.
*   `Task StopAsync ()`
    *   Асинхронно останавливает стратегию, завершая ее выполнение и освобождая ресурсы.
*   `async Task StopWithNotificationAsync (string message)`
    *   Асинхронно останавливает стратегию с уведомлением, отображающим сообщение `message`.
*   `async Task OpenOrderAsync (Order order)`
    *   Асинхронно открывает ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для открытия.
*   `async void OpenOrder (Order order)`
    *   Открывает ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для открытия.
*   `async Task ModifyOrderAsync (Order order, Order newOrder)`
    *   Асинхронно изменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для изменения.
        *   `newOrder`: Новый ордер с обновленными параметрами.
*   `async void ModifyOrder (Order order, Order newOrder)`
    *   Изменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для изменения.
        *   `newOrder`: Новый ордер с обновленными параметрами.
*   `async Task CancelOrderAsync (Order order)`
    *   Асинхронно отменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для отмены.
*   `async void CancelOrder (Order order)`
    *   Отменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для отмены.

### Публичные члены класса, унаследованные от `ATAS.Indicators.Indicator`

*   (Список унаследованных членов)

### Публичные члены класса, унаследованные от `ATAS.Indicators.ExtendedIndicator`

*   (Список унаследованных членов)

### Публичные члены класса, унаследованные от `ATAS.Indicators.BaseIndicator`

*   (Список унаследованных членов)

### Публичные члены класса, унаследованные от `ATAS.Indicators.ChartObject`

*   `void SubscribeToTimer (TimeSpan period, Action callback)`
    *   Регистрирует обратный вызов и периодически вызывает его с указанным периодом.
*   `void UnsubscribeFromTimer (TimeSpan period, Action callback)`
    *   Отменяет регистрацию обратного вызова от периодических вызовов.
*   `void StopWithNotification (string message)`
    *   Останавливает стратегию с уведомлением, отображающим сообщение `message`.
*   `void OpenOrder (Order order)`
    *   Открывает ордер для стратегии.
*   `void ModifyOrder (Order order, Order newOrder)`
    *   Изменяет существующий ордер для стратегии.
*   `void CancelOrder (Order order)`
    *   Отменяет существующий ордер для стратегии.
*   `Task OpenOrderAsync (Order order)`
    *   Асинхронно открывает ордер для стратегии.
*   `Task ModifyOrderAsync (Order order, Order newOrder)`
    *   Асинхронно изменяет существующий ордер для стратегии.
*   `Task CancelOrderAsync (Order order)`
    *   Асинхронно отменяет существующий ордер для стратегии.
*   `Task StartAsync()`
    *   Асинхронно запускает стратегию, позволяя ей выполнять торговую логику.

### Защищенные члены класса (Protected Member Functions)

*   `ChartStrategy (bool useCandles=false)`
    *   Защищенный конструктор для класса `ChartStrategy`.
*   `void RaiseShowNotification (string message, string title=null, LoggingLevel level=LoggingLevel.Info)`
    *   Вызывает уведомление с заданным `message`, `title` (опционально) и уровнем логирования `level`. Если `title` не указан, используется имя стратегии. В зависимости от уровня логирования сообщение регистрируется соответствующим методом логирования (Info, Warning, Error). В конце вызывается событие `ShowNotification` для уведомления подписчиков об уведомлении.
*   `bool SetProperty< TValue > (ref TValue storage, TValue newValue, string propertyName, Action< TValue, TValue > onChanged=null)`
    *   Устанавливает значение свойства `propertyName` на `newValue`. Если новое значение отличается от текущего, свойство обновляется и вызывается событие `PropertyChanged`. Дополнительно, если предоставлено действие `onChanged`, оно будет вызвано со старым и новым значениями после обновления свойства. Возвращает `true`, если свойство было обновлено, `false` в противном случае.
*   `decimal ShrinkPrice (decimal price)`
    *   Округляет заданную цену `price` до ближайшего размера тика инструмента и возвращает результат.
*   `override void OnContainerChanged (IIndicatorContainer container)`
    *   Этот метод вызывается, когда изменяется значение свойства `Container`.
    *   **Параметры:**
        *   `container`: Новое значение `IIndicatorContainer`, к которому прикреплен индикатор.
*   `override void OnDataProviderChanged (IIndicatorDataProvider oldDataProvider, IIndicatorDataProvider newDataProvider)`
    *   Этот метод вызывается, когда изменяется значение свойства `DataProvider`.
    *   **Параметры:**
        *   `oldDataProvider`: Старое значение `IIndicatorDataProvider`.
        *   `newDataProvider`: Новое значение `IIndicatorDataProvider`.
*   `override void OnBestBidAskChanged (MarketDataArg depth)`
    *   Обрабатывает изменения лучших цен Bid или Ask в глубине рынка, представленной объектом `MarketDataArg`.
    *   **Параметры:**
        *   `depth`: `MarketDataArg`, представляющий данные глубины рынка.
*   `override void OnNewMyTrade (MyTrade myTrade)`
    *   Вызывается, когда получен новый трейд, исполненный собственной стратегией индикатора.
    *   **Параметры:**
        *   `myTrade`: Новый трейд, исполненный собственной стратегией индикатора.
*   `virtual void OnStarted ()`
    *   Метод вызывается при запуске стратегии.
*   `virtual void OnSuspended ()`
    *   Метод вызывается при приостановке стратегии.
*   `virtual void OnStopping ()`
    *   Метод вызывается при остановке стратегии.
*   `virtual void OnStopped ()`
    *   Метод вызывается при остановке стратегии.
*   `virtual void OnCurrentPositionChanged ()`
    *   Метод вызывается, когда изменяется объем текущей позиции.
*   `virtual bool CanProcess (int bar)`
    *   Определяет, может ли стратегия обрабатывать данные для указанного бара.

### Защищенные члены класса, унаследованные от `ATAS.Indicators.Indicator`

*   (Список унаследованных членов)

### Защищенные члены класса, унаследованные от `ATAS.Indicators.ExtendedIndicator`

*   (Список унаследованных членов)

### Защищенные члены класса, унаследованные от `ATAS.Indicators.BaseIndicator`

*   (Список унаследованных членов)

### Защищенные члены класса, унаследованные от `ATAS.Indicators.ChartObject`

*   (Список унаследованных членов)

### Защищенные члены класса, унаследованные от `ATAS.Indicators.Filters.TrackedPropertyBase`

*   (Список унаследованных членов)

### Свойства (Properties)

*   `IEnumerable< Order > Orders { get; }`
    *   Возвращает коллекцию ордеров, связанных с этой стратегией.
*   `IEnumerable< MyTrade > MyTrades { get; }`
    *   Возвращает коллекцию трейдов, связанных с этой стратегией.
*   `StrategyStates State { get; protected set; }`
    *   Возвращает текущее состояние стратегии.
*   `bool IsActivated { get; }`
    *   Возвращает, активирована ли стратегия.
*   `decimal CurrentPosition { get; }`
    *   Возвращает текущий объем позиции стратегии.
*   `decimal AveragePrice { get; }`
    *   Возвращает среднюю цену трейдов стратегии.
*   `decimal OpenPnL { get; }`
    *   Возвращает открытую прибыль и убыток стратегии.
*   `decimal ClosedPnL { get; }`
    *   Возвращает закрытую прибыль и убыток стратегии.
*   `Security Security { get; set; }`
    *   Возвращает или устанавливает инструмент, связанный со стратегией.
*   `Portfolio Portfolio { get; set; }`
    *   Возвращает или устанавливает портфель, связанный со стратегией.
*   `TPlusLimits? TPlusLimit { get; set; }`
    *   Возвращает или устанавливает лимиты T+ для стратегии.
*   `MarketDataArg BestBid { get; }`
    *   Возвращает лучшие данные Bid рынка, связанные с этой стратегией графика.
*   `MarketDataArg BestAsk { get; }`
    *   Возвращает лучшие данные Ask рынка, связанные с этой стратегией графика.
*   `IDataFeedConnector Connector { get; set; }`
    *   Возвращает или устанавливает коннектор данных для стратегии.
*   `Guid LoggerId { get; set; }`
    *   Возвращает или устанавливает идентификатор логгера.
*   `string LoggerName { get; set; }`
    *   Возвращает или устанавливает имя логгера.
*   `LoggingLevel LoggingLevel { get; set; }`
    *   Возвращает или устанавливает уровень логирования.
*   `ILoggerSource ParentLoggerSource { get; set; }`
    *   Возвращает или устанавливает родительский источник логгера.
*   `ICachedCollection< ILoggerSource > ChildLoggerSources { get; } = new SyncList<ILoggerSource>()`
    *   Возвращает коллекцию дочерних источников логгера.

### Свойства, унаследованные от `ATAS.Indicators.Indicator`

*   (Список унаследованных свойств)

### Свойства, унаследованные от `ATAS.Indicators.ExtendedIndicator`

*   (Список унаследованных свойств)

### Свойства, унаследованные от `ATAS.Indicators.BaseIndicator`

*   (Список унаследованных свойств)

### Свойства, унаследованные от `ATAS.Indicators.ChartObject`

*   (Список унаследованных свойств)

### Свойства, унаследованные от `ATAS.Indicators.IMarketTimeProvider`

*   (Список унаследованных свойств)

### Свойства, унаследованные от `ATAS.Strategies.Chart.IChartStrategy`

*   (Список унаследованных свойств)

### Свойства, унаследованные от `ATAS.Strategies.IStrategy`

*   (Список унаследованных свойств)

### События (Events)

*   `EventHandler< StrategyStateChangedEventArgs > StateChanged`
    *   Событие, возникающее при изменении состояния стратегии.
*   `EventHandler< StrategyNotificationEventArgs > ShowNotification`
    *   Событие, возникающее при показе уведомления стратегии.
*   `Action LoggerSettingsChanged`
    *   Событие, возникающее при изменении настроек логгера.

### События, унаследованные от `ATAS.Indicators.BaseIndicator`

*   (Список унаследованных событий)

### События, унаследованные от `ATAS.Indicators.Filters.TrackedPropertyBase`

*   (Список унаследованных событий)

### События, унаследованные от `ATAS.Indicators.INotifyPanelPropertyChanged`

*   (Список унаследованных событий)

### События, унаследованные от `ATAS.Strategies.IStrategy`

*   (Список унаследованных событий)

### Дополнительные унаследованные члены

*   Статические защищенные члены класса, унаследованные от `ATAS.Indicators.BaseIndicator`
    *   (Список унаследованных статических защищенных членов)
*   Защищенные атрибуты, унаследованные от `ATAS.Indicators.BaseIndicator`
    *   (Список унаследованных защищенных атрибутов)

### Подробное описание

Класс `ATAS.Strategies.Chart.ChartStrategy` представляет собой абстрактный класс для стратегий на графике, который расширяет функциональность индикатора и реализует интерфейсы `IChartStrategy` и `ILoggerSource`.

### Документация конструктора и деструктора

*   `ChartStrategy()`
    *   `ATAS.Strategies.Chart.ChartStrategy.ChartStrategy (bool useCandles = false)` `protected`
    *   Защищенный конструктор для класса `ChartStrategy`.
    *   **Параметры:**
        *   `useCandles`: Булево значение, указывающее, используются ли свечи.

### Документация функций-членов

*   `CancelOrder()`
    *   `async void ATAS.Strategies.Chart.ChartStrategy.CancelOrder (Order order)`
    *   Отменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для отмены.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.CancelOrder`.
*   `CancelOrderAsync()`
    *   `async Task ATAS.Strategies.Chart.ChartStrategy.CancelOrderAsync (Order order)`
    *   Асинхронно отменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для отмены.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.CancelOrderAsync`.
*   `CanProcess()`
    *   `virtual bool ATAS.Strategies.Chart.ChartStrategy.CanProcess (int bar)` `protected virtual`
    *   Определяет, может ли стратегия обрабатывать данные для указанного бара.
    *   **Параметры:**
        *   `bar`: Индекс текущего бара.
    *   **Возвращает:**
        *   `true`, если стратегия может обрабатывать данные для указанного бара, `false` в противном случае.
*   `ModifyOrder()`
    *   `async void ATAS.Strategies.Chart.ChartStrategy.ModifyOrder (Order order, Order newOrder)`
    *   Изменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для изменения.
        *   `newOrder`: Новый ордер с обновленными параметрами.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.ModifyOrder`.
*   `ModifyOrderAsync()`
    *   `async Task ATAS.Strategies.Chart.ChartStrategy.ModifyOrderAsync (Order order, Order newOrder)`
    *   Асинхронно изменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для изменения.
        *   `newOrder`: Новый ордер с обновленными параметрами.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.ModifyOrderAsync`.
*   `OnBestBidAskChanged()`
    *   `override void ATAS.Strategies.Chart.ChartStrategy.OnBestBidAskChanged (MarketDataArg depth)` `protected virtual`
    *   Обрабатывает изменения лучших цен Bid или Ask в глубине рынка, представленной объектом `MarketDataArg`.
    *   **Параметры:**
        *   `depth`: `MarketDataArg`, представляющий данные глубины рынка.
    *   **Реализовано из:** `ATAS.Indicators.ExtendedIndicator.OnBestBidAskChanged`.
*   `OnContainerChanged()`
    *   `override void ATAS.Strategies.Chart.ChartStrategy.OnContainerChanged (IIndicatorContainer container)` `protected virtual`
    *   Этот метод вызывается, когда изменяется значение свойства `Container`.
    *   **Параметры:**
        *   `container`: Новое значение `IIndicatorContainer`, к которому прикреплен индикатор.
    *   **Реализовано из:** `ATAS.Indicators.ExtendedIndicator.OnContainerChanged`.
*   `OnCurrentPositionChanged()`
    *   `virtual void ATAS.Strategies.Chart.ChartStrategy.OnCurrentPositionChanged ()` `protected virtual`
    *   Метод вызывается, когда изменяется объем текущей позиции.
*   `OnDataProviderChanged()`
    *   `override void ATAS.Strategies.Chart.ChartStrategy.OnDataProviderChanged (IIndicatorDataProvider oldDataProvider, IIndicatorDataProvider newDataProvider)` `protected virtual`
    *   Этот метод вызывается, когда изменяется значение свойства `DataProvider`.
    *   **Параметры:**
        *   `oldDataProvider`: Старое значение `IIndicatorDataProvider`.
        *   `newDataProvider`: Новое значение `IIndicatorDataProvider`.
    *   **Реализовано из:** `ATAS.Indicators.ExtendedIndicator.OnDataProviderChanged`.
*   `OnNewMyTrade()`
    *   `override void ATAS.Strategies.Chart.ChartStrategy.OnNewMyTrade (MyTrade myTrade)` `protected virtual`
    *   Вызывается, когда получен новый трейд, исполненный собственной стратегией индикатора.
    *   **Параметры:**
        *   `myTrade`: Новый трейд, исполненный собственной стратегией индикатора.
    *   **Реализовано из:** `ATAS.Indicators.ExtendedIndicator.OnNewMyTrade`.
*   `OnStarted()`
    *   `virtual void ATAS.Strategies.Chart.ChartStrategy.OnStarted ()` `protected virtual`
    *   Метод вызывается при запуске стратегии.
*   `OnStopped()`
    *   `virtual void ATAS.Strategies.Chart.ChartStrategy.OnStopped ()` `protected virtual`
    *   Метод вызывается при остановке стратегии.
*   `OnStopping()`
    *   `virtual void ATAS.Strategies.Chart.ChartStrategy.OnStopping ()` `protected virtual`
    *   Метод вызывается при остановке стратегии.
    *   **Реализовано в:** `ATAS.Strategies.Chart.SmaChartStrategy.OnStopping`.
*   `OnSuspended()`
    *   `virtual void ATAS.Strategies.Chart.ChartStrategy.OnSuspended ()` `protected virtual`
    *   Метод вызывается при приостановке стратегии.
*   `OpenOrder()`
    *   `async void ATAS.Strategies.Chart.ChartStrategy.OpenOrder (Order order)`
    *   Открывает ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для открытия.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.OpenOrder`.
*   `OpenOrderAsync()`
    *   `async Task ATAS.Strategies.Chart.ChartStrategy.OpenOrderAsync (Order order)`
    *   Асинхронно открывает ордер для стратегии.
    *   **Параметры:**
        *   `order`: Ордер для открытия.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.OpenOrderAsync`.
*   `RaiseShowNotification()`
    *   `void ATAS.Strategies.Chart.ChartStrategy.RaiseShowNotification (string message, string title = null, LoggingLevel level = LoggingLevel.Info)` `protected`
    *   Вызывает уведомление с заданным `message`, `title` (опционально) и уровнем логирования `level`. Если `title` не указан, используется имя стратегии. В зависимости от уровня логирования сообщение регистрируется соответствующим методом логирования (Info, Warning, Error). В конце вызывается событие `ShowNotification` для уведомления подписчиков об уведомлении.
    *   **Параметры:**
        *   `message`: Сообщение уведомления.
        *   `title`: Заголовок уведомления (опционально).
        *   `level`: Уровень логирования уведомления (по умолчанию Info).
*   `SetProperty< TValue >()`
    *   `bool ATAS.Strategies.Chart.ChartStrategy.SetProperty< TValue > (ref TValue storage, TValue newValue, string propertyName, Action< TValue, TValue > onChanged = null)` `protected`
    *   Устанавливает значение свойства `propertyName` на `newValue`. Если новое значение отличается от текущего, свойство обновляется и вызывается событие `PropertyChanged`. Дополнительно, если предоставлено действие `onChanged`, оно будет вызвано со старым и новым значениями после обновления свойства. Возвращает `true`, если свойство было обновлено, `false` в противном случае.
    *   **Параметры шаблона:**
        *   `TValue`: Тип значения свойства.
    *   **Параметры:**
        *   `storage`: Ссылка на значение свойства.
        *   `newValue`: Новое значение для установки.
        *   `propertyName`: Имя свойства.
        *   `onChanged`: Опциональное действие, которое будет вызвано при изменении значения свойства.
    *   **Возвращает:**
        *   `true`, если свойство было обновлено, `false` в противном случае.
*   `ShrinkPrice()`
    *   `decimal ATAS.Strategies.Chart.ChartStrategy.ShrinkPrice (decimal price)` `protected`
    *   Округляет заданную цену `price` до ближайшего размера тика инструмента и возвращает результат.
    *   **Параметры:**
        *   `price`: Цена для округления.
    *   **Возвращает:**
        *   Округленное значение цены.
*   `Start()`
    *   `void ATAS.Strategies.Chart.ChartStrategy.Start()` `protected`
*   `StartAsync()`
    *   `Task ATAS.Strategies.Chart.ChartStrategy.StartAsync()`
    *   Запускает стратегию, позволяя ей выполнять торговую логику.
    *   **Реализует:** `ATAS.Strategies.IStrategy.StartAsync`.
*   `Stop()`
    *   `void ATAS.Strategies.Chart.ChartStrategy.Stop()`
*   `StopAsync()`
    *   `Task ATAS.Strategies.Chart.ChartStrategy.StopAsync()`
    *   Останавливает стратегию, завершая ее выполнение и освобождая ресурсы.
    *   **Реализует:** `ATAS.Strategies.IStrategy.StopAsync`.
*   `StopWithNotification()`
    *   `void ATAS.Strategies.Chart.ChartStrategy.StopWithNotification (string message)`
    *   Останавливает стратегию с уведомлением, отображающим сообщение `message`.
    *   **Параметры:**
        *   `message`: Сообщение для отображения в уведомлении.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.StopWithNotification`.
*   `StopWithNotificationAsync()`
    *   `async Task ATAS.Strategies.Chart.ChartStrategy.StopWithNotificationAsync (string message)`
*   `Suspend()`
    *   `void ATAS.Strategies.Chart.ChartStrategy.Suspend()`
*   `SuspendAsync()`
    *   `Task ATAS.Strategies.Chart.ChartStrategy.SuspendAsync()`

### Документация свойств

*   `AveragePrice`
    *   `decimal ATAS.Strategies.Chart.ChartStrategy.AveragePrice` `get`
    *   Возвращает среднюю цену трейдов стратегии.
    *   **Реализует:** `ATAS.Strategies.IStrategy.AveragePrice`.
*   `BestAsk`
    *   `MarketDataArg ATAS.Strategies.Chart.ChartStrategy.BestAsk` `get`
    *   Возвращает лучшие данные Ask рынка, связанные с этой стратегией графика.
*   `BestBid`
    *   `MarketDataArg ATAS.Strategies.Chart.ChartStrategy.BestBid` `get`
    *   Возвращает лучшие данные Bid рынка, связанные с этой стратегией графика.
*   `ChildLoggerSources`
    *   `ICachedCollection<ILoggerSource> ATAS.Strategies.Chart.ChartStrategy.ChildLoggerSources = new SyncList<ILoggerSource>()` `get`
*   `ClosedPnL`
    *   `decimal ATAS.Strategies.Chart.ChartStrategy.ClosedPnL` `get`
    *   Возвращает закрытую прибыль и убыток стратегии.
    *   **Реализует:** `ATAS.Strategies.IStrategy.ClosedPnL`.
*   `Connector`
    *   `IDataFeedConnector ATAS.Strategies.Chart.ChartStrategy.Connector` `get set`
    *   Возвращает или устанавливает коннектор данных для стратегии.
    *   **Реализует:** `ATAS.Strategies.IStrategy.Connector`.
*   `CurrentPosition`
    *   `decimal ATAS.Strategies.Chart.ChartStrategy.CurrentPosition` `get`
    *   Возвращает текущий объем позиции стратегии.
    *   **Реализует:** `ATAS.Strategies.IStrategy.CurrentPosition`.
*   `IsActivated`
    *   `bool ATAS.Strategies.Chart.ChartStrategy.IsActivated` `get`
*   `LoggerId`
    *   `Guid ATAS.Strategies.Chart.ChartStrategy.LoggerId` `get set`
*   `LoggerName`
    *   `string ATAS.Strategies.Chart.ChartStrategy.LoggerName` `get set`
*   `LoggingLevel`
    *   `LoggingLevel ATAS.Strategies.Chart.ChartStrategy.LoggingLevel` `get set`
*   `MyTrades`
    *   `IEnumerable<MyTrade> ATAS.Strategies.Chart.ChartStrategy.MyTrades` `get`
    *   Возвращает коллекцию трейдов, связанных с этой стратегией.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.MyTrades`.
*   `OpenPnL`
    *   `decimal ATAS.Strategies.Chart.ChartStrategy.OpenPnL` `get`
    *   Возвращает открытую прибыль и убыток стратегии.
    *   **Реализует:** `ATAS.Strategies.IStrategy.OpenPnL`.
*   `Orders`
    *   `IEnumerable<Order> ATAS.Strategies.Chart.ChartStrategy.Orders` `get`
    *   Возвращает коллекцию ордеров, связанных с этой стратегией.
    *   **Реализует:** `ATAS.Strategies.Chart.IChartStrategy.Orders`.
*   `ParentLoggerSource`
    *   `ILoggerSource ATAS.Strategies.Chart.ChartStrategy.ParentLoggerSource` `get set`
*   `Portfolio`
    *   `Portfolio ATAS.Strategies.Chart.ChartStrategy.Portfolio` `get set`
    *   Возвращает или устанавливает портфель, связанный со стратегией.
    *   Это свойство не поддерживает установку. Попытка установить это свойство вызовет исключение `NotSupportedException`.
    *   **Исключения:**
        *   `NotSupportedException`
    *   **Реализует:** `ATAS.Strategies.IStrategy.Portfolio`.
*   `Security`
    *   `Security ATAS.Strategies.Chart.ChartStrategy.Security` `get set`
    *   Возвращает или устанавливает инструмент, связанный со стратегией.
    *   Это свойство не поддерживает установку. Попытка установить это свойство вызовет исключение `NotSupportedException`.
    *   **Исключения:**
        *   `NotSupportedException`
    *   **Реализует:** `ATAS.Strategies.IStrategy.Security`.
*   `State`
    *   `StrategyStates ATAS.Strategies.Chart.ChartStrategy.State` `get protected set`
    *   Возвращает текущее состояние стратегии.
    *   **Реализует:** `ATAS.Strategies.IStrategy.State`.
*   `TPlusLimit`
    *   `TPlusLimits? ATAS.Strategies.Chart.ChartStrategy.TPlusLimit` `get set`
    *   Возвращает или устанавливает лимиты T+ для стратегии.
    *   Это свойство не поддерживает установку. Попытка установить это свойство вызовет исключение `NotSupportedException`.
    *   **Исключения:**
        *   `NotSupportedException`
    *   **Реализует:** `ATAS.Strategies.IStrategy.TPlusLimit`.

### Документация событий

*   `LoggerSettingsChanged`
    *   `Action ATAS.Strategies.Chart.ChartStrategy.LoggerSettingsChanged`
*   `ShowNotification`
    *   `EventHandler<StrategyNotificationEventArgs> ATAS.Strategies.Chart.ChartStrategy.ShowNotification`
*   `StateChanged`
    *   `EventHandler<StrategyStateChangedEventArgs> ATAS.Strategies.Chart.ChartStrategy.StateChanged`

### Файл документации класса

*   `ChartStrategy.cs`








## Методичка по интерфейсу ATAS.Strategies.Chart.IChartStrategy для ИИ

### Описание интерфейса IChartStrategy

Интерфейс `ATAS.Strategies.Chart.IChartStrategy` представляет собой стратегию для работы с графиком. Он расширяет базовую функциональность интерфейса `IStrategy`, добавляя возможности, связанные с графиками.

### Диаграмма наследования

```
INotifyPropertyChanged
    ↑
IStrategy
    ↑
ATAS.Strategies.Chart.IChartStrategy
    ↑
ATAS.Strategies.Chart.ChartStrategy
    ↑
ATAS.Strategies.Chart.SmaChartStrategy
```

**Аннотация:** Диаграмма показывает, что `IChartStrategy` наследуется от `IStrategy` и `INotifyPropertyChanged`. В свою очередь, `ChartStrategy` и `SmaChartStrategy` наследуются от `IChartStrategy`. Это означает, что `IChartStrategy` является промежуточным интерфейсом, добавляющим функциональность для работы с графиками к базовой стратегии `IStrategy`.

### Диаграмма взаимодействия

```
INotifyPropertyChanged
    ↑
IStrategy
    ↑
ATAS.Strategies.Chart.IChartStrategy
```

**Аннотация:**  Диаграмма взаимодействия подчеркивает, что `IChartStrategy` зависит от интерфейсов `IStrategy` и `INotifyPropertyChanged`, используя их функциональность.

### Публичные методы

*   `void StopWithNotification(string message)`

    Останавливает стратегию и отправляет уведомление с заданным сообщением.

    **Параметры:**
    *   `message` - Сообщение уведомления (тип `string`).

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

*   `void OpenOrder(Order order)`

    Открывает ордер для стратегии.

    **Параметры:**
    *   `order` - Ордер для открытия (тип `Order`).

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

*   `void ModifyOrder(Order order, Order newOrder)`

    Модифицирует существующий ордер стратегии.

    **Параметры:**
    *   `order` - Ордер для модификации (тип `Order`).
    *   `newOrder` - Новый ордер с обновленными параметрами (тип `Order`).

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

*   `void CancelOrder(Order order)`

    Отменяет существующий ордер стратегии.

    **Параметры:**
    *   `order` - Ордер для отмены (тип `Order`).

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

*   `Task OpenOrderAsync(Order order)`

    Асинхронно открывает ордер для стратегии.

    **Параметры:**
    *   `order` - Ордер для открытия (тип `Order`).

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

*   `Task ModifyOrderAsync(Order order, Order newOrder)`

    Асинхронно модифицирует существующий ордер стратегии.

    **Параметры:**
    *   `order` - Ордер для модификации (тип `Order`).
    *   `newOrder` - Новый ордер с обновленными параметрами (тип `Order`).

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

*   `Task CancelOrderAsync(Order order)`

    Асинхронно отменяет существующий ордер стратегии.

    **Параметры:**
    *   `order` - Ордер для отмены (тип `Order`).

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

### Свойства

*   `IEnumerable<Order> Orders { get; }`

    Возвращает коллекцию ордеров, связанных с данной стратегией.

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

*   `IEnumerable<MyTrade> MyTrades { get; }`

    Возвращает коллекцию сделок, связанных с данной стратегией.

    **Реализация:** Реализован в классе `ATAS.Strategies.Chart.ChartStrategy`.

### Унаследованные члены

*   **Публичные методы, унаследованные от `ATAS.Strategies.IStrategy`**
*   **Свойства, унаследованные от `ATAS.Strategies.IStrategy`**
*   **События, унаследованные от `ATAS.Strategies.IStrategy`**

**Аннотация:** Интерфейс `IChartStrategy` также наследует члены от базового интерфейса `IStrategy`. Для полного понимания функциональности стратегий на основе `IChartStrategy` необходимо также учитывать члены, унаследованные от `IStrategy`.

### Подробное описание

Интерфейс `ATAS.Strategies.Chart.IChartStrategy` представляет собой стратегию для работы с графиками и расширяет `IStrategy` дополнительными функциями, специфичными для графиков.

### Файл документации

Документация для этого интерфейса была сгенерирована из файла:

*   `IChartStrategy.cs`







## Методичка по классу `ATAS.Strategies.Chart.SmaChartStrategy`

### Введение

Класс `ATAS.Strategies.Chart.SmaChartStrategy` предназначен для реализации стратегий, основанных на скользящих средних (SMA) в платформе ATAS.  Этот класс наследуется от `ChartStrategy` и предоставляет функциональность для создания индикаторов и торговых стратегий, использующих SMA. Класс определен в файле `SmaChartStrategy.cs`.

**Диаграмма наследования:**

`INotifyPropertyChanged` -> `TrackedPropertyBase` -> `ChartObject` -> `IDisposable` -> `INotifyPanelPropertyChanged` -> `BaseIndicator` -> `ICustomTypeDescriptor` -> `IMarketTimeProvider` -> `ExtendedIndicator` -> `Indicator` -> `IChartStrategy` -> `ChartStrategy` -> `ILoggerSource` -> `ATAS.Strategies.Chart.SmaChartStrategy`

### Публичные члены класса

#### Конструктор

*   `SmaChartStrategy()`
    *   **Описание:** Конструктор класса `SmaChartStrategy`.  Инициализирует новый экземпляр класса.

#### Методы

*   `SubscribeToTimer(TimeSpan period, Action callback)`
    *   **Описание:** Регистрирует функцию обратного вызова (callback), которая будет периодически вызываться через заданный интервал `period`.
    *   **Параметры:**
        *   `period`:  Интервал времени типа `TimeSpan`, определяющий период вызова функции обратного вызова.
        *   `callback`:  Функция обратного вызова типа `Action`, которая будет вызываться периодически.

*   `UnsubscribeFromTimer(TimeSpan period, Action callback)`
    *   **Описание:** Отменяет регистрацию функции обратного вызова, зарегистрированной для периодических вызовов.
    *   **Параметры:**
        *   `period`:  Интервал времени типа `TimeSpan`, для которого была зарегистрирована функция обратного вызова.
        *   `callback`:  Функция обратного вызова типа `Action`, которую необходимо отменить.

*   `StopWithNotification(string message)`
    *   **Описание:** Останавливает стратегию и отправляет уведомление с заданным сообщением.
    *   **Параметры:**
        *   `message`:  Строковое сообщение типа `string`, которое будет отправлено в уведомлении об остановке стратегии.

*   `OpenOrder(Order order)`
    *   **Описание:** Открывает ордер для стратегии.
    *   **Параметры:**
        *   `order`:  Объект ордера типа `Order`, представляющий ордер, который необходимо открыть.

*   `ModifyOrder(Order order, Order newOrder)`
    *   **Описание:** Модифицирует существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`:  Объект ордера типа `Order`, представляющий существующий ордер, который необходимо модифицировать.
        *   `newOrder`:  Объект ордера типа `Order`, представляющий новые параметры ордера.

*   `CancelOrder(Order order)`
    *   **Описание:** Отменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`:  Объект ордера типа `Order`, представляющий ордер, который необходимо отменить.

*   `OpenOrderAsync(Order order)`
    *   **Описание:** Асинхронно открывает ордер для стратегии.
    *   **Параметры:**
        *   `order`:  Объект ордера типа `Order`, представляющий ордер, который необходимо открыть асинхронно.
    *   **Возвращает:**  `Task` - асинхронная операция.

*   `ModifyOrderAsync(Order order, Order newOrder)`
    *   **Описание:** Асинхронно модифицирует существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`:  Объект ордера типа `Order`, представляющий существующий ордер, который необходимо модифицировать асинхронно.
        *   `newOrder`:  Объект ордера типа `Order`, представляющий новые параметры ордера.
    *   **Возвращает:**  `Task` - асинхронная операция.

*   `CancelOrderAsync(Order order)`
    *   **Описание:** Асинхронно отменяет существующий ордер для стратегии.
    *   **Параметры:**
        *   `order`:  Объект ордера типа `Order`, представляющий ордер, который необходимо отменить асинхронно.
    *   **Возвращает:**  `Task` - асинхронная операция.

*   `StartAsync()`
    *   **Описание:** Запускает стратегию, позволяя ей выполнять свою торговую логику.
    *   **Возвращает:**  `Task` - асинхронная операция.

*   `StopAsync()`
    *   **Описание:** Останавливает стратегию, завершает ее выполнение и освобождает любые ресурсы.
    *   **Возвращает:**  `Task` - асинхронная операция.

#### Свойства

*   `ShortPeriod`
    *   **Тип:** `int`
    *   **Описание:**  Получает или устанавливает период для короткой скользящей средней.  Доступно для чтения и записи (`[get, set]`).

*   `LongPeriod`
    *   **Тип:** `int`
    *   **Описание:**  Получает или устанавливает период для длинной скользящей средней. Доступно для чтения и записи (`[get, set]`).

*   `Volume`
    *   **Тип:** `decimal`
    *   **Описание:**  Получает или устанавливает объем, используемый в стратегии. Доступно для чтения и записи (`[get, set]`).

*   `ClosePositionOnStopping`
    *   **Тип:** `bool`
    *   **Описание:**  Получает или устанавливает значение, указывающее, следует ли закрывать позицию при остановке стратегии. Доступно для чтения и записи (`[get, set]`).

### Защищенные члены класса

#### Методы

*   `OnCalculate(int bar, decimal value)`
    *   **Описание:** Основной метод расчета индикатора. Вызывается для каждого бара на истории, а затем на каждом тике.
    *   **Параметры:**
        *   `bar`:  Номер бара типа `int`.
        *   `value`:  Значение входных данных ряда типа `decimal`.

*   `OnStopping()`
    *   **Описание:** Метод, вызываемый при остановке стратегии.

### Наследованные члены

Класс `SmaChartStrategy` наследует члены от следующих классов:

*   `ATAS.Strategies.Chart.ChartStrategy`
*   `ATAS.Indicators.Indicator`
*   `ATAS.Indicators.ExtendedIndicator`
*   `ATAS.Indicators.BaseIndicator`
*   `ATAS.Indicators.ChartObject`
*   `ATAS.Indicators.Filters.TrackedPropertyBase`
*   `ATAS.Indicators.IMarketTimeProvider`
*   `ATAS.Strategies.Chart.IChartStrategy`
*   `ATAS.Strategies.IStrategy`
*   `ATAS.Indicators.INotifyPanelPropertyChanged`
*   `ATAS.Indicators.INotifyPropertyChanged`
*   `ATAS.ChartObject`
*   `ATAS.IDisposable`
*   `ATAS.Indicators.ICustomTypeDescriptor`
*   `ATAS.ILoggerSource`

Включая:

*   **Публичные члены:** Методы и свойства, унаследованные от базовых классов.
*   **Защищенные члены:** Методы и атрибуты, унаследованные от базовых классов.
*   **Статические защищенные члены:** Статические методы, унаследованные от `ATAS.Indicators.BaseIndicator`.
*   **Защищенные атрибуты:** Атрибуты, унаследованные от `ATAS.Indicators.BaseIndicator`.
*   **События:** События, унаследованные от различных базовых классов, включая `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Indicators.BaseIndicator`, `ATAS.Indicators.Filters.TrackedPropertyBase`, `ATAS.Indicators.INotifyPanelPropertyChanged`, `ATAS.Strategies.IStrategy`.

### Заключение

Класс `ATAS.Strategies.Chart.SmaChartStrategy` предоставляет основу для создания торговых стратегий на основе скользящих средних в ATAS. Он включает в себя свойства для настройки периодов SMA, методы для управления ордерами и жизненным циклом стратегии, а также основной метод `OnCalculate` для реализации логики расчета индикатора и торговых сигналов. Наследование от `ChartStrategy` и других базовых классов обеспечивает доступ к широкому спектру функциональности платформы ATAS.







```yaml
## Методичка для создания продвинутых стратегий на платформе ATAS

### Раздел 1: Описание класса ProtectionSettingsEditor

#### 1.1. Полное название класса:
`ATAS.Strategies.Editors.ProtectionSettingsEditor`

#### 1.2. Тип класса:
`Class Reference` (Ссылка на класс)

#### 1.3. Раздел функций класса:
`Public Member Functions` (Публичные функции-члены)

##### 1.3.1. Список публичных функций-членов:
- `ProtectionSettingsEditor ()`

### Раздел 2: Документация конструктора и деструктора

#### 2.1. Конструктор:
`ProtectionSettingsEditor()`

#### 2.2. Полное описание конструктора:
`ATAS.Strategies.Editors.ProtectionSettingsEditor.ProtectionSettingsEditor ( )`

### Раздел 3: Файлы, сгенерировавшие документацию класса

#### 3.1. Список файлов:
- `ProtectionSettingsEditor.xaml.cs`
```






### Методичка по интерфейсу `ATAS.Strategies.IStrategy` для разработки стратегий в ATAS

#### Обзор интерфейса `ATAS.Strategies.IStrategy`

Интерфейс `ATAS.Strategies.IStrategy` представляет собой базовый интерфейс для создания торговых стратегий в платформе ATAS. Он определяет основные члены, которыми должна обладать любая стратегия для интеграции в систему ATAS.

**Наследование:**

```
ATAS.Strategies.Strategy
    INotifyPropertyChanged
        ATAS.Strategies.IStrategy
            ATAS.Strategies.ATM.IATMStrategy
            ATAS.Strategies.Chart.IChartStrategy
```

*Аннотация: `ATAS.Strategies.IStrategy` является частью иерархии классов стратегий. Он наследуется от `INotifyPropertyChanged` и является базовым интерфейсом для `ATAS.Strategies.ATM.IATMStrategy` и `ATAS.Strategies.Chart.IChartStrategy`, что указывает на его фундаментальную роль в структуре стратегий ATAS.*

**Диаграмма взаимодействия:**

```
INotifyPropertyChanged
    ATAS.Strategies.IStrategy
```

*Аннотация: Диаграмма взаимодействия показывает, что `ATAS.Strategies.IStrategy` взаимодействует с `INotifyPropertyChanged`, что вероятно связано с механизмом уведомлений об изменениях свойств стратегии.*

#### Публичные члены-функции (Public Member Functions)

1.  **`Task StartAsync ()`**

    Запускает стратегию, позволяя ей начать выполнение своей торговой логики.

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Функция `StartAsync` инициирует процесс работы стратегии. Она должна содержать логику запуска всех необходимых компонентов стратегии для начала торговли.*

2.  **`Task StopAsync()`**

    Останавливает стратегию, завершая ее выполнение и освобождая любые ресурсы.

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Функция `StopAsync` предназначена для корректного завершения работы стратегии. Важно освободить все занятые ресурсы, чтобы избежать утечек памяти или других проблем после остановки стратегии.*

#### Свойства (Properties)

1.  **`string Name`** `[get, set]`

    Возвращает или устанавливает имя стратегии.

    *Реализован в:* `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `Name` позволяет задать и получить имя стратегии. Имя используется для идентификации стратегии в интерфейсе ATAS и в коде.*

2.  **`StrategyStates State`** `[get]`

    Возвращает текущее состояние стратегии.

    *Аннотация: Свойство `State` предоставляет информацию о текущем состоянии стратегии, например, запущена она, остановлена, или находится в процессе инициализации. Тип `StrategyStates` (не описан в документации, но предположительно enum или класс) определяет возможные состояния.*

3.  **`decimal CurrentPosition`** `[get]`

    Возвращает текущий объем позиции стратегии.

    *Аннотация: Свойство `CurrentPosition` показывает текущую позицию, открытую стратегией. Значение типа `decimal` позволяет представлять объемы позиций с высокой точностью, что важно для финансовых расчетов.*

4.  **`decimal AveragePrice`** `[get]`

    Возвращает среднюю цену сделок стратегии.

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `AveragePrice` вычисляет и возвращает среднюю цену всех сделок, совершенных стратегией. Это полезно для оценки эффективности торговли.*

5.  **`decimal OpenPnL`** `[get]`

    Возвращает текущую открытую прибыль и убыток стратегии (Open Profit and Loss).

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `OpenPnL` отображает нереализованную прибыль или убыток по открытым позициям стратегии, рассчитанную на основе текущих рыночных цен.*

6.  **`decimal ClosedPnL`** `[get]`

    Возвращает закрытую прибыль и убыток стратегии (Closed Profit and Loss).

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `ClosedPnL` аккумулирует реализованную прибыль и убыток от всех закрытых позиций стратегии за время ее работы.*

7.  **`Security Security`** `[get, set]`

    Возвращает или устанавливает инструмент (security), связанный со стратегией.

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `Security` позволяет связать стратегию с конкретным торговым инструментом (акцией, фьючерсом и т.д.). Это необходимо для того, чтобы стратегия могла торговать именно этим инструментом и получать данные по нему.*

8.  **`Portfolio Portfolio`** `[get, set]`

    Возвращает или устанавливает портфель, связанный со стратегией.

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `Portfolio` позволяет привязать стратегию к определенному портфелю. Портфель в ATAS, вероятно, используется для управления средствами и учета торговых результатов.*

9.  **`TPlusLimits? TPlusLimit`** `[get, set]`

    Возвращает или устанавливает T+ лимиты для стратегии.

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `TPlusLimit` связано с T+ лимитами, которые, вероятно, относятся к торговым ограничениям или рискам, связанным с временем исполнения сделок (T+). Тип `TPlusLimits?` указывает на то, что значение может быть nullable.*

10. **`IDataFeedConnector Connector`** `[get, set]`

    Возвращает или устанавливает коннектор данных (data feed connector) для стратегии.

    *Реализован в:* `ATAS.Strategies.Chart.ChartStrategy`, `ATAS.Strategies.Strategy`.

    *Аннотация: Свойство `Connector` позволяет задать источник данных для стратегии. `IDataFeedConnector` - это интерфейс для подключения к различным поставщикам рыночных данных.  Стратегия использует коннектор для получения котировок и другой необходимой информации.*

#### События (Events)

1.  **`EventHandler<StrategyStateChangedEventArgs> StateChanged`**

    Происходит, когда состояние стратегии изменяется.

    *Аннотация: Событие `StateChanged` возникает при любом изменении состояния стратегии (например, при запуске, остановке, ошибке и т.д.). Подписка на это событие позволяет отслеживать жизненный цикл стратегии.*

2.  **`EventHandler<StrategyNotificationEventArgs> ShowNotification`**

    Происходит, когда стратегии нужно показать уведомление или предупреждение.

    *Аннотация: Событие `ShowNotification` предназначено для отображения пользователю сообщений от стратегии, таких как уведомления о сделках, предупреждения о рисках или другие важные сообщения. `StrategyNotificationEventArgs`, вероятно, содержит информацию о типе и содержании уведомления.*

#### Детальное описание (Detailed Description)

`ATAS.Strategies.IStrategy` представляет торговую стратегию.

#### Документация создана из файла:

*   `IStrategy.cs`

*Аннотация: Интерфейс `ATAS.Strategies.IStrategy` определен в файле `IStrategy.cs`. Этот файл содержит исходный код интерфейса.*







## Методичка по классу `ATAS.Strategies.Strategy` для создания продвинутых стратегий в ATAS

### Класс `ATAS.Strategies.Strategy`

**Базовый класс для реализации торговых стратегий.**

**Диаграмма наследования:**

```
INotifyPropertyChanged
    |
    +-- BaseLoggerSource
        |
        +-- IStrategy
            |
            +-- ATAS.Strategies.Strategy
                |
                +-- ATAS.Strategies.ATM.ATMStrategy<TStrategy>
                    |
                    +-- ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>
```

**Диаграмма взаимодействия:**

```
INotifyPropertyChanged
    |
    +-- BaseLoggerSource
        |
        +-- IStrategy
            |
            +-- ATAS.Strategies.Strategy
```

### Публичные функции-члены (Public Member Functions)

*   `void Start()`
    *   Запускает стратегию.

*   `void Stop()`
    *   Останавливает стратегию.

*   `async Task StartAsync()`
    *   Асинхронно запускает стратегию, позволяя ей выполнять свою торговую логику.

*   `async Task WatchAsync()`

*   `async Task StartFromWatchAsync()`

*   `async Task StopAsync()`
    *   Останавливает стратегию, завершает ее выполнение и освобождает ресурсы.

*   `async void OpenOrder(Order order, bool isAutomated = true)`

*   `async Task OpenOrderAsync(Order order, bool isAutomated = true)`

*   `async void ModifyOrder(Order order, Order neworder, bool isAutomated = true)`

*   `async Task ModifyOrderAsync(Order order, Order neworder, bool isAutomated = true)`

*   `async void CancelOrder(Order order, bool isAutomated = true)`

*   `async Task CancelOrderAsync(Order order, bool isAutomated = true)`

*   `Task StartAsync()`
    *   Запускает стратегию, позволяя ей выполнять свою торговую логику.

*   `Task StopAsync()`
    *   Останавливает стратегию, завершает ее выполнение и освобождает ресурсы.

### Защищенные функции-члены (Protected Member Functions)

*   `Strategy()`

*   `void SetState(StrategyStates state)`
    *   Устанавливает состояние стратегии.

*   `void SetErrorState(StrategyErrorTypes type, string[] errorDescriptions)`
    *   Устанавливает состояние ошибки `StrategyStates.Error`.

*   `void ResetErrorState()`
    *   Сбрасывает состояние ошибки.

*   `void RaisePropertyChanged(string propertyName)`
    *   Вызывает событие `PropertyChanged` с указанным именем свойства.

*   `void RaiseShowNotification(string message, string title = null, bool isError = false)`
    *   Вызывает событие `ShowNotification` с указанным сообщением, заголовком и флагом ошибки.

*   `bool SetProperty<TValue>(ref TValue storage, TValue newValue, string propertyName, Action<TValue, TValue> onChanged = null)`
    *   Устанавливает свойство с указанным именем на новое значение и вызывает событие `PropertyChanged`, если значение изменилось.

*   `string GetOCOGroup()`
    *   Генерирует уникальный идентификатор группы OCO (One-Cancels-the-Other) на основе текущей временной метки.

*   `bool CanProcess(Order order)`
    *   Проверяет, может ли стратегия обрабатывать указанный ордер.

*   `ICollection<MyTrade> FilterMyTrades(IEnumerable<MyTrade> trades)`
    *   Фильтрует и возвращает коллекцию `MyTrade`, которые принадлежат текущему портфелю и инструменту и произошли после последнего времени сделки.

*   `void UpdateCurrentPosition()`
    *   Обновляет значения `CurrentPosition` и `AveragePrice`.

*   `virtual Task OnStarted()`
    *   Вызывается, когда стратегия запускается из состояния `StrategyStates.Stopped`.

*   `virtual Task OnStartedFromWatch()`
    *   Вызывается, когда стратегия запускается из состояния `StrategyStates.Watch`.

*   `virtual Task OnStopping()`
    *   Вызывается, когда стратегия останавливается.

*   `virtual Task OnStopped()`
    *   Вызывается, когда стратегия остановлена.

*   `virtual Task OnOpenOrder(Order order, bool isAutomated)`
    *   Вызывается, когда открывается новый ордер.

*   `virtual Task OnModifyOrder(Order order, Order newOrder, bool isAutomated)`
    *   Вызывается, когда существующий ордер модифицируется.

*   `virtual Task OnCancelOrder(Order order, bool isAutomated)`
    *   Вызывается, когда ордер отменяется.

*   `virtual void OnMarketDepth(IEnumerable<MarketDepth> depths)`
    *   Вызывается при получении данных о глубине рынка.

*   `virtual void OnBestBidAsk(MarketDepth depth)`
    *   Вызывается при получении данных о лучшей цене спроса/предложения в глубине рынка.

*   `virtual void OnNewTrade(Trade trade)`
    *   Вызывается, когда происходит новая сделка.

*   `virtual void OnNewPortfolio(Portfolio portfolio)`
    *   Вызывается, когда добавляется новый портфель.

*   `virtual void OnNewPosition(Position position)`
    *   Вызывается, когда добавляется новая позиция.

*   `virtual void OnPositionChanged(Position position)`
    *   Вызывается, когда существующая позиция изменяется.

*   `virtual void OnPnLChanged(int ticks)`
    *   Вызывается, когда изменяется прибыль и убыток (PnL).

*   `virtual void OnNewOrder(Order order)`
    *   Вызывается, когда добавляется новый ордер.

*   `virtual void OnOrderChanged(Order order)`
    *   Вызывается, когда существующий ордер изменяется.

*   `virtual void OnOrderRegisterFailed(Order order, string message)`
    *   Вызывается, когда регистрация ордера не удалась.

*   `virtual void OnOrderCancelFailed(Order order, string message)`
    *   Вызывается, когда отмена ордера не удалась.

*   `virtual void OnOrderModifyFailed(Order order, Order newOrder, string message)`
    *   Вызывается, когда модификация ордера не удалась.

*   `virtual void OnNewMyTrade(MyTrade myTrade)`
    *   Вызывается, когда новая сделка добавляется в коллекцию `MyTrade`.

*   `virtual void OnCurrentPositionChanged()`
    *   Вызывается, когда объем текущей позиции изменяется.

*   `virtual void OnUpdateStrategyState()`
    *   Вызывается, когда состояние стратегии необходимо обновить.

*   `virtual bool CanProcess()`
    *   Проверяет, может ли стратегия обрабатывать операции в текущем состоянии.

*   `virtual bool CanUpdateCurrentPosition(Position position)`
    *   Проверяет, можно ли обновить текущую позицию с указанной позицией.

*   `virtual void LogParameters()`
    *   Логирует текущие параметры.

### Свойства (Properties)

*   `Security Security { get; set; }`
    *   Возвращает или устанавливает инструмент, связанный со стратегией.

*   `Portfolio Portfolio { get; set; }`
    *   Возвращает или устанавливает портфель, связанный со стратегией.

*   `TPlusLimits? TPlusLimit { get; set; }`
    *   Возвращает или устанавливает T+ лимиты для стратегии.

*   `IDataFeedConnector Connector { get; set; }`
    *   Возвращает или устанавливает коннектор данных для стратегии.

*   `IEnumerable<MyTrade> MyTrades { get; }`

*   `IEnumerable<Order> Orders { get; }`

*   `Position Position { get; set; }`

*   `decimal CurrentPosition { get; }`
    *   Возвращает текущий объем позиции стратегии.

*   `decimal AveragePrice { get; }`
    *   Возвращает среднюю цену сделок стратегии.

*   `int OpenTicksPnL { get; }`

*   `decimal OpenPnL { get; }`
    *   Возвращает открытую прибыль и убыток стратегии.

*   `decimal ClosedPnL { get; }`
    *   Возвращает закрытую прибыль и убыток стратегии.

*   `MarketDepth BestBid { get; }`

*   `MarketDepth BestAsk { get; }`

*   `StrategyStates State { get; protected set; }`
    *   Возвращает текущее состояние стратегии.

*   `StrategyStateDescription StateDescription { get; }`

*   `string Name { get; set; }`
    *   Возвращает или устанавливает имя стратегии.

### События (Events)

*   `PropertyChangedEventHandler PropertyChanged`

*   `EventHandler<StrategyStateChangedEventArgs> StateChanged`

*   `EventHandler<StrategyNotificationEventArgs> ShowNotification`

### Подробное описание (Detailed Description)

Базовый класс для реализации торговых стратегий.

### Документация конструктора и деструктора (Constructor & Destructor Documentation)

*   `Strategy()`
    *   `ATAS.Strategies.Strategy.Strategy()`

### Документация функций-членов (Member Function Documentation)

*   `CancelOrder()`
    *   `async void ATAS.Strategies.Strategy.CancelOrder(Order order, bool isAutomated = true)`
        *   **Параметры:**
            *   `order`: Ордер для отмены.
            *   `isAutomated`: Флаг, указывающий, была ли отмена ордера автоматической.

*   `CancelOrderAsync()`
    *   `async Task ATAS.Strategies.Strategy.CancelOrderAsync(Order order, bool isAutomated = true)`
        *   **Параметры:**
            *   `order`: Ордер для отмены.
            *   `isAutomated`: Флаг, указывающий, была ли отмена ордера автоматической.

*   `CanProcess() [1/2]`
    *   `virtual bool ATAS.Strategies.Strategy.CanProcess()`
        *   Проверяет, может ли стратегия обрабатывать операции в текущем состоянии.
        *   **Возвращает:**
            *   `true`, если стратегия может обрабатывать; иначе, `false`.

*   `CanProcess() [2/2]`
    *   `bool ATAS.Strategies.Strategy.CanProcess(Order order)`
        *   Проверяет, может ли стратегия обрабатывать указанный ордер.
        *   **Параметры:**
            *   `order`: Ордер для обработки.
        *   **Возвращает:**
            *   `true`, если ордер может быть обработан; иначе, `false`.

*   `CanUpdateCurrentPosition()`
    *   `virtual bool ATAS.Strategies.Strategy.CanUpdateCurrentPosition(Position position)`
        *   Проверяет, можно ли обновить текущую позицию с указанной позицией.
        *   **Параметры:**
            *   `position`: Позиция для сравнения с текущей позицией.
        *   **Возвращает:**
            *   `true`, если текущая позиция может быть обновлена; иначе, `false`.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*   `FilterMyTrades()`
    *   `ICollection<MyTrade> ATAS.Strategies.Strategy.FilterMyTrades(IEnumerable<MyTrade> trades)`
        *   Фильтрует и возвращает коллекцию `MyTrade`, которые принадлежат текущему портфелю и инструменту и произошли после последнего времени сделки.
        *   **Параметры:**
            *   `trades`: Коллекция `MyTrade` для фильтрации.
        *   **Возвращает:**
            *   Отфильтрованная коллекция `MyTrade`.

*   `GetOCOGroup()`
    *   `string ATAS.Strategies.Strategy.GetOCOGroup()`
        *   Генерирует уникальный идентификатор группы OCO (One-Cancels-the-Other) на основе текущей временной метки.
        *   **Возвращает:**
            *   Уникальный идентификатор группы OCO.

*   `LogParameters()`
    *   `virtual void ATAS.Strategies.Strategy.LogParameters()`
        *   Логирует текущие параметры.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.ATMStrategy<TStrategy>`.

*   `ModifyOrder()`
    *   `async void ATAS.Strategies.Strategy.ModifyOrder(Order order, Order neworder, bool isAutomated = true)`
        *   **Параметры:**
            *   `order`: Ордер для модификации.
            *   `neworder`: Новый ордер с измененными параметрами.
            *   `isAutomated`: Флаг, указывающий, была ли модификация ордера автоматической.

*   `ModifyOrderAsync()`
    *   `async Task ATAS.Strategies.Strategy.ModifyOrderAsync(Order order, Order neworder, bool isAutomated = true)`
        *   **Параметры:**
            *   `order`: Ордер для модификации.
            *   `neworder`: Новый ордер с измененными параметрами.
            *   `isAutomated`: Флаг, указывающий, была ли модификация ордера автоматической.

*   `OnBestBidAsk()`
    *   `virtual void ATAS.Strategies.Strategy.OnBestBidAsk(MarketDepth depth)`
        *   Вызывается при получении данных о лучшей цене спроса/предложения в глубине рынка.
        *   **Параметры:**
            *   `depth`: Данные о лучшей цене спроса/предложения в глубине рынка.

*   `OnCancelOrder()`
    *   `virtual Task ATAS.Strategies.Strategy.OnCancelOrder(Order order, bool isAutomated)`
        *   Вызывается, когда ордер отменяется.
        *   **Параметры:**
            *   `order`: Ордер для отмены.
            *   `isAutomated`: Флаг, указывающий, была ли отмена ордера автоматической.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnCurrentPositionChanged()`
    *   `virtual void ATAS.Strategies.Strategy.OnCurrentPositionChanged()`
        *   Вызывается, когда объем текущей позиции изменяется.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnMarketDepth()`
    *   `virtual void ATAS.Strategies.Strategy.OnMarketDepth(IEnumerable<MarketDepth> depths)`
        *   Вызывается при получении данных о глубине рынка.
        *   **Параметры:**
            *   `depths`: Коллекция данных о глубине рынка.

*   `OnModifyOrder()`
    *   `virtual Task ATAS.Strategies.Strategy.OnModifyOrder(Order order, Order newOrder, bool isAutomated)`
        *   Вызывается, когда существующий ордер модифицируется.
        *   **Параметры:**
            *   `order`: Исходный ордер.
            *   `newOrder`: Модифицированный ордер с новыми параметрами.
            *   `isAutomated`: Флаг, указывающий, была ли модификация ордера автоматической.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnNewMyTrade()`
    *   `virtual void ATAS.Strategies.Strategy.OnNewMyTrade(MyTrade myTrade)`
        *   Вызывается, когда новая сделка добавляется в коллекцию `MyTrade`.
        *   **Параметры:**
            *   `myTrade`: Вновь добавленная `MyTrade`.

*   `OnNewOrder()`
    *   `virtual void ATAS.Strategies.Strategy.OnNewOrder(Order order)`
        *   Вызывается, когда добавляется новый ордер.
        *   **Параметры:**
            *   `order`: Вновь добавленный ордер.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnNewPortfolio()`
    *   `virtual void ATAS.Strategies.Strategy.OnNewPortfolio(Portfolio portfolio)`
        *   Вызывается, когда добавляется новый портфель.
        *   **Параметры:**
            *   `portfolio`: Вновь добавленный портфель.

*   `OnNewPosition()`
    *   `virtual void ATAS.Strategies.Strategy.OnNewPosition(Position position)`
        *   Вызывается, когда добавляется новая позиция.
        *   **Параметры:**
            *   `position`: Вновь добавленная позиция.

*   `OnNewTrade()`
    *   `virtual void ATAS.Strategies.Strategy.OnNewTrade(Trade trade)`
        *   Вызывается, когда происходит новая сделка.
        *   **Параметры:**
            *   `trade`: Вновь произошедшая сделка.

*   `OnOpenOrder()`
    *   `virtual Task ATAS.Strategies.Strategy.OnOpenOrder(Order order, bool isAutomated)`
        *   Вызывается, когда открывается новый ордер.
        *   **Параметры:**
            *   `order`: Вновь открытый ордер.
            *   `isAutomated`: Флаг, указывающий, был ли ордер открыт автоматически.

*   `OnOrderCancelFailed()`
    *   `virtual void ATAS.Strategies.Strategy.OnOrderCancelFailed(Order order, string message)`
        *   Вызывается, когда отмена ордера не удалась.
        *   **Параметры:**
            *   `order`: Ордер, который не удалось отменить.
            *   `message`: Сообщение об ошибке.

*   `OnOrderChanged()`
    *   `virtual void ATAS.Strategies.Strategy.OnOrderChanged(Order order)`
        *   Вызывается, когда существующий ордер изменяется.
        *   **Параметры:**
            *   `order`: Измененный ордер.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnOrderModifyFailed()`
    *   `virtual void ATAS.Strategies.Strategy.OnOrderModifyFailed(Order order, Order neworder, string message)`
        *   Вызывается, когда модификация ордера не удалась.
        *   **Параметры:**
            *   `order`: Ордер, который не удалось модифицировать.
            *   `newOrder`: Модифицированный ордер с новыми параметрами.
            *   `message`: Сообщение об ошибке.

*   `OnOrderRegisterFailed()`
    *   `virtual void ATAS.Strategies.Strategy.OnOrderRegisterFailed(Order order, string message)`
        *   Вызывается, когда регистрация ордера не удалась.
        *   **Параметры:**
            *   `order`: Ордер, который не удалось зарегистрировать.
            *   `message`: Сообщение об ошибке.

*   `OnPnLChanged()`
    *   `virtual void ATAS.Strategies.Strategy.OnPnLChanged(int ticks)`
        *   Вызывается, когда изменяется прибыль и убыток (PnL).
        *   **Параметры:**
            *   `ticks`: Количество тиков, на которое изменился PnL.

*   `OnPositionChanged()`
    *   `virtual void ATAS.Strategies.Strategy.OnPositionChanged(Position position)`
        *   Вызывается, когда существующая позиция изменяется.
        *   **Параметры:**
            *   `position`: Измененная позиция.

*   `OnStarted()`
    *   `virtual Task ATAS.Strategies.Strategy.OnStarted()`
        *   Вызывается, когда стратегия запускается из состояния `StrategyStates.Stopped`.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnStartedFromWatch()`
    *   `virtual Task ATAS.Strategies.Strategy.OnStartedFromWatch()`
        *   Вызывается, когда стратегия запускается из состояния `StrategyStates.Watch`.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnStopped()`
    *   `virtual Task ATAS.Strategies.Strategy.OnStopped()`
        *   Вызывается, когда стратегия остановлена.

*   `OnStopping()`
    *   `virtual Task ATAS.Strategies.Strategy.OnStopping()`
        *   Вызывается, когда стратегия останавливается.
        *   **Реализовано повторно в:** `ATAS.Strategies.ATM.BaseStopProfitStrategy<TStrategy, TSettings>`.

*   `OnUpdateStrategyState()`
    *   `virtual void ATAS.Strategies.Strategy.OnUpdateStrategyState()`
        *   Вызывается, когда состояние стратегии необходимо обновить.

*   `OpenOrder()`
    *   `async void ATAS.Strategies.Strategy.OpenOrder(Order order, bool isAutomated = true)`
        *   **Параметры:**
            *   `order`: Ордер для открытия.
            *   `isAutomated`: Флаг, указывающий, был ли ордер открыт автоматически.

*   `OpenOrderAsync()`
    *   `async Task ATAS.Strategies.Strategy.OpenOrderAsync(Order order, bool isAutomated = true)`
        *   **Параметры:**
            *   `order`: Ордер для открытия.
            *   `isAutomated`: Флаг, указывающий, был ли ордер открыт автоматически.

*   `RaisePropertyChanged()`
    *   `void ATAS.Strategies.Strategy.RaisePropertyChanged(string propertyName)`
        *   Вызывает событие `PropertyChanged` с указанным именем свойства.
        *   **Параметры:**
            *   `propertyName`: Имя измененного свойства.

*   `RaiseShowNotification()`
    *   `void ATAS.Strategies.Strategy.RaiseShowNotification(string message, string title = null, bool isError = false)`
        *   Вызывает событие `ShowNotification` с указанным сообщением, заголовком и флагом ошибки.
        *   **Параметры:**
            *   `message`: Текст уведомления.
            *   `title`: Заголовок уведомления (необязательно).
            *   `isError`: Флаг, указывающий, является ли уведомление ошибкой.

*   `ResetErrorState()`
    *   `void ATAS.Strategies.Strategy.ResetErrorState()`
        *   Сбрасывает состояние ошибки.

*   `SetErrorState()`
    *   `void ATAS.Strategies.Strategy.SetErrorState(StrategyErrorTypes type, string[] errorDescriptions)`
        *   Устанавливает состояние ошибки `StrategyStates.Error`.
        *   **Параметры:**
            *   `type`: Тип ошибки.
            *   `errorDescriptions`: Описание ошибки.

*   `SetProperty<TValue>()`
    *   `bool ATAS.Strategies.Strategy.SetProperty<TValue>(ref TValue storage, TValue newValue, string propertyName, Action<TValue, TValue> onChanged = null)`
        *   Устанавливает свойство с указанным именем на новое значение и вызывает событие `PropertyChanged`, если значение изменилось.
        *   **Параметры шаблона:**
            *   `TValue`: Тип значения свойства.
        *   **Параметры:**
            *   `storage`: Ссылка на хранилище для значения свойства.
            *   `newValue`: Новое значение свойства.
            *   `propertyName`: Имя свойства.
            *   `onChanged`: Необязательное действие для выполнения при изменении значения свойства.
        *   **Возвращает:**
            *   `true`, если значение свойства изменилось; иначе, `false`.

*   `SetState()`
    *   `void ATAS.Strategies.Strategy.SetState(StrategyStates state)`
        *   Устанавливает состояние стратегии.
        *   **Параметры:**
            *   `state`: Новое состояние.

*   `Start()`
    *   `void ATAS.Strategies.Strategy.Start()`

*   `StartAsync()`
    *   `async Task ATAS.Strategies.Strategy.StartAsync()`
        *   Запускает стратегию, позволяя ей выполнять свою торговую логику.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `StartFromWatchAsync()`
    *   `async Task ATAS.Strategies.Strategy.StartFromWatchAsync()`

*   `Stop()`
    *   `void ATAS.Strategies.Strategy.Stop()`

*   `StopAsync()`
    *   `async Task ATAS.Strategies.Strategy.StopAsync()`
        *   Останавливает стратегию, завершает ее выполнение и освобождает любые ресурсы.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `UpdateCurrentPosition()`
    *   `void ATAS.Strategies.Strategy.UpdateCurrentPosition()`
        *   Обновляет значения `CurrentPosition` и `AveragePrice`.

*   `WatchAsync()`
    *   `async Task ATAS.Strategies.Strategy.WatchAsync()`

### Документация свойств (Property Documentation)

*   `AveragePrice`
    *   `decimal ATAS.Strategies.Strategy.AveragePrice { get; }`
        *   Возвращает среднюю цену сделок стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `BestAsk`
    *   `MarketDepth ATAS.Strategies.Strategy.BestAsk { get; }`

*   `BestBid`
    *   `MarketDepth ATAS.Strategies.Strategy.BestBid { get; }`

*   `ClosedPnL`
    *   `decimal ATAS.Strategies.Strategy.ClosedPnL { get; }`
        *   Возвращает закрытую прибыль и убыток стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `Connector`
    *   `IDataFeedConnector ATAS.Strategies.Strategy.Connector { get; set; }`
        *   Возвращает или устанавливает коннектор данных для стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `CurrentPosition`
    *   `decimal ATAS.Strategies.Strategy.CurrentPosition { get; }`
        *   Возвращает текущий объем позиции стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `MyTrades`
    *   `IEnumerable<MyTrade> ATAS.Strategies.Strategy.MyTrades { get; }`

*   `Name`
    *   `string ATAS.Strategies.Strategy.Name { get; set; }`
        *   Возвращает или устанавливает имя стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `OpenPnL`
    *   `decimal ATAS.Strategies.Strategy.OpenPnL { get; }`
        *   Возвращает открытую прибыль и убыток стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `OpenTicksPnL`
    *   `int ATAS.Strategies.Strategy.OpenTicksPnL { get; }`

*   `Orders`
    *   `IEnumerable<Order> ATAS.Strategies.Strategy.Orders { get; }`

*   `Portfolio`
    *   `Portfolio ATAS.Strategies.Strategy.Portfolio { get; set; }`
        *   Возвращает или устанавливает портфель, связанный со стратегией.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `Position`
    *   `Position ATAS.Strategies.Strategy.Position { get; set; }`

*   `Security`
    *   `Security ATAS.Strategies.Strategy.Security { get; set; }`
        *   Возвращает или устанавливает инструмент, связанный со стратегией.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `State`
    *   `StrategyStates ATAS.Strategies.Strategy.State { get; protected set; }`
        *   Возвращает текущее состояние стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

*   `StateDescription`
    *   `StrategyStateDescription ATAS.Strategies.Strategy.StateDescription { get; }`

*   `TPlusLimit`
    *   `TPlusLimits? ATAS.Strategies.Strategy.TPlusLimit { get; set; }`
        *   Возвращает или устанавливает T+ лимиты для стратегии.
        *   **Реализует:** `ATAS.Strategies.IStrategy`.

### Документация событий (Event Documentation)

*   `PropertyChanged`
    *   `PropertyChangedEventHandler ATAS.Strategies.Strategy.PropertyChanged`

*   `ShowNotification`
    *   `EventHandler<StrategyNotificationEventArgs> ATAS.Strategies.Strategy.ShowNotification`

*   `StateChanged`
    *   `EventHandler<StrategyStateChangedEventArgs> ATAS.Strategies.Strategy.StateChanged`

### Файл, в котором сгенерирована документация для этого класса:

*   `Strategy.cs`





## Методичка по классу `ATAS.Strategies.StrategyNotificationEventArgs`

### Описание класса

Класс `ATAS.Strategies.StrategyNotificationEventArgs` предоставляет данные для события `StrategyNotification`.

**Диаграмма наследования:**

```
EventArgs
    ^
    |
ATAS.Strategies.StrategyNotificationEventArgs
```

**Диаграмма взаимодействия:**

```
EventArgs
    ^
    |
ATAS.Strategies.StrategyNotificationEventArgs
```

### Открытые члены класса

#### Открытые функции-члены

*   `StrategyNotificationEventArgs (IStrategy strategy, string message, string title, bool isError)`

    > Инициализирует новый экземпляр класса `StrategyNotificationEventArgs` с указанной стратегией, сообщением, заголовком и статусом ошибки.

#### Свойства

*   `IStrategy Strategy`  \[get]

    > Возвращает стратегию, связанную с уведомлением.

*   `string Message` \[get]

    > Возвращает сообщение уведомления.

*   `string Title` \[get]

    > Возвращает заголовок уведомления.

*   `bool IsError` \[get]

    > Возвращает значение, указывающее, является ли уведомление ошибкой.

### Подробное описание

Предоставляет данные для события `StrategyNotification`.

### Документация конструктора и деструктора

#### `StrategyNotificationEventArgs()`

```csharp
ATAS.Strategies.StrategyNotificationEventArgs.StrategyNotificationEventArgs (
    IStrategy strategy,
    string message,
    string title,
    bool isError
)
```

> Инициализирует новый экземпляр класса `StrategyNotificationEventArgs` с указанной стратегией, сообщением, заголовком и статусом ошибки.

**Параметры:**

*   `strategy`  `IStrategy` - Стратегия, связанная с уведомлением.
*   `message` `string` - Сообщение уведомления.
*   `title`   `string` - Заголовок уведомления.
*   `isError` `bool`   - Значение, указывающее, является ли уведомление ошибкой.

### Документация свойств

#### `IsError`

```csharp
bool ATAS.Strategies.StrategyNotificationEventArgs.IsError
```
\[get]

> Возвращает значение, указывающее, является ли уведомление ошибкой.

#### `Message`

```csharp
string ATAS.Strategies.StrategyNotificationEventArgs.Message
```
\[get]

> Возвращает сообщение уведомления.

#### `Strategy`

```csharp
IStrategy ATAS.Strategies.StrategyNotificationEventArgs.Strategy
```
\[get]

> Возвращает стратегию, связанную с уведомлением.

#### `Title`

```csharp
string ATAS.Strategies.StrategyNotificationEventArgs.Title
```
\[get]

> Возвращает заголовок уведомления.

Документация для этого класса была сгенерирована из файла:

*   `StrategyNotificationEventArgs.cs`







## Методичка по классу `ATAS.Strategies.StrategyStateChangedEventArgs`

**1. Название класса:** `ATAS.Strategies.StrategyStateChangedEventArgs`
// Название класса, с которым мы работаем

**2. Описание класса:** Предоставляет данные для события `StrategyStateChanged`.
// Описание назначения класса

**3. Иерархия наследования:**
   `EventArgs` -> `ATAS.Strategies.StrategyStateChangedEventArgs`
// Иерархия наследования показывает, от какого базового класса происходит данный класс

**4. Конструктор:**
   `StrategyStateChangedEventArgs(IStrategy strategy, StrategyStateDescription state)`
// Конструктор класса - метод для создания новых объектов этого класса

   * **Описание конструктора:** Инициализирует новый экземпляр класса `StrategyStateChangedEventArgs` с указанной стратегией, старым состоянием и новым состоянием.
   // Описание того, что делает конструктор при создании объекта

   * **Параметры конструктора:**
      * `strategy`:  Стратегия, связанная с изменением состояния. Тип параметра: `IStrategy`.
      // Параметр 'strategy' представляет стратегию, которая вызвала изменение состояния. Тип 'IStrategy' указывает на интерфейс стратегии.
      * `state`: Состояние стратегии. Тип параметра: `StrategyStateDescription`.
      // Параметр 'state' описывает состояние стратегии. Тип 'StrategyStateDescription' представляет собой описание состояния стратегии.

**5. Свойства класса (Properties):**

   * **Свойство `Strategy`:**
      * Тип свойства: `IStrategy`
      * Описание: Возвращает стратегию, связанную с изменением состояния.
      // Свойство 'Strategy' позволяет получить доступ к объекту стратегии, связанному с событием изменения состояния.

   * **Свойство `State`:**
      * Тип свойства: `StrategyStateDescription`
      * Описание: Возвращает состояние стратегии.
      // Свойство 'State' позволяет получить доступ к описанию текущего состояния стратегии.

**6. Файл, в котором определен класс:**
   `StrategyStateChangedEventArgs.cs`
// Файл, в котором находится код класса






## Методичка для создания АТРИБУТОВ в платформе ATAS на основе примера Sample SMA strategy

**Пример стратегии Sample SMA strategy**

**Источники из этого примера:**

```csharp
public class SmaChartStrategy : ATAS.Strategies.Chart.ChartStrategy
{
    #region Private fields
    private readonly SMA _shortSma = new SMA();
    private readonly SMA _longSma = new SMA();
    private int _lastBar;
    #endregion
```

**Аннотация:**

* `public class SmaChartStrategy : ATAS.Strategies.Chart.ChartStrategy`: Объявление публичного класса `SmaChartStrategy`, который наследуется от класса `ChartStrategy` из пространства имен `ATAS.Strategies.Chart`. Это означает, что `SmaChartStrategy` является стратегией для работы с графиками в ATAS и будет использовать функциональность, предоставляемую `ChartStrategy`.
* `{`: Открытие блока кода класса `SmaChartStrategy`.
* `#region Private fields`:  Начало области (региона) кода под названием "Private fields". Регионы используются для организации кода и могут быть свернуты в редакторе для удобства навигации. В данном регионе будут объявлены приватные поля класса.
* `private readonly SMA _shortSma = new SMA();`: Объявление приватного поля `_shortSma`, которое является экземпляром класса `SMA` (скользящая средняя). `readonly` означает, что значение этого поля может быть установлено только в конструкторе класса или при объявлении. `new SMA()` создает новый объект скользящей средней. Это поле будет использоваться для расчета краткосрочной скользящей средней.
* `private readonly SMA _longSma = new SMA();`: Объявление приватного поля `_longSma`, аналогичного `_shortSma`, также типа `SMA` и `readonly`.  Предназначено для расчета долгосрочной скользящей средней.
* `private int _lastBar;`: Объявление приватного поля `_lastBar` типа `int`.  Вероятно, будет использоваться для хранения индекса последнего обработанного бара.
* `#endregion`: Конец области "Private fields".

```csharp
    #region Public properties
    [Display(
        Name = "Short period",
        Order = 10)]
    [Parameter]
    public int ShortPeriod
    {
        get => _shortSma.Period;
        set
        {
            _shortSma.Period = Math.Max(1, value);
            RecalculateValues();
        }
    }
```

**Аннотация:**

* `#region Public properties`: Начало области "Public properties", где будут объявлены публичные свойства класса. Публичные свойства предоставляют контролируемый доступ к данным класса извне.
* `[Display(`: Атрибут `Display` используется для настройки отображения свойства в интерфейсе ATAS.
    * `Name = "Short period",`: Задает имя свойства, которое будет отображаться пользователю как "Short period".
    * `Order = 10)]`: Задает порядок отображения свойства в настройках индикатора. Свойства с меньшим значением `Order` отображаются выше.
* `[Parameter]`: Атрибут `Parameter` указывает, что это свойство является параметром стратегии, который пользователь может настраивать в ATAS.
* `public int ShortPeriod`: Объявление публичного свойства `ShortPeriod` типа `int`. Это свойство будет представлять период для краткосрочной скользящей средней.
* `{`: Открытие блока кода для свойства `ShortPeriod`.
* `get => _shortSma.Period;`:  Реализация аксессора `get` (получения значения).  Использует лямбда-выражение `=>` для краткой записи. Возвращает значение свойства `Period` объекта `_shortSma` (то есть, текущий период краткосрочной SMA).
* `set`:  Реализация аксессора `set` (установки значения). Выполняется, когда пользователь изменяет значение свойства `ShortPeriod`.
* `{`: Открытие блока кода для аксессора `set`.
    * `_shortSma.Period = Math.Max(1, value);`: Устанавливает новое значение периода для `_shortSma`. `Math.Max(1, value)` гарантирует, что период не будет меньше 1, даже если пользователь попытается установить отрицательное или нулевое значение. `value` - это входное значение, которое пользователь пытается установить для свойства `ShortPeriod`.
    * `RecalculateValues();`: Вызов метода `RecalculateValues()`. Этот метод, вероятно, является методом базового класса `ChartStrategy` и предназначен для пересчета значений индикатора при изменении параметров.
* `}`: Закрытие блока кода аксессора `set`.
* `}`: Закрытие блока кода свойства `ShortPeriod`.

```csharp
    [Display(
        Name = "Long period",
        Order = 20)]
    [Parameter]
    public int LongPeriod
    {
        get => _longSma.Period;
        set
        {
            _longSma.Period = Math.Max(1, value);
            RecalculateValues();
        }
    }
```

**Аннотация:**

* Этот блок кода аналогичен свойству `ShortPeriod`, но предназначен для настройки периода долгосрочной скользящей средней (`_longSma`).
* `[Display(Name = "Long period", Order = 20)]`: Атрибут `Display` задает имя "Long period" и порядок отображения 20 для свойства долгосрочного периода.
* `public int LongPeriod`: Объявление публичного свойства `LongPeriod` типа `int` для долгосрочного периода SMA.
* Аксессоры `get` и `set` работают аналогично `ShortPeriod`, но применяются к `_longSma`.

```csharp
    [Display(
        Name = "Volume",
        Order = 30)]
    [Parameter]
    public decimal Volume { get; set; }
```

**Аннотация:**

* `[Display(Name = "Volume", Order = 30)]`: Атрибут `Display` задает имя "Volume" и порядок отображения 30 для свойства "Volume".
* `[Parameter]`: Атрибут `Parameter` делает свойство настраиваемым пользователем.
* `public decimal Volume { get; set; }`: Объявление публичного свойства `Volume` типа `decimal`.  `decimal` используется для финансовых расчетов с высокой точностью. `{ get; set; }`  автоматически реализует аксессоры `get` и `set` без дополнительной логики. Это свойство, вероятно, будет использоваться для задания объема позиции в торговой стратегии.

```csharp
    [Display(ResourceType = typeof(Resources),
        Name = "ClosePositionOnStopping",
        Order = 40)]
    [Parameter]
    public bool ClosePositionOnStopping { get; set; }
    #endregion
```

**Аннотация:**

* `[Display(ResourceType = typeof(Resources), Name = "ClosePositionOnStopping", Order = 40)]`: Атрибут `Display` с дополнительным параметром `ResourceType = typeof(Resources)`. Это указывает, что имя свойства "ClosePositionOnStopping" может быть взято из файла ресурсов `Resources` для локализации (например, для отображения на разных языках). Порядок отображения 40.
* `[Parameter]`: Атрибут `Parameter` делает свойство настраиваемым.
* `public bool ClosePositionOnStopping { get; set; }`: Объявление публичного свойства `ClosePositionOnStopping` типа `bool` (логическое значение - true или false). `{ get; set; }` автоматически реализует аксессоры. Это свойство, вероятно, будет использоваться для управления закрытием позиции при остановке стратегии.
* `#endregion`: Конец области "Public properties".

```csharp
    #region ctor
    public SmaChartStrategy()
    {
        var firstSeries = (ValueDataSeries)DataSeries[0];
        firstSeries.Name = "Short";
        firstSeries.Color = Colors.Red;
        firstSeries.VisualType = VisualMode.Line;

        DataSeries.Add(new ValueDataSeries("Long")
        {
            VisualType = VisualMode.Line,
            Color = Colors.Green,
        });

        ShortPeriod = 21;
        LongPeriod = 75;
        Volume = 1;
        ClosePositionOnStopping = true;
    }
    #endregion
```

**Аннотация:**

* `#region ctor`: Начало области "ctor" (сокращение от "constructor"), где будет определен конструктор класса. Конструктор - это специальный метод, который вызывается при создании нового объекта класса.
* `public SmaChartStrategy()`: Объявление публичного конструктора для класса `SmaChartStrategy`. Конструктор не имеет типа возвращаемого значения и имеет имя, совпадающее с именем класса.
* `{`: Открытие блока кода конструктора.
    * `var firstSeries = (ValueDataSeries)DataSeries[0];`: Объявление локальной переменной `firstSeries` типа `var` (тип определяется компилятором автоматически).  `DataSeries[0]` вероятно, обращается к первой серии данных индикатора. `(ValueDataSeries)` - это приведение типа, указывающее, что мы ожидаем, что `DataSeries[0]` будет типом `ValueDataSeries`. `ValueDataSeries` - это класс в ATAS для отображения числовых данных на графике.
    * `firstSeries.Name = "Short";`: Установка свойства `Name` для `firstSeries` в значение "Short". Это имя будет отображаться в легенде графика.
    * `firstSeries.Color = Colors.Red;`: Установка свойства `Color` для `firstSeries` в значение `Colors.Red`. Это задает красный цвет для отображения первой серии на графике. `Colors.Red` - это статическое свойство, предоставляющее предопределенный красный цвет.
    * `firstSeries.VisualType = VisualMode.Line;`: Установка свойства `VisualType` для `firstSeries` в значение `VisualMode.Line`. Это указывает, что серия должна отображаться как линия на графике. `VisualMode.Line` - это перечисление, определяющее различные типы визуализации данных.
    * `DataSeries.Add(new ValueDataSeries("Long")`: Вызов метода `Add` у коллекции `DataSeries`.  `DataSeries`, вероятно, является свойством базового класса `ChartStrategy`, которое содержит коллекции серий данных для отображения. `new ValueDataSeries("Long")` создает новый объект `ValueDataSeries` с именем "Long".
    * `{`: Открытие блока инициализации объекта `ValueDataSeries`, созданного выше.
        * `VisualType = VisualMode.Line,`: Установка свойства `VisualType` для новой серии в `VisualMode.Line` (линия).
        * `Color = Colors.Green,`: Установка свойства `Color` для новой серии в `Colors.Green` (зеленый цвет).
    * `});`: Закрытие блока инициализации и вызова метода `DataSeries.Add()`.  Добавляет вторую серию данных с именем "Long", зеленого цвета и типа "линия" к `DataSeries`.
    * `ShortPeriod = 21;`: Установка начального значения свойства `ShortPeriod` в 21.
    * `LongPeriod = 75;`: Установка начального значения свойства `LongPeriod` в 75.
    * `Volume = 1;`: Установка начального значения свойства `Volume` в 1.
    * `ClosePositionOnStopping = true;`: Установка начального значения свойства `ClosePositionOnStopping` в `true`.
* `}`: Закрытие блока кода конструктора.
* `#endregion`: Конец области "ctor".

```csharp
    #region Overrides of BaseIndicator
    protected override void OnCalculate(int bar, decimal value)
    {
        var shortSma = _shortSma.Calculate(bar, value);
        var longSma = _longSma.Calculate(bar, value);

        DataSeries[0][bar] = shortSma;
        DataSeries[1][bar] = longSma;

        var prevBar = _lastBar;
        _lastBar = bar;

        if (!CanProcess(bar) || prevBar == bar)
            return;

        if (_shortSma[prevBar - 1] < _longSma[prevBar - 1] && _shortSma[prevBar] >= _longSma[prevBar] )
        {
            //cross up
            OpenPosition(OrderDirections.Buy);
        }
```

**Аннотация:**

* `#region Overrides of BaseIndicator`: Начало области "Overrides of BaseIndicator". В этом регионе будут переопределены методы базового класса `ChartStrategy` или `BaseIndicator`. Переопределение методов позволяет изменить или дополнить поведение, унаследованное от базового класса.
* `protected override void OnCalculate(int bar, decimal value)`: Объявление защищенного переопределенного метода `OnCalculate`. `protected` означает, что метод доступен внутри класса и в производных классах. `override` указывает, что метод переопределяет метод с таким же именем из базового класса. `void` означает, что метод не возвращает значения. `OnCalculate` - это метод, который, вероятно, вызывается ATAS на каждом новом баре для расчета значений индикатора.
    * `int bar`: Параметр `bar` типа `int`, вероятно, представляет индекс текущего бара.
    * `decimal value`: Параметр `value` типа `decimal`, вероятно, представляет значение цены для текущего бара (например, цена закрытия).
* `{`: Открытие блока кода метода `OnCalculate`.
    * `var shortSma = _shortSma.Calculate(bar, value);`: Объявление локальной переменной `shortSma` и присвоение ей результата вызова метода `Calculate(bar, value)` у объекта `_shortSma` (краткосрочная SMA). Метод `Calculate`, вероятно, рассчитывает значение скользящей средней для заданного бара и значения цены.
    * `var longSma = _longSma.Calculate(bar, value);`: Аналогично, объявление локальной переменной `longSma` и расчет значения долгосрочной SMA.
    * `DataSeries[0][bar] = shortSma;`: Присвоение значения `shortSma` элементу `bar` в первой серии данных (`DataSeries[0]`). Это записывает рассчитанное значение краткосрочной SMA для текущего бара, чтобы оно отобразилось на графике.
    * `DataSeries[1][bar] = longSma;`: Аналогично, запись значения `longSma` для текущего бара во вторую серию данных (`DataSeries[1]`).
    * `var prevBar = _lastBar;`: Объявление локальной переменной `prevBar` и присвоение ей текущего значения `_lastBar`. Сохранение значения предыдущего бара.
    * `_lastBar = bar;`: Обновление значения `_lastBar` текущим индексом бара `bar`.
    * `if (!CanProcess(bar) || prevBar == bar)`: Условный оператор `if`. Проверяет два условия:
        * `!CanProcess(bar)`: Отрицание результата вызова метода `CanProcess(bar)`. `CanProcess`, вероятно, метод, который проверяет, может ли индикатор быть рассчитан для текущего бара (например, достаточно ли данных). Если `CanProcess(bar)` возвращает `false`, то `!CanProcess(bar)` будет `true`.
        * `prevBar == bar`: Сравнение `prevBar` и `bar`. Если они равны, это означает, что текущий бар совпадает с предыдущим обработанным баром, что может указывать на повторный вызов для одного и того же бара.
        * `||`: Оператор "ИЛИ". Если хотя бы одно из условий истинно, то условие `if` выполняется.
    * `return;`: Если условие `if` истинно, выполняется оператор `return`, который завершает выполнение метода `OnCalculate` и возвращает управление вызывающему коду, без дальнейшего расчета. Это предотвращает расчеты на барах, которые не могут быть обработаны или если бар не изменился.
    * `if (_shortSma[prevBar - 1] < _longSma[prevBar - 1] && _shortSma[prevBar] >= _longSma[prevBar] )`: Второй условный оператор `if`. Проверяет условия для открытия позиции на покупку (пересечение краткосрочной SMA снизу вверх через долгосрочную SMA).
        * `_shortSma[prevBar - 1] < _longSma[prevBar - 1]`: Проверяет, было ли значение краткосрочной SMA на предыдущем баре (`prevBar - 1`) меньше значения долгосрочной SMA на предыдущем баре.
        * `_shortSma[prevBar] >= _longSma[prevBar]`: Проверяет, стало ли значение краткосрочной SMA на текущем баре (`prevBar`) больше или равно значению долгосрочной SMA на текущем баре.
        * `&&`: Оператор "И". Оба условия должны быть истинными для того, чтобы общее условие `if` было истинным.
    * `{`: Открытие блока кода для второго `if` (если условие пересечения выполнено).
        * `//cross up`: Комментарий, указывающий, что это условие для "пересечения вверх" (краткосрочная SMA пересекает долгосрочную снизу вверх).
        * `OpenPosition(OrderDirections.Buy);`: Вызов метода `OpenPosition` с аргументом `OrderDirections.Buy`. `OpenPosition`, вероятно, метод для открытия торговой позиции. `OrderDirections.Buy` - это перечисление, указывающее направление ордера на покупку.
    * `}`: Закрытие блока кода второго `if`.

```csharp
        if (_shortSma[prevBar - 1] > _longSma[prevBar - 1] && _shortSma[prevBar] <= _longSma[prevBar] )
        {
            //cross down
            OpenPosition(OrderDirections.Sell);
        }
    }
```

**Аннотация:**

* `if (_shortSma[prevBar - 1] > _longSma[prevBar - 1] && _shortSma[prevBar] <= _longSma[prevBar] )`: Третий условный оператор `if`. Проверяет условия для открытия позиции на продажу (пересечение краткосрочной SMA сверху вниз через долгосрочную SMA).
    * `_shortSma[prevBar - 1] > _longSma[prevBar - 1]`: Проверяет, было ли значение краткосрочной SMA на предыдущем баре больше значения долгосрочной SMA на предыдущем баре.
    * `_shortSma[prevBar] <= _longSma[prevBar]`: Проверяет, стало ли значение краткосрочной SMA на текущем баре меньше или равно значению долгосрочной SMA на текущем баре.
    * `&&`: Оператор "И". Оба условия должны быть истинными.
    * `{`: Открытие блока кода для третьего `if`.
        * `//cross down`: Комментарий, указывающий, что это условие для "пересечения вниз" (краткосрочная SMA пересекает долгосрочную сверху вниз).
        * `OpenPosition(OrderDirections.Sell);`: Вызов метода `OpenPosition` с аргументом `OrderDirections.Sell`. `OrderDirections.Sell` - это перечисление, указывающее направление ордера на продажу.
    * `}`: Закрытие блока кода третьего `if`.
* `}`: Закрытие блока кода метода `OnCalculate`.

```csharp
    protected override void OnStopping()
    {
        if (CurrentPosition != 0 && ClosePositionOnStopping)
        {
            RaiseShowNotification($"Closing current position {CurrentPosition} on stopping.", level: NotificationLevel.Alert);
            CloseCurrentPosition();
        }
        base.OnStopping();
    }
    #endregion
```

**Аннотация:**

* `protected override void OnStopping()`: Объявление защищенного переопределенного метода `OnStopping`. Этот метод, вероятно, вызывается ATAS при остановке стратегии.
* `{`: Открытие блока кода метода `OnStopping`.
    * `if (CurrentPosition != 0 && ClosePositionOnStopping)`: Условный оператор `if`. Проверяет два условия:
        * `CurrentPosition != 0`: Проверяет, не равна ли текущая позиция нулю. `CurrentPosition`, вероятно, свойство, хранящее текущий размер позиции.
        * `ClosePositionOnStopping`: Проверяет значение свойства `ClosePositionOnStopping`. Если оно `true`, значит, нужно закрыть позицию при остановке.
        * `&&`: Оператор "И". Оба условия должны быть истинными.
    * `{`: Открытие блока кода `if`.
        * `RaiseShowNotification($"Closing current position {CurrentPosition} on stopping.", level: NotificationLevel.Alert);`: Вызов метода `RaiseShowNotification` для отображения уведомления пользователю.
            * `$"Closing current position {CurrentPosition} on stopping."`: Строка сообщения, использующая интерполяцию строк для вставки значения `CurrentPosition` в сообщение. Сообщение уведомляет о закрытии текущей позиции при остановке.
            * `level: NotificationLevel.Alert`:  Установка уровня уведомления в `NotificationLevel.Alert`. Это задает тип уведомления (например, "предупреждение").
        * `CloseCurrentPosition();`: Вызов метода `CloseCurrentPosition`. Этот метод, вероятно, предназначен для закрытия текущей открытой позиции.
    * `}`: Закрытие блока кода `if`.
    * `base.OnStopping();`: Вызов метода `OnStopping()` базового класса. `base` используется для доступа к членам базового класса. Это позволяет выполнить стандартное поведение остановки, определенное в `ChartStrategy` или `BaseIndicator`, в дополнение к пользовательской логике закрытия позиций.
* `}`: Закрытие блока кода метода `OnStopping`.
* `#endregion`: Конец области "Overrides of BaseIndicator".

```csharp
    #region Private methods
    private void OpenPosition(OrderDirections direction)
    {
        var order = new Order
        {
            Portfolio = Portfolio,
            Security = Security,
            Direction = direction,
            Type = OrderTypes.Market,
            QuantityToFill = GetOrderVolume(),
        };
        OpenOrder(order);
    }
```

**Аннотация:**

* `#region Private methods`: Начало области "Private methods". В этом регионе будут объявлены приватные методы класса, которые используются только внутри класса.
* `private void OpenPosition(OrderDirections direction)`: Объявление приватного метода `OpenPosition`.
    * `private`: Указывает, что метод доступен только внутри класса `SmaChartStrategy`.
    * `void`: Метод не возвращает значения.
    * `OpenPosition(OrderDirections direction)`: Имя метода и параметр `direction` типа `OrderDirections`.
* `{`: Открытие блока кода метода `OpenPosition`.
    * `var order = new Order`: Объявление локальной переменной `order` типа `var` и создание нового объекта `Order`. `Order`, вероятно, класс в ATAS, представляющий торговый ордер.
    * `{`: Открытие блока инициализации объекта `Order`.
        * `Portfolio = Portfolio,`: Установка свойства `Portfolio` объекта `order` в значение свойства `Portfolio` текущей стратегии. `Portfolio`, вероятно, свойство базового класса, представляющее торговый портфель.
        * `Security = Security,`: Установка свойства `Security` объекта `order` в значение свойства `Security` текущей стратегии. `Security`, вероятно, свойство, представляющее торговый инструмент (актив).
        * `Direction = direction,`: Установка свойства `Direction` объекта `order` в значение параметра `direction`, переданного в метод `OpenPosition`. Это задает направление ордера (покупка или продажа).
        * `Type = OrderTypes.Market,`: Установка свойства `Type` объекта `order` в значение `OrderTypes.Market`. `OrderTypes.Market` - это перечисление, указывающее тип ордера как рыночный (исполняется по текущей рыночной цене).
        * `QuantityToFill = GetOrderVolume(),`: Установка свойства `QuantityToFill` объекта `order` в значение, возвращаемое методом `GetOrderVolume()`. `QuantityToFill` - это количество актива для торговли в ордере. `GetOrderVolume()`, вероятно, метод, который определяет размер позиции.
    * `};`: Закрытие блока инициализации объекта `Order`.
    * `OpenOrder(order);`: Вызов метода `OpenOrder` с объектом `order` в качестве аргумента. `OpenOrder`, вероятно, метод базового класса, который отправляет ордер на торговую платформу.
* `}`: Закрытие блока кода метода `OpenPosition`.

```csharp
    private void CloseCurrentPosition()
    {
        var order = new Order
        {
            Portfolio = Portfolio,
            Security = Security,
            Direction = CurrentPosition > 0 ? OrderDirections.Sell : OrderDirections.Buy,
            Type = OrderTypes.Market,
            QuantityToFill = Math.Abs(CurrentPosition),
        };
        OpenOrder(order);
    }
```

**Аннотация:**

* `private void CloseCurrentPosition()`: Объявление приватного метода `CloseCurrentPosition`. Этот метод предназначен для закрытия текущей открытой позиции.
* `{`: Открытие блока кода метода `CloseCurrentPosition`.
    * `var order = new Order`: Объявление локальной переменной `order` и создание нового объекта `Order`.
    * `{`: Открытие блока инициализации объекта `Order`.
        * `Portfolio = Portfolio,`: Установка свойства `Portfolio`.
        * `Security = Security,`: Установка свойства `Security`.
        * `Direction = CurrentPosition > 0 ? OrderDirections.Sell : OrderDirections.Buy,`: Установка свойства `Direction` с использованием тернарного оператора `? :`.
            * `CurrentPosition > 0`: Условие: если текущая позиция больше 0 (длинная позиция).
            * `OrderDirections.Sell`: Если условие истинно, направление ордера - продажа (`OrderDirections.Sell`) для закрытия длинной позиции.
            * `: OrderDirections.Buy`: Иначе (если текущая позиция не больше 0, то есть короткая или нулевая), направление ордера - покупка (`OrderDirections.Buy`) для закрытия короткой позиции.
        * `Type = OrderTypes.Market,`: Установка типа ордера как рыночный.
        * `QuantityToFill = Math.Abs(CurrentPosition),`: Установка количества для закрытия. `Math.Abs(CurrentPosition)` берет абсолютное значение `CurrentPosition`. Это гарантирует, что будет закрыто именно текущее количество контрактов, независимо от того, длинная или короткая позиция.
    * `};`: Закрытие блока инициализации объекта `Order`.
    * `OpenOrder(order);`: Вызов метода `OpenOrder` для отправки ордера на закрытие позиции.
* `}`: Закрытие блока кода метода `CloseCurrentPosition`.

```csharp
    private decimal GetOrderVolume()
    {
        if (CurrentPosition == 0)
            return Volume;
        if (CurrentPosition > 0)
            return Volume + CurrentPosition;
        return Volume + Math.Abs(CurrentPosition);
    }
```

**Аннотация:**

* `private decimal GetOrderVolume()`: Объявление приватного метода `GetOrderVolume`. Этот метод предназначен для определения объема ордера.
    * `private`: Метод доступен только внутри класса.
    * `decimal`: Метод возвращает значение типа `decimal` (объем ордера).
* `{`: Открытие блока кода метода `GetOrderVolume`.
    * `if (CurrentPosition == 0)`: Условный оператор `if`. Проверяет, равна ли текущая позиция нулю.
        * `return Volume;`: Если позиция равна 0, возвращает значение свойства `Volume`. В этом случае, вероятно, открывается новая позиция заданного объема.
    * `if (CurrentPosition > 0)`: Условный оператор `if else if`. Проверяет, больше ли текущая позиция 0 (длинная позиция).
        * `return Volume + CurrentPosition;`: Если позиция длинная, возвращает сумму `Volume` и `CurrentPosition`.  В этом случае, возможно, увеличивается размер существующей длинной позиции на величину `Volume`.
    * `return Volume + Math.Abs(CurrentPosition);`: Если предыдущие условия `if` и `else if` не выполнены (то есть, позиция меньше или равна 0, и не равна 0, значит, она отрицательная - короткая позиция), то выполняется этот оператор `return`. Возвращает сумму `Volume` и абсолютного значения `CurrentPosition`. В этом случае, возможно, увеличивается размер короткой позиции или закрывается часть короткой позиции и открывается длинная на объем `Volume`.  Логика добавления объема к текущей позиции может зависеть от конкретной стратегии.
* `}`: Закрытие блока кода метода `GetOrderVolume`.

```csharp
    #endregion
}
```

**Аннотация:**

* `#endregion`: Конец области "Private methods".
* `}`: Закрытие блока кода класса `SmaChartStrategy`.

**Конец методички.**










### Directories  
#### Strategies Directory Reference  

#### Directory Dependency Graph  
- **Indicators**  
- **Strategies**  

#### Directories  
- **ATM**  
- **Chart**  
- **Editors**  
- **Properties**  

#### Files  
- **IStrategy.cs**  
- **Strategy.cs**  
- **StrategyLoggingExtensions.cs**  
- **StrategyNotificationEventArgs.cs**  
- **StrategyStateChangedEventArgs.cs**  
- **StrategyStates.cs**  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Indicators**  

### Аннотация:  
- **Strategies Directory**  
  *Модуль для разработки и управления торговыми стратегиями, включая базовые классы, события и состояния стратегий.*





### Directories  
#### ATM Directory Reference  

#### Directory Dependency Graph  
- **Strategies**  
- **ATM**  

#### Files  
- **ATMStrategy.cs**  
- **BaseStopProfitStrategy.cs**  
- **Strategies/ATM/Extensions.cs**  
- **IATMStrategy.cs**  
- **MultipleStopProfit.cs**  
- **StopProfit.cs**  
- **StopTakeValueTypes.cs**  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies.ATM** (inferred from directory path)  

### Аннотация:  
- **ATM Directory**  
  *Модуль для автоматизированных торговых стратегий (ATM — Automated Trading Module), включая базовые стратегии, управление стоп-лосс/тейк-профит и расширения.*






### Directories  
#### Chart Directory Reference  

#### Directory Dependency Graph  
- **Strategies**  
- **Chart**  

#### Files  
- **ChartStrategy.cs**  
- **IChartStrategy.cs**  
- **SmaChartStrategy.cs**  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Indicators**  
- **namespace ATAS.Strategies.Chart** (assumed based on directory context)  

### Аннотация:  
- **Chart Directory**  
  *Модуль для работы с графиками и стратегиями, связанными с визуализацией и анализом ценовых данных.*






### Directories  
#### Editors Directory Reference  

#### Directory Dependency Graph  
- **Strategies**  
- **Editors**  

#### Files  
- **ProtectionSettingsEditor.Common.cs**  
- **ProtectionSettingsEditor.xaml.cs**  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies.Editors** (inferred from directory path)  

### Аннотация:  
- **Editors Directory**  
  *Модуль для создания и редактирования пользовательских интерфейсов (например, настроек стратегий).*





### Directories  
#### Properties Directory Reference  

#### Directory Dependency Graph  
- **Strategies**  
- **Properties**  

#### Files  
- **Strategies/Properties/AssemblyInfo.cs**  






### Classes | Namespaces  
#### IStrategy.cs File Reference  

### Classes  
- **interface ATAS.Strategies.IStrategy**  
  *Interface representing a trading strategy. More...*  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies**





### Classes | Namespaces | Typedefs  
#### Strategy.cs File Reference  

### Classes  
- **class ATAS.Strategies.Strategy**  
  *Base class for implementing trading strategies. More...*  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies**  

### Typedefs  
- **using ATAS.Strategies.BaseLoggerSource = Utils.Common.Logging.BaseLoggerSource**



### Classes | Namespaces  
#### StrategyLoggingExtensions.cs File Reference  

### Classes  
- **class ATAS.Strategies.StrategyLoggingExtensions**  
  *Contains extension methods for logging in strategies. More...*  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies**




### Classes | Namespaces  
#### StrategyNotificationEventArgs.cs File Reference  

### Classes  
- **class ATAS.Strategies.StrategyNotificationEventArgs**  
  *Класс для предоставления данных события StrategyNotification (уведомления о событиях стратегии).*  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies**  

### Аннотация:  
- **StrategyNotificationEventArgs**  
  *Содержит информацию о событии, возникающем при отправке уведомлений из торговой стратегии (например, сигналы, ошибки).*




### Classes | Namespaces | Enumerations | Variables  
#### StrategyStateChangedEventArgs.cs File Reference  

### Classes  
- **class ATAS.Strategies.StrategyStateChangedEventArgs**  
  *Provides data for the StrategyStateChanged event. More...*  

### Enumerations  
- **enum ATAS.Strategies.StrategyErrorTypes**  
  ```  
  ATAS.Strategies.MaxNumberOfErrorsExceeded,  
  ATAS.Strategies.MaxNumberOfConnectionErrorsExceeded,  
  ATAS.Strategies.PreviousOrdersNotFound  
  ```  
  *Перечисление типов ошибок стратегии:  
  - **MaxNumberOfErrorsExceeded** — превышено максимальное количество ошибок;  
  - **MaxNumberOfConnectionErrorsExceeded** — превышено максимальное количество ошибок подключения;  
  - **PreviousOrdersNotFound** — предыдущие ордера не найдены.*  

### Variables  
- **record ATAS.Strategies.StrategyStateDescription**  
  *Структура, описывающая текущее состояние стратегии (например, активна/пауза/остановлена).*  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies**  

### Аннотация:  
- **StrategyStateChangedEventArgs**  
  *Событие, возникающее при изменении состояния стратегии (например, переход в режим паузы или ошибка).*




### Namespaces | Enumerations  
#### StrategyStates.cs File Reference  

### Enumerations  
- **enum ATAS.Strategies.StrategyStates**  
  ```  
  ATAS.Strategies.Stopped = 0,  
  ATAS.Strategies.Started = 1,  
  ATAS.Strategies.Suspended = 2,  
  ATAS.Strategies.Error = 3,  
  ATAS.Strategies.Watch = 4  
  ```  
  *Перечисление состояний торговой стратегии:  
  - **Stopped** — остановлена;  
  - **Started** — запущена;  
  - **Suspended** — на паузе;  
  - **Error** — ошибка;  
  - **Watch** — режим наблюдения.*  

### Namespaces  
- **namespace ATAS**  
- **namespace ATAS.Strategies**










































































